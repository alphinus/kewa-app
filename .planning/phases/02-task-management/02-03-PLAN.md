---
phase: 02-task-management
plan: 03
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - src/app/dashboard/tasks/page.tsx
  - src/components/tasks/ImeriTaskCard.tsx
  - src/components/tasks/CompleteTaskModal.tsx
  - src/app/dashboard/page.tsx
autonomous: true

must_haves:
  truths:
    - "Imeri sieht Liste seiner offenen Aufgaben"
    - "Imeri kann Aufgabe als erledigt markieren"
    - "Erledigte Aufgabe verschwindet aus Liste"
    - "Dashboard zeigt echte Daten, keine Platzhalter"
  artifacts:
    - path: "src/app/dashboard/tasks/page.tsx"
      provides: "Imeri's open task list"
      min_lines: 50
    - path: "src/components/tasks/ImeriTaskCard.tsx"
      provides: "Task card with complete button"
      min_lines: 40
    - path: "src/components/tasks/CompleteTaskModal.tsx"
      provides: "Completion confirmation with optional note"
      min_lines: 30
  key_links:
    - from: "src/app/dashboard/tasks/page.tsx"
      to: "/api/tasks?status=open"
      via: "fetch in useEffect"
      pattern: "fetch.*api/tasks.*status=open"
    - from: "src/components/tasks/CompleteTaskModal.tsx"
      to: "/api/tasks/[id]"
      via: "PUT request to update status"
      pattern: "fetch.*api/tasks.*PUT"
---

<objective>
Build Imeri's task interface - view open tasks and mark them complete.

Purpose: Give Imeri a simple, focused view of his work. He sees open tasks, taps to complete.
Output: Working task list and completion flow for Imeri role.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-task-management/02-01-SUMMARY.md

@src/types/index.ts
@src/types/database.ts
@src/components/ui/button.tsx
@src/components/ui/card.tsx
@src/hooks/useSession.ts
@src/app/dashboard/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Imeri task list page</name>
  <files>src/app/dashboard/tasks/page.tsx, src/components/tasks/ImeriTaskCard.tsx</files>
  <action>
    Create the tasks page optimized for Imeri's workflow:

    **src/app/dashboard/tasks/page.tsx:**
    1. Fetch open tasks: GET /api/tasks?status=open
    2. Show count header: "X offene Aufgaben"
    3. Group tasks by due date:
       - "Ueberfaellig" (past due, red header)
       - "Heute" (due today, yellow header)
       - "Diese Woche" (due within 7 days)
       - "Spaeter" (everything else)
    4. Use ImeriTaskCard for each task
    5. Handle loading with skeleton cards
    6. Handle empty state: "Keine offenen Aufgaben - gut gemacht!"
    7. Pull-to-refresh support (optional nice-to-have)

    **src/components/tasks/ImeriTaskCard.tsx:**
    1. Large, touch-friendly card (entire card is tap target)
    2. Display:
       - Task title (prominent, 18px+)
       - Location: Unit name + Project name
       - Due date with visual urgency (overdue = red, today = yellow)
       - Priority badge
       - Description preview (truncated, optional)
    3. Large "Erledigt" button (green, right side or bottom)
    4. Tap card shows task detail (description, any attached notes)
    5. "Erledigt" button opens CompleteTaskModal

    Touch-first: 48px minimum touch targets, generous spacing.
    German UI text.
  </action>
  <verify>npm run build succeeds, page renders at /dashboard/tasks with task list</verify>
  <done>Imeri sees grouped open tasks with clear priority and due date indicators</done>
</task>

<task type="auto">
  <name>Task 2: Create task completion modal</name>
  <files>src/components/tasks/CompleteTaskModal.tsx</files>
  <action>
    Create completion confirmation modal:

    1. Modal appears when "Erledigt" is tapped
    2. Shows task title and location for confirmation
    3. Optional completion note textarea (TASK-06 requirement):
       - Label: "Notiz (optional)"
       - Placeholder: "Kurze Notiz zur Erledigung..."
       - Max 200 characters

    4. Two buttons:
       - "Abbrechen" (secondary, closes modal)
       - "Als erledigt markieren" (primary, green)

    5. On confirm:
       - PUT /api/tasks/:id with { status: 'completed', completion_note: string }
       - Show loading state
       - On success: close modal, call onComplete callback
       - On error: show error message, keep modal open

    6. Accessible: focus trap, escape to close

    Touch-optimized: large buttons (56px height for primary action).
    German UI text.
  </action>
  <verify>npm run build succeeds, modal opens/closes, completing task updates status</verify>
  <done>Completion modal allows optional note and marks task as done</done>
</task>

<task type="auto">
  <name>Task 3: Update dashboard with real data</name>
  <files>src/app/dashboard/page.tsx</files>
  <action>
    Replace hardcoded placeholder data in main dashboard with real API data:

    **For KEWA role:**
    1. Fetch stats: total open tasks, completed today
       - GET /api/tasks?status=open for count
       - GET /api/tasks?status=completed (filter client-side for today)
    2. Fetch recent activity: last 5 completed tasks
    3. Update stats cards with real numbers
    4. Update activity list with real task names

    **For Imeri role:**
    1. Fetch open tasks: GET /api/tasks?status=open
    2. Show first 3 tasks as preview
    3. Update count: "Heute zu erledigen: X Aufgaben"
    4. Link to full list: /dashboard/tasks

    Handle loading states with number skeletons.
    Handle empty states gracefully.
  </action>
  <verify>npm run build succeeds, dashboard shows real task counts and activity</verify>
  <done>Dashboard displays real data from API, no more hardcoded placeholders</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npm run build succeeds
- [ ] /dashboard/tasks shows Imeri's open tasks grouped by date
- [ ] Tapping "Erledigt" opens completion modal
- [ ] Completing task removes it from list
- [ ] Optional note is saved with completion
- [ ] Main dashboard shows real task counts
- [ ] Activity list shows real completed tasks
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Imeri can view and complete tasks
- Completion note is optional but saved when provided
- Dashboard shows real data, no placeholders
- UI is touch-optimized for field use
</success_criteria>

<output>
After completion, create `.planning/phases/02-task-management/02-03-SUMMARY.md`
</output>
