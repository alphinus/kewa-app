---
phase: 02-task-management
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - src/app/dashboard/gebaude/page.tsx
  - src/app/dashboard/aufgaben/page.tsx
  - src/components/tasks/TaskForm.tsx
  - src/components/tasks/TaskList.tsx
  - src/components/projects/ProjectSelect.tsx
autonomous: true

must_haves:
  truths:
    - "KEWA sieht alle Einheiten mit Anzahl offener Aufgaben"
    - "KEWA kann neue Aufgabe erstellen mit Titel, Beschreibung, Faelligkeit, Prioritaet"
    - "KEWA kann bestehende Aufgabe bearbeiten"
    - "KEWA kann Aufgabe loeschen"
  artifacts:
    - path: "src/app/dashboard/gebaude/page.tsx"
      provides: "Unit overview with task statistics"
      min_lines: 50
    - path: "src/app/dashboard/aufgaben/page.tsx"
      provides: "Task management interface"
      min_lines: 80
    - path: "src/components/tasks/TaskForm.tsx"
      provides: "Task create/edit form"
      min_lines: 60
  key_links:
    - from: "src/app/dashboard/gebaude/page.tsx"
      to: "/api/units"
      via: "fetch in useEffect"
      pattern: "fetch.*api/units"
    - from: "src/components/tasks/TaskForm.tsx"
      to: "/api/tasks"
      via: "form submit handler"
      pattern: "fetch.*api/tasks"
---

<objective>
Build KEWA AG's task management interface - unit overview with task counts and full task CRUD.

Purpose: Enable KEWA AG to see all units at a glance and manage tasks (create, edit, delete).
Output: Working dashboard pages for Gebaude (unit overview) and Aufgaben (task management).
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-task-management/02-01-SUMMARY.md

@src/types/index.ts
@src/types/database.ts
@src/components/ui/button.tsx
@src/components/ui/card.tsx
@src/components/ui/input.tsx
@src/hooks/useSession.ts
@src/app/dashboard/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create unit overview page (Gebaude)</name>
  <files>src/app/dashboard/gebaude/page.tsx</files>
  <action>
    Create the Gebaude page showing all units with task statistics:

    1. Fetch units from GET /api/units on mount
    2. Display units grouped by type:
       - Apartments (unit_type='apartment') sorted by floor desc, then position
       - Common areas (unit_type='common_area')
       - Building-wide (unit_type='building')

    3. Each unit card shows:
       - Name (e.g., "1.OG Links")
       - Tenant name if set (privacy: only show if role=kewa)
       - Open tasks count with color coding:
         - 0 tasks: green badge
         - 1-2 tasks: yellow badge
         - 3+ tasks: red badge
       - Click navigates to /dashboard/aufgaben?unit_id=X

    4. Use existing Card component from src/components/ui/card.tsx
    5. Handle loading state with skeleton cards
    6. Handle empty state (no units)
    7. German UI text throughout

    Touch-optimized: Cards should be tap-friendly (min 48px touch target).
  </action>
  <verify>npm run build succeeds, page renders at /dashboard/gebaude</verify>
  <done>Unit overview shows all units with task counts, grouped by type</done>
</task>

<task type="auto">
  <name>Task 2: Create task management page (Aufgaben)</name>
  <files>src/app/dashboard/aufgaben/page.tsx, src/components/tasks/TaskList.tsx, src/components/projects/ProjectSelect.tsx</files>
  <action>
    Create the Aufgaben page for task management:

    **src/app/dashboard/aufgaben/page.tsx:**
    1. Fetch tasks from GET /api/tasks on mount
    2. Support URL params: ?unit_id=X to filter by unit
    3. Show filter controls:
       - Status filter (Alle / Offen / Erledigt)
       - Unit filter dropdown
    4. "Neue Aufgabe" button opens TaskForm modal
    5. Task list using TaskList component
    6. Handle loading, empty, error states
    7. Refresh list after create/edit/delete

    **src/components/tasks/TaskList.tsx:**
    1. Receive tasks: TaskWithProject[] as prop
    2. Display each task as Card with:
       - Title (bold)
       - Project name and unit (subtitle)
       - Due date with overdue indicator (red if past due)
       - Priority badge (color-coded)
       - Status indicator
    3. Click opens edit modal
    4. Swipe or button to delete (with confirmation)

    **src/components/projects/ProjectSelect.tsx:**
    1. Dropdown to select project for task
    2. Fetch projects from API or receive as prop
    3. Group by unit name
    4. Allow creating new project inline (optional - can be simple select)

    German UI text. Touch-optimized (48px targets).
  </action>
  <verify>npm run build succeeds, page renders at /dashboard/aufgaben with task list</verify>
  <done>Task list displays with filtering, clicking task opens edit mode</done>
</task>

<task type="auto">
  <name>Task 3: Create task form component</name>
  <files>src/components/tasks/TaskForm.tsx</files>
  <action>
    Create reusable TaskForm for create/edit:

    1. Modal or slide-up panel (mobile-friendly)
    2. Fields:
       - Project selection (required) - use ProjectSelect
       - Title (required, text input)
       - Description (optional, textarea)
       - Due date (optional, date picker)
       - Priority (select: Niedrig/Normal/Hoch/Dringend)

    3. Props interface:
       - mode: 'create' | 'edit'
       - task?: Task (for edit mode)
       - onSave: (task: Task) => void
       - onCancel: () => void
       - onDelete?: () => void (edit mode only)

    4. On submit:
       - Create mode: POST /api/tasks
       - Edit mode: PUT /api/tasks/:id
       - Show loading state on button
       - Handle errors with toast or inline message

    5. Delete button in edit mode:
       - Confirmation dialog before delete
       - DELETE /api/tasks/:id
       - Call onDelete callback

    6. Use existing Input, Button components
    7. German labels and validation messages
    8. Touch-optimized spacing (48px inputs from ui/input.tsx)

    Close on successful save. Keep open on error.
  </action>
  <verify>npm run build succeeds, form opens/closes, creates/updates tasks</verify>
  <done>TaskForm creates new tasks and edits existing, with delete option</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npm run build succeeds
- [ ] /dashboard/gebaude shows units with task counts
- [ ] /dashboard/aufgaben shows task list
- [ ] Clicking "Neue Aufgabe" opens form
- [ ] Creating task via form adds to list
- [ ] Clicking task opens edit form
- [ ] Editing task updates in list
- [ ] Deleting task removes from list
- [ ] Filters (status, unit) work correctly
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- KEWA AG can create, view, edit, delete tasks
- Unit overview shows real task counts
- UI is touch-optimized (48px targets)
- German text throughout
</success_criteria>

<output>
After completion, create `.planning/phases/02-task-management/02-02-SUMMARY.md`
</output>
