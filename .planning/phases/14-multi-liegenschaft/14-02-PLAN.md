---
phase: 14-multi-liegenschaft
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/navigation/PropertySelector.tsx
  - src/contexts/BuildingContext.tsx
autonomous: true

must_haves:
  truths:
    - "PropertySelector shows 'Alle Liegenschaften' option at top of dropdown"
    - "Selecting 'Alle' sets selectedBuildingId to null/special value 'all'"
    - "Each login starts fresh - no localStorage persistence (selector resets to first building)"
    - "When selected building no longer exists, falls back to first available"
  artifacts:
    - path: "src/components/navigation/PropertySelector.tsx"
      provides: "Dropdown with 'Alle Liegenschaften' option, no session persistence"
      min_lines: 150
    - path: "src/contexts/BuildingContext.tsx"
      provides: "Building context with 'all' support and no localStorage"
      min_lines: 50
  key_links:
    - from: "src/components/navigation/PropertySelector.tsx"
      to: "src/contexts/BuildingContext.tsx"
      via: "onSelect callback"
      pattern: "onSelect\\("
---

<objective>
Enhance PropertySelector with "Alle Liegenschaften" option and remove cross-session persistence.

Purpose: Enable global view across all properties and ensure clean session starts per CONTEXT.md decisions.
Output: Updated PropertySelector with global option, updated BuildingContext without localStorage.
</objective>

<execution_context>
@C:\Users\Mario Giacchino\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\Mario Giacchino\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/14-multi-liegenschaft/14-CONTEXT.md

# Existing files to modify
@src/components/navigation/PropertySelector.tsx
@src/contexts/BuildingContext.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update BuildingContext to remove localStorage</name>
  <files>src/contexts/BuildingContext.tsx</files>
  <action>
Modify BuildingContext:

1. Remove STORAGE_KEY constant and all localStorage references
2. Change selectedBuildingId type to `string | 'all' | null`
3. Initialize with null (will be set to first building by PropertySelector on fetch)
4. Keep selectBuilding function simple - just sets state
5. Add `isAllSelected` computed boolean for convenience
6. Update TypeScript interface to export the 'all' value type

The context becomes purely in-memory state for the current session.
  </action>
  <verify>
- No localStorage usage in file
- selectedBuildingId accepts 'all' as valid value
- Context provides isAllSelected helper
  </verify>
  <done>BuildingContext is session-only, supports 'all' selection value</done>
</task>

<task type="auto">
  <name>Task 2: Add "Alle Liegenschaften" option to PropertySelector</name>
  <files>src/components/navigation/PropertySelector.tsx</files>
  <action>
Modify PropertySelector dropdown:

1. Remove localStorage get/set calls (was duplicating context logic anyway)
2. Add "Alle Liegenschaften" as first option in dropdown:
   - Appears before property groups
   - Has distinct styling (e.g., bold, different icon like Globe or Layers)
   - Clicking sets selection to 'all' value
3. Update display logic:
   - When 'all' selected: show "Alle Liegenschaften" in button
   - When specific building selected: show property name + building name (current behavior)
4. Handle fallback:
   - After fetching, if current selection is invalid (building deleted), fall back to first available
   - Use useEffect to validate selection when properties load
5. Auto-select first building on initial load if no selection exists (not 'all' - that's explicit)

Button display states:
- Loading: "Laden..."
- Error: "Fehler"
- All selected: Icon + "Alle Liegenschaften"
- Building selected: Property name (small) + Building name (medium)
- No selection yet: "Liegenschaft waehlen"
  </action>
  <verify>
- Dropdown shows "Alle Liegenschaften" as first option
- Selecting it updates display to show global selection
- No localStorage calls in component
- Initial load auto-selects first building (not 'all')
  </verify>
  <done>"Alle Liegenschaften" option works, no persistence, auto-fallback implemented</done>
</task>

</tasks>

<verification>
1. Run `npm run build` - no TypeScript errors
2. Open app, PropertySelector shows first building by default (not 'all')
3. Open dropdown - "Alle Liegenschaften" appears at top
4. Select "Alle" - button shows "Alle Liegenschaften"
5. Refresh page - selection resets to first building (no persistence)
</verification>

<success_criteria>
- PropertySelector has "Alle Liegenschaften" option at top of dropdown
- Selecting "Alle" shows global selection in button display
- No localStorage usage - each session starts fresh
- Invalid selections fall back to first available building
- BuildingContext supports 'all' value and provides isAllSelected helper
</success_criteria>

<output>
After completion, create `.planning/phases/14-multi-liegenschaft/14-02-SUMMARY.md`
</output>
