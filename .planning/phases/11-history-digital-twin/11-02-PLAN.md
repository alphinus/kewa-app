# Plan 11-02: Room Condition Grid

## Frontmatter

```yaml
phase: 11
plan: 02
name: Room Condition Grid
wave: 1
depends_on: []
scope: small
autonomous: true
files_modified:
  - src/components/units/ConditionBadge.tsx
  - src/components/units/RoomConditionGrid.tsx
  - src/components/units/UnitConditionSummary.tsx
  - src/lib/units/condition-queries.ts
  - src/app/dashboard/wohnungen/[id]/page.tsx
```

## Goal

Build visual components showing room-by-room condition status and overall unit renovation progress. Users can see at a glance which rooms are new, partially renovated, or old.

## Requirements Addressed

- **HIST-02**: Unit-Uebersicht zeigt Renovations-Fortschritt pro Raum
- **HIST-05**: Unit-Summary wird automatisch berechnet (% renoviert)

## Context

From research (11-RESEARCH.md):
- `unit_condition_summary` view already calculates renovation_percentage
- Rooms table has `condition` field (old | partial | new)
- Types already exist: `UnitConditionSummary` in database.ts

## Tasks

<task id="01" title="Create ConditionBadge component">
Reusable badge component for displaying condition status.

**File:** `src/components/units/ConditionBadge.tsx`

```typescript
interface ConditionBadgeProps {
  condition: 'old' | 'partial' | 'new'
  size?: 'sm' | 'md'
  showLabel?: boolean
}
```

**Styling:**
- old: red background (bg-red-100 text-red-800)
- partial: yellow background (bg-yellow-100 text-yellow-800)
- new: green background (bg-green-100 text-green-800)

**Labels (German):**
- old: "Alt"
- partial: "Teilrenoviert"
- new: "Neu"
</task>

<task id="02" title="Create condition query module">
Server-side queries for fetching condition data.

**File:** `src/lib/units/condition-queries.ts`

**Exports:**
```typescript
// Fetch unit condition summary from view
export async function fetchUnitConditionSummary(unitId: string): Promise<UnitConditionSummary | null>

// Fetch all rooms for a unit with their conditions
export async function fetchRoomsWithConditions(unitId: string): Promise<RoomWithCondition[]>
```

Use existing `unit_condition_summary` database view.
</task>

<task id="03" title="Create RoomConditionGrid component" depends_on="01,02">
Grid showing all rooms in a unit with condition status.

**File:** `src/components/units/RoomConditionGrid.tsx`

**Requirements:**
- Grid layout (responsive: 2 cols mobile, 3-4 cols desktop)
- Each cell shows:
  - Room name
  - Room type (icon or text)
  - ConditionBadge
  - Last updated date (if available)
- Click on room could expand to show condition history (optional)
- Empty state if unit has no rooms

**Props:**
```typescript
interface RoomConditionGridProps {
  unitId: string
  className?: string
}
```
</task>

<task id="04" title="Create UnitConditionSummary component" depends_on="02">
Summary display showing overall unit renovation progress.

**File:** `src/components/units/UnitConditionSummary.tsx`

**Requirements:**
- Progress bar showing renovation_percentage
- Text: "X% renoviert"
- Breakdown: "Y neu, Z teilrenoviert, W alt"
- Visual progress bar (green fill)

**Props:**
```typescript
interface UnitConditionSummaryProps {
  unitId: string
  className?: string
}
```

**Use pattern from:** Existing progress bars in codebase
</task>

<task id="05" title="Integrate into unit detail page" depends_on="03,04">
Add room condition grid and summary to unit detail page.

**File:** `src/app/dashboard/wohnungen/[id]/page.tsx`

**Requirements:**
- Add section "Raumstatus" (Room Status)
- Show UnitConditionSummary at top
- Show RoomConditionGrid below
- Section header with HomeIcon
- Place before or alongside timeline section
</task>

## Verification

<verification>
- [ ] ConditionBadge renders correctly for all 3 conditions
- [ ] RoomConditionGrid shows all rooms for a unit
- [ ] UnitConditionSummary shows percentage from database view
- [ ] Progress bar reflects actual renovation percentage
- [ ] Room colors match condition (red=old, yellow=partial, green=new)
- [ ] No TypeScript errors
- [ ] Build succeeds: `npm run build`
</verification>

## Must Haves (Goal-Backward)

```yaml
must_haves:
  - "Room condition grid displays all rooms in unit"
  - "Each room shows its condition (old/partial/new)"
  - "Conditions color-coded (red/yellow/green)"
  - "Unit summary shows renovation percentage"
  - "Percentage calculated automatically from room conditions"
  - "Components accessible from unit detail view"
```
