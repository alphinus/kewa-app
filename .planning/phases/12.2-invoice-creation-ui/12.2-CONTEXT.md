# Phase 12.2: Invoice Creation UI - Context

**Gathered:** 2026-01-19
**Status:** Ready for planning

<domain>
## Phase Boundary

Form to create invoices from completed work orders. Closes integration gap INT-02 (Flow 2: Work Order → Invoice). Includes form, pre-fill from work order, and "Rechnung erstellen" action. Payment processing and PDF generation are separate concerns.

</domain>

<decisions>
## Implementation Decisions

### Pre-fill behavior
- Pre-fill everything possible from work order: partner, amount, description, dates
- If work order had counter-offer: show both amounts (original + counter-offer), user picks which to use
- All pre-filled fields are editable — pre-fill is suggestion, not constraint
- Work order reference display: Claude's discretion

### Entry points
- Two entry points: "Rechnung erstellen" button on work order detail + "Neue Rechnung" on invoice list page
- Button visible when work order status is `done` OR `accepted` (can invoice once contractor accepted)
- When entering from invoice list (no work order context): show dropdown of eligible work orders (filterable)
- Route structure (`/kosten/rechnungen/neu`): Claude decides whether work order ID is required or optional

### Line item structure
- One line item per work order by default (work order description + total amount)
- User CAN add additional line items beyond the work order (extra charges, materials)
- Individual prices vs single total: Claude's discretion
- VAT: 8.0% auto-calculate from net amount

### Post-submission flow
- After successful creation: redirect to invoice detail page
- Initial invoice status: `draft`
- Show preview before final submit (confirmation step)
- Prevent duplicate invoices: error if work order already has an invoice linked

### Claude's Discretion
- Work order reference display styling
- Route structure (require vs optional work order ID)
- Line item pricing display (individual vs total)
- Form layout and field organization
- Error message wording

</decisions>

<specifics>
## Specific Ideas

- Counter-offer handling: When work order had price negotiation, show both amounts side-by-side so user can consciously choose
- VAT rate updated to 8.0% (Swiss VAT increase)
- Preview step before submit helps catch errors before invoice is created

</specifics>

<deferred>
## Deferred Ideas

None — discussion stayed within phase scope

</deferred>

---

*Phase: 12.2-invoice-creation-ui*
*Context gathered: 2026-01-19*
