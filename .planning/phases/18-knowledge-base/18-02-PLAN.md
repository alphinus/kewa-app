---
phase: 18-knowledge-base
plan: 02
type: execute
wave: 2
depends_on: ["18-01"]
files_modified:
  - package.json
  - src/components/knowledge/ArticleEditor.tsx
  - src/components/knowledge/ArticleViewer.tsx
  - src/components/knowledge/TemplateSelector.tsx
  - src/app/dashboard/knowledge/page.tsx
  - src/app/dashboard/knowledge/new/page.tsx
  - src/app/dashboard/knowledge/[id]/page.tsx
  - src/app/dashboard/knowledge/[id]/edit/page.tsx
autonomous: true

must_haves:
  truths:
    - "User can create a new article with WYSIWYG content"
    - "User can select article template (FAQ, How-to, Policy)"
    - "User can edit existing article content"
    - "User can view rendered article with proper formatting"
  artifacts:
    - path: "src/components/knowledge/ArticleEditor.tsx"
      provides: "Tiptap-based WYSIWYG editor with template support"
      min_lines: 80
    - path: "src/components/knowledge/ArticleViewer.tsx"
      provides: "Read-only article display"
      min_lines: 50
    - path: "src/app/dashboard/knowledge/page.tsx"
      provides: "Knowledge base home page"
      exports: ["default"]
    - path: "src/app/dashboard/knowledge/new/page.tsx"
      provides: "Create new article page"
      exports: ["default"]
  key_links:
    - from: "src/components/knowledge/ArticleEditor.tsx"
      to: "@tiptap/react"
      via: "useEditor hook"
      pattern: "useEditor.*immediatelyRender.*false"
    - from: "src/app/dashboard/knowledge/new/page.tsx"
      to: "/api/knowledge"
      via: "fetch POST"
      pattern: "fetch.*api/knowledge.*POST"
    - from: "src/app/dashboard/knowledge/[id]/page.tsx"
      to: "/api/knowledge/[id]"
      via: "fetch GET"
      pattern: "fetch.*api/knowledge"
---

<objective>
Install Tiptap and create the article editing and viewing components. Build the knowledge base pages for listing, creating, viewing, and editing articles with template-based content structure.

Purpose: Core user experience for knowledge base - the WYSIWYG editor is the primary interface users interact with.
Output: Working Tiptap editor with templates, article CRUD UI, and knowledge base dashboard.
</objective>

<execution_context>
@C:\Users\Mario Giacchino\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\Mario Giacchino\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/18-knowledge-base/18-CONTEXT.md
@.planning/phases/18-knowledge-base/18-RESEARCH.md
@.planning/phases/18-knowledge-base/18-01-SUMMARY.md
@src/types/knowledge-base.ts
@src/components/ui/button.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Tiptap dependencies and shadcn minimal-tiptap</name>
  <files>package.json</files>
  <action>
Install Tiptap and required extensions:

```bash
npm install @tiptap/react @tiptap/pm @tiptap/starter-kit @tiptap/extension-image @tiptap/extension-link @tiptap/extension-placeholder
```

Then add the shadcn minimal-tiptap component:
```bash
npx shadcn@latest add https://raw.githubusercontent.com/Aslam97/shadcn-minimal-tiptap/main/registry/block-registry.json
```

If shadcn command fails or isn't available, manually create the minimal wrapper component in src/components/ui/tiptap.tsx with:
- Toolbar with bold, italic, headings (H1-H3), bullet/ordered lists
- Link insertion button
- Basic editor content area
- Export functions: getTiptapContent(), setTiptapContent()

Verify installation with `npm run type-check`.
  </action>
  <verify>
Run `npm ls @tiptap/react` - should show installed version.
Run `npm run type-check` - should pass.
  </verify>
  <done>
Tiptap packages installed and shadcn component added (or manual wrapper created).
  </done>
</task>

<task type="auto">
  <name>Task 2: Create ArticleEditor and ArticleViewer components</name>
  <files>
    src/components/knowledge/ArticleEditor.tsx
    src/components/knowledge/ArticleViewer.tsx
    src/components/knowledge/TemplateSelector.tsx
  </files>
  <action>
**src/components/knowledge/ArticleEditor.tsx**:
```typescript
'use client'

import { useEditor, EditorContent } from '@tiptap/react'
import StarterKit from '@tiptap/starter-kit'
import Image from '@tiptap/extension-image'
import Link from '@tiptap/extension-link'
import Placeholder from '@tiptap/extension-placeholder'
import { useCallback } from 'react'

interface ArticleEditorProps {
  initialContent?: Record<string, unknown>
  placeholder?: string
  onChange?: (content: Record<string, unknown>) => void
  editable?: boolean
}

export function ArticleEditor({
  initialContent,
  placeholder = 'Start writing...',
  onChange,
  editable = true,
}: ArticleEditorProps) {
  const editor = useEditor({
    extensions: [
      StarterKit,
      Image,
      Link.configure({
        openOnClick: false,
        HTMLAttributes: { class: 'text-blue-600 underline' },
      }),
      Placeholder.configure({ placeholder }),
    ],
    content: initialContent,
    editable,
    immediatelyRender: false, // CRITICAL: Prevents SSR hydration errors
    onUpdate: ({ editor }) => {
      onChange?.(editor.getJSON())
    },
  })

  // Toolbar component with formatting buttons
  // Include: Bold, Italic, H1, H2, H3, Bullet List, Ordered List, Link
  // Use existing Button component from @/components/ui/button
  // Style with Tailwind, dark mode support

  return (
    <div className="border rounded-lg overflow-hidden">
      {editable && <EditorToolbar editor={editor} />}
      <EditorContent
        editor={editor}
        className="prose prose-slate dark:prose-invert max-w-none p-4 min-h-[300px] focus:outline-none"
      />
    </div>
  )
}

// Export for external access
export function useArticleEditor() {
  // Hook for programmatic editor access
}
```

**src/components/knowledge/ArticleViewer.tsx**:
- Read-only Tiptap with editable=false
- Accept highlightTerms prop for search highlighting
- Display article metadata (author, date, view count, tags)
- Show category breadcrumb

**src/components/knowledge/TemplateSelector.tsx**:
- Dropdown/card selector for FAQ, How-to, Policy templates
- Show description of each template type
- On select, call onSelect(templateType) callback
- Display template preview/structure

Template structures (from RESEARCH.md):
- FAQ: Question (required), Answer (required), Related Topics
- How-to: Overview (required), Steps (required), Tips & Warnings
- Policy: Policy Statement (required), Scope (required), Responsibilities, Effective Date (required)

When user selects template, pre-populate editor with template sections as placeholder blocks.
  </action>
  <verify>
Run `npm run type-check` - should pass.
Create test file to import components and verify no errors.
  </verify>
  <done>
Three components exist: ArticleEditor with Tiptap SSR-safe config, ArticleViewer for display, TemplateSelector for choosing article type.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create knowledge base pages</name>
  <files>
    src/app/dashboard/knowledge/page.tsx
    src/app/dashboard/knowledge/new/page.tsx
    src/app/dashboard/knowledge/[id]/page.tsx
    src/app/dashboard/knowledge/[id]/edit/page.tsx
  </files>
  <action>
**src/app/dashboard/knowledge/page.tsx** (KB home):
- List articles with title, category, status, last updated
- Filter by status (draft/review/published for users, all for admin)
- "Neuer Artikel" button linking to /dashboard/knowledge/new
- Simple table/card layout following existing patterns (see /dashboard/aufgaben)
- German UI text

**src/app/dashboard/knowledge/new/page.tsx** (create article):
- TemplateSelector at top (user must select template first)
- After template selected, show ArticleEditor
- Form fields: title (input), category (dropdown), tags (multi-input), visibility (radio/dropdown)
- Save as draft button, Submit for review button
- On save, POST to /api/knowledge
- Redirect to view page after save

**src/app/dashboard/knowledge/[id]/page.tsx** (view article):
- Load article via GET /api/knowledge/[id]
- ArticleViewer component for content
- Show metadata: author, last updated, version, view count
- Edit button (if user has permission or is author)
- Back to list link
- Related articles sidebar (placeholder for Plan 05)

**src/app/dashboard/knowledge/[id]/edit/page.tsx** (edit article):
- Load existing article
- ArticleEditor with initialContent
- Same form fields as new page
- Save changes button (PUT to /api/knowledge/[id])
- Status change buttons based on current status and user role

Follow existing page patterns from src/app/dashboard/aufgaben/.
German UI: "Wissensdatenbank", "Neuer Artikel", "Speichern", "Abbrechen", "Bearbeiten"
  </action>
  <verify>
Run `npm run type-check` - should pass.
Run `npm run lint` - should pass.
Navigate to /dashboard/knowledge in browser to verify page loads.
  </verify>
  <done>
Four pages exist: list, new, view, edit. User can create article with template, edit content, and view rendered article.
  </done>
</task>

</tasks>

<verification>
- [ ] Tiptap packages installed in package.json
- [ ] ArticleEditor uses immediatelyRender: false
- [ ] ArticleViewer renders Tiptap JSON as read-only
- [ ] TemplateSelector shows FAQ, How-to, Policy options
- [ ] /dashboard/knowledge lists articles
- [ ] /dashboard/knowledge/new allows creating article with template
- [ ] /dashboard/knowledge/[id] displays article
- [ ] /dashboard/knowledge/[id]/edit allows editing
- [ ] `npm run type-check` passes
- [ ] `npm run lint` passes
</verification>

<success_criteria>
1. User can navigate to /dashboard/knowledge and see article list
2. User can create new article by selecting template and editing content
3. User can view article with rendered rich text
4. User can edit existing article content
5. Tiptap editor has no SSR hydration errors
</success_criteria>

<output>
After completion, create `.planning/phases/18-knowledge-base/18-02-SUMMARY.md`
</output>
