---
phase: 30-security-audit-cve-patching
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - package-lock.json
autonomous: true

must_haves:
  truths:
    - "npm audit shows 0 critical and 0 high severity vulnerabilities"
    - "Next.js version is 16.1.6 or higher"
    - "Application builds successfully after upgrade"
  artifacts:
    - path: "package.json"
      provides: "Next.js 16.1.6 dependency"
      contains: '"next": "16.1.6"'
    - path: "package-lock.json"
      provides: "Locked dependency versions"
  key_links: []
---

<objective>
Upgrade Next.js to 16.1.6 to patch CVE-2025-29927, CVE-2025-55183, and CVE-2025-55184. Run npm audit fix to resolve any remaining vulnerabilities.

Purpose: Close critical security vulnerabilities that allow middleware bypass and other exploits.
Output: Clean npm audit with 0 critical/high vulnerabilities, Next.js 16.1.6 installed.
</objective>

<execution_context>
@C:\Users\Mario Giacchino\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\Mario Giacchino\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/30-security-audit-cve-patching/30-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Upgrade Next.js and run npm audit</name>
  <files>package.json, package-lock.json</files>
  <action>
1. Upgrade Next.js to 16.1.6:
   ```bash
   npm install next@16.1.6
   ```

2. Run npm audit to identify remaining vulnerabilities:
   ```bash
   npm audit
   ```

3. If any critical or high vulnerabilities remain, run:
   ```bash
   npm audit fix
   ```

4. If npm audit fix cannot resolve (peer dependency issues), document the specific packages and whether they're dev-only or have acceptable risk.
  </action>
  <verify>
Run `npm audit` and confirm output shows:
- 0 critical vulnerabilities
- 0 high severity vulnerabilities
- Moderate/low are acceptable

Run `npm pkg get dependencies.next` and confirm output is "16.1.6"
  </verify>
  <done>npm audit shows 0 critical, 0 high. Next.js is 16.1.6.</done>
</task>

<task type="auto">
  <name>Task 2: Verify application builds and runs</name>
  <files>None (verification only)</files>
  <action>
1. Run a production build to ensure the upgrade doesn't break anything:
   ```bash
   npm run build
   ```

2. Start the production server briefly to verify it launches:
   ```bash
   npm run start
   ```
   (Can kill after confirming startup)

3. If build fails, diagnose and fix any breaking changes from the upgrade.
  </action>
  <verify>
- `npm run build` completes without errors
- Build output shows successful compilation
  </verify>
  <done>Application builds and runs successfully with Next.js 16.1.6</done>
</task>

</tasks>

<verification>
```bash
# Verify Next.js version
npm pkg get dependencies.next
# Expected: "16.1.6"

# Verify npm audit is clean
npm audit --audit-level=high
# Expected: 0 vulnerabilities (or only moderate/low)

# Verify build succeeds
npm run build
# Expected: Build successful
```
</verification>

<success_criteria>
- Next.js upgraded to 16.1.6
- npm audit shows 0 critical and 0 high vulnerabilities
- Application builds successfully
- Requirements SEC-01 and SEC-02 satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/30-security-audit-cve-patching/30-01-SUMMARY.md`
</output>
