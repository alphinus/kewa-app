---
phase: 17-admin-onboarding
plan: 05
type: execute
wave: 2
depends_on: ["17-02"]
files_modified:
  - src/components/wizard/SetupWizard.tsx
  - src/components/wizard/steps/PropertyStep.tsx
  - src/components/wizard/steps/BuildingStep.tsx
  - src/components/wizard/steps/PartnerStep.tsx
  - src/app/admin/page.tsx
autonomous: true

must_haves:
  truths:
    - "First-time user sees setup wizard prompting for initial data"
    - "Wizard has three mandatory steps: Property, Building, Partner"
    - "User can navigate back to edit previous steps without losing data"
    - "Completing wizard redirects to admin dashboard"
    - "Wizard can be skipped if system already has data"
  artifacts:
    - path: "src/components/wizard/SetupWizard.tsx"
      provides: "Main wizard modal component"
      exports: ["SetupWizard"]
      min_lines: 80
    - path: "src/components/wizard/steps/PropertyStep.tsx"
      provides: "Property creation step"
      exports: ["PropertyStep"]
    - path: "src/components/wizard/steps/BuildingStep.tsx"
      provides: "Building creation step"
      exports: ["BuildingStep"]
    - path: "src/components/wizard/steps/PartnerStep.tsx"
      provides: "Partner creation step"
      exports: ["PartnerStep"]
  key_links:
    - from: "src/components/wizard/SetupWizard.tsx"
      to: "step components"
      via: "conditional rendering"
      pattern: "currentStep.*===.*property"
    - from: "src/app/admin/page.tsx"
      to: "src/components/wizard/SetupWizard.tsx"
      via: "conditional render or client wrapper"
      pattern: "SetupWizard"
---

<objective>
Create setup wizard for first-time onboarding with three mandatory steps.

Purpose: Addresses SEED-03 requirement for setup wizard on first login.
Output: Modal wizard component with property, building, and partner creation steps.
</objective>

<execution_context>
@C:\Users\Mario Giacchino\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\Mario Giacchino\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/17-admin-onboarding/17-CONTEXT.md
@.planning/phases/17-admin-onboarding/17-RESEARCH.md

# Reference for API patterns
@src/components/partners/PartnerForm.tsx
@src/components/admin/PropertyBuilder.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SetupWizard main component</name>
  <files>src/components/wizard/SetupWizard.tsx</files>
  <action>
    Create wizard container component at src/components/wizard/SetupWizard.tsx:

    'use client' directive required.

    Props interface:
    ```typescript
    interface SetupWizardProps {
      onComplete: () => void  // Called when wizard finishes
      onSkip?: () => void     // Optional skip handler
    }
    ```

    State:
    ```typescript
    type WizardStep = 'property' | 'building' | 'partner'
    type WizardData = {
      property?: { id: string; name: string }
      building?: { id: string; name: string }
      partner?: { id: string; name: string }
    }
    ```

    Implementation:
    1. Fixed overlay: fixed inset-0 bg-black/50 z-50 flex items-center justify-center
    2. Modal card: bg-white dark:bg-gray-900 rounded-lg max-w-2xl w-full p-6
    3. Step indicator showing progress (1 of 3):
       - Circles with numbers (1, 2, 3)
       - Completed steps show checkmark, green background
       - Current step: blue background
       - Future steps: gray background
       - Connecting lines between circles
    4. Step titles: "Liegenschaft erstellen", "Gebäude hinzufügen", "Partner anlegen"
    5. Conditional render of step components based on currentStep
    6. Navigation buttons:
       - Back (disabled on first step)
       - Next (disabled if current step data not set)
       - Last step shows "Fertigstellen" instead of "Weiter"
    7. Optional skip button in header if onSkip provided

    Data persistence: Store all wizardData in parent state, pass down as initialData.
  </action>
  <verify>
    - File exists at src/components/wizard/SetupWizard.tsx
    - Exports SetupWizard component
    - Has step indicator UI
    - Has back/next navigation
    - TypeScript compiles
  </verify>
  <done>SetupWizard main component created with step navigation and data state</done>
</task>

<task type="auto">
  <name>Task 2: Create wizard step components</name>
  <files>
    src/components/wizard/steps/PropertyStep.tsx
    src/components/wizard/steps/BuildingStep.tsx
    src/components/wizard/steps/PartnerStep.tsx
  </files>
  <action>
    Create three step components in src/components/wizard/steps/:

    **PropertyStep.tsx:**
    Props: initialData, onComplete (returns {id, name})
    Fields:
    - name (required): Property name
    - address (required): Street address
    - city (required): City name
    - postal_code (required): Postal code
    On submit: POST to /api/properties, call onComplete with result

    **BuildingStep.tsx:**
    Props: propertyId, initialData, onComplete (returns {id, name})
    Fields:
    - name (required): Building name (e.g., "Gebäude A")
    - floors (required): Number of floors
    On submit: POST to /api/buildings with property_id, call onComplete

    **PartnerStep.tsx:**
    Props: initialData, onComplete (returns {id, name})
    Fields (simplified from full PartnerForm):
    - company_name (required): Company name
    - contact_name (required): Contact person
    - email (optional): Email address
    - type (required): contractor or supplier
    On submit: POST to /api/partners, call onComplete

    All steps:
    - 'use client' directive
    - Form with inline validation
    - Loading state during API call
    - Error display if API fails
    - Pre-fill from initialData if editing
    - Call onComplete with {id, name} on success
  </action>
  <verify>
    - All three step files exist
    - Each exports its component
    - Each has form with required fields
    - Each calls onComplete after successful API submit
    - TypeScript compiles
  </verify>
  <done>All wizard step components created with forms and API integration</done>
</task>

<task type="auto">
  <name>Task 3: Integrate wizard with admin dashboard</name>
  <files>src/app/admin/page.tsx</files>
  <action>
    Update admin dashboard to show wizard for first-time users:

    Option A (Server Component with client wrapper):
    1. Create src/app/admin/AdminDashboardClient.tsx as client component
    2. Check localStorage for 'setupWizardComplete' flag
    3. If not complete AND no existing data, show wizard
    4. On wizard complete, set localStorage flag, refresh page

    Option B (Full client component):
    1. Convert page to client component
    2. Check data counts on load
    3. If all counts are 0, show wizard

    Recommended: Option A - keeps Server Component benefits.

    Implementation:
    1. In AdminDashboardClient, check:
       - localStorage.getItem('setupWizardComplete') !== 'true'
       - AND propertyCount === 0 (no data yet)
    2. If both true, render SetupWizard overlay
    3. onComplete handler:
       - localStorage.setItem('setupWizardComplete', 'true')
       - router.refresh() to reload dashboard with new data
    4. onSkip handler (if data exists):
       - localStorage.setItem('setupWizardComplete', 'true')
       - Close wizard

    Pass counts from Server Component to client wrapper as props.
  </action>
  <verify>
    - Admin page shows wizard when no data exists
    - Wizard does not show after completion
    - Wizard does not show if data already exists
    - After wizard, dashboard shows new counts
    - npm run build succeeds
  </verify>
  <done>Setup wizard integrated with admin dashboard, shows for first-time users</done>
</task>

</tasks>

<verification>
- [ ] SetupWizard renders as modal overlay
- [ ] Three steps work: Property -> Building -> Partner
- [ ] Back button works without losing data
- [ ] Each step creates record via API
- [ ] Completing wizard sets localStorage flag
- [ ] Wizard shows only for first-time users with no data
- [ ] Skip option available if data exists
- [ ] npm run build succeeds
</verification>

<success_criteria>
SEED-03 satisfied: First-time login triggers setup wizard that creates initial property, building, and partner
</success_criteria>

<output>
After completion, create `.planning/phases/17-admin-onboarding/17-05-SUMMARY.md`
</output>
