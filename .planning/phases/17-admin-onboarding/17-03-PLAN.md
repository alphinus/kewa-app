---
phase: 17-admin-onboarding
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - src/hooks/useDebounce.ts
  - src/components/partners/PartnerList.tsx
  - src/app/templates/page.tsx
autonomous: true

must_haves:
  truths:
    - "Partner list has search input that filters as you type"
    - "Template list has search input that filters as you type"
    - "Search uses 300ms debounce to avoid excessive filtering"
    - "Search combines with existing filters (search within filtered results)"
    - "Search results show count: 'Showing X of Y'"
  artifacts:
    - path: "src/hooks/useDebounce.ts"
      provides: "Custom debounce hook"
      exports: ["useDebounce"]
      min_lines: 15
    - path: "src/components/partners/PartnerList.tsx"
      provides: "Partner list with search"
      contains: "useDebounce"
    - path: "src/app/templates/page.tsx"
      provides: "Template list with search"
      contains: "useDebounce"
  key_links:
    - from: "src/components/partners/PartnerList.tsx"
      to: "src/hooks/useDebounce.ts"
      via: "import"
      pattern: "import.*useDebounce.*from"
    - from: "src/app/templates/page.tsx"
      to: "src/hooks/useDebounce.ts"
      via: "import"
      pattern: "import.*useDebounce.*from"
---

<objective>
Add search/filter functionality to partner and template lists with debounced input.

Purpose: Addresses ADMN-03 requirement for search/filter on lists.
Output: Custom useDebounce hook and updated list components with search input.
</objective>

<execution_context>
@C:\Users\Mario Giacchino\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\Mario Giacchino\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/17-admin-onboarding/17-CONTEXT.md
@.planning/phases/17-admin-onboarding/17-RESEARCH.md

# Existing list components to modify
@src/components/partners/PartnerList.tsx
@src/app/templates/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useDebounce hook</name>
  <files>src/hooks/useDebounce.ts</files>
  <action>
    Create custom useDebounce hook at src/hooks/useDebounce.ts:

    ```typescript
    import { useCallback, useRef, useEffect } from 'react'

    /**
     * Debounce a callback function
     * @param callback - Function to debounce
     * @param delay - Delay in milliseconds (default: 300)
     * @returns Debounced function
     */
    export function useDebounce<T extends (...args: any[]) => void>(
      callback: T,
      delay: number = 300
    ): T {
      const timeoutRef = useRef<NodeJS.Timeout | null>(null)

      // Cleanup on unmount
      useEffect(() => {
        return () => {
          if (timeoutRef.current) {
            clearTimeout(timeoutRef.current)
          }
        }
      }, [])

      return useCallback(
        ((...args) => {
          if (timeoutRef.current) {
            clearTimeout(timeoutRef.current)
          }
          timeoutRef.current = setTimeout(() => {
            callback(...args)
          }, delay)
        }) as T,
        [callback, delay]
      )
    }
    ```

    This pattern:
    - Uses useRef for timer (persists across renders)
    - Cleans up timer on unmount
    - Returns memoized debounced function
    - Default 300ms delay per CONTEXT.md
  </action>
  <verify>
    - File exists at src/hooks/useDebounce.ts
    - Exports useDebounce function
    - TypeScript compiles without errors
  </verify>
  <done>useDebounce hook created with proper cleanup and TypeScript types</done>
</task>

<task type="auto">
  <name>Task 2: Add search to PartnerList</name>
  <files>src/components/partners/PartnerList.tsx</files>
  <action>
    Update PartnerList.tsx to add search functionality:

    1. Import useDebounce from @/hooks/useDebounce
    2. Add state:
       - searchQuery: string (controlled input value)
       - filteredPartners: Partner[] (search results)
       - isSearching: boolean (loading indicator)

    3. Add search function (useCallback):
       - If query empty, show all partners
       - Filter by: company_name, contact_name, email, trade_categories
       - Case-insensitive matching (toLowerCase)

    4. Wire debounced search:
       - On searchQuery change, set isSearching=true, call debouncedSearch
       - Debounced function sets filteredPartners and isSearching=false

    5. Add search input above filters:
       - Input type="text" placeholder="Partner suchen..."
       - Full width, styled like existing filter inputs
       - Search icon (lucide-react Search) inside input

    6. Add results count below search:
       - "Zeige {filteredPartners.length} von {partners.length} Partnern"
       - Or "Suche..." while isSearching=true

    7. Render filteredPartners instead of partners in list

    Searchable fields per CONTEXT.md:
    - company_name (Firma)
    - contact_name (Kontaktperson)
    - email (Email)
    - trade_categories (Gewerke)
  </action>
  <verify>
    - PartnerList imports useDebounce
    - Search input visible above filters
    - Typing in search filters list after 300ms
    - Results count shown
    - Search works with existing active/type filters
  </verify>
  <done>PartnerList has working search that filters as you type</done>
</task>

<task type="auto">
  <name>Task 3: Add search to TemplatesPage</name>
  <files>src/app/templates/page.tsx</files>
  <action>
    Update templates/page.tsx to add search functionality:

    1. Import useDebounce from @/hooks/useDebounce
    2. Add state:
       - searchQuery: string
       - filteredTemplates: Template[]
       - isSearching: boolean

    3. Add search function (useCallback):
       - If query empty, use all templates
       - Filter by: name, description
       - Case-insensitive matching

    4. Wire debounced search:
       - Similar pattern to PartnerList
       - Search runs on query OR templates change

    5. Add search input in filters section:
       - Input type="text" placeholder="Template suchen..."
       - Position before category filter buttons
       - Same styling as rest of page

    6. Add results count:
       - "Zeige {count} von {total} Templates"

    7. Update grouped rendering:
       - Group filteredTemplates instead of templates
       - Existing category grouping logic remains

    Searchable fields per CONTEXT.md:
    - name (Template Name)
    - description (Beschreibung)
  </action>
  <verify>
    - TemplatesPage imports useDebounce
    - Search input visible in filters area
    - Typing in search filters templates after 300ms
    - Search works with category filter and inactive toggle
    - Grouped display still works correctly
  </verify>
  <done>TemplatesPage has working search that filters as you type</done>
</task>

</tasks>

<verification>
- [ ] useDebounce hook exists and exports correctly
- [ ] PartnerList has search input with 300ms debounce
- [ ] PartnerList searches company_name, contact_name, email, trade_categories
- [ ] TemplatesPage has search input with 300ms debounce
- [ ] TemplatesPage searches name, description
- [ ] Both lists show "Zeige X von Y" results count
- [ ] Search combines with existing filters
- [ ] npm run build succeeds
</verification>

<success_criteria>
ADMN-03 satisfied: Partner and template lists have working search/filter functionality
</success_criteria>

<output>
After completion, create `.planning/phases/17-admin-onboarding/17-03-SUMMARY.md`
</output>
