---
phase: 17-admin-onboarding
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/admin/page.tsx
  - src/components/admin/CounterCard.tsx
  - src/components/admin/AlertSection.tsx
  - src/components/admin/QuickActions.tsx
autonomous: true

must_haves:
  truths:
    - "Admin dashboard shows counts for properties, partners, projects, templates"
    - "Counter cards are clickable and navigate to respective list pages"
    - "Alerts section shows overdue projects, stalled projects, inactive partners"
    - "Quick action buttons create new property, partner, project, template"
    - "Dashboard is responsive: 4-col desktop, 2x2 tablet, stack mobile"
  artifacts:
    - path: "src/app/admin/page.tsx"
      provides: "Server Component admin dashboard"
      min_lines: 50
    - path: "src/components/admin/CounterCard.tsx"
      provides: "Reusable counter card with click navigation"
      exports: ["CounterCard"]
    - path: "src/components/admin/AlertSection.tsx"
      provides: "Alert list display component"
      exports: ["AlertSection"]
    - path: "src/components/admin/QuickActions.tsx"
      provides: "Quick action buttons component"
      exports: ["QuickActions"]
  key_links:
    - from: "src/app/admin/page.tsx"
      to: "supabase"
      via: "direct database access in Server Component"
      pattern: "createClient.*from.*select"
    - from: "src/components/admin/CounterCard.tsx"
      to: "list pages"
      via: "Link href"
      pattern: "Link.*href"
---

<objective>
Create admin overview dashboard with counter cards, alerts, and quick actions.

Purpose: Addresses ADMN-01 (counters) and ADMN-02 (quick actions) requirements.
Output: Server Component dashboard page with reusable card components.
</objective>

<execution_context>
@C:\Users\Mario Giacchino\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\Mario Giacchino\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/17-admin-onboarding/17-CONTEXT.md
@.planning/phases/17-admin-onboarding/17-RESEARCH.md

# Existing patterns
@src/lib/supabase/server.ts
@src/components/ui/card.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CounterCard component</name>
  <files>src/components/admin/CounterCard.tsx</files>
  <action>
    Create reusable CounterCard component:

    Props interface:
    - title: string (display name)
    - count: number (counter value)
    - href: string (navigation target)
    - alert?: { count: number; severity: 'error' | 'warning' } (optional badge)
    - icon?: React.ReactNode (optional icon)

    Implementation:
    - Use Link from next/link for navigation
    - Use Card from @/components/ui/card
    - Display title in small text, count in large bold text
    - If alert prop, show badge in top-right corner:
      - error: red background (bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300)
      - warning: yellow background (bg-yellow-100 text-yellow-700)
    - Add hover:shadow-md transition for feedback
    - Support dark mode via dark: variants

    No 'use client' needed - this is a presentational component.
  </action>
  <verify>
    - File exists at src/components/admin/CounterCard.tsx
    - Exports CounterCard component
    - Uses Link for navigation
    - TypeScript compiles without errors
  </verify>
  <done>CounterCard component created with clickable navigation and alert badge support</done>
</task>

<task type="auto">
  <name>Task 2: Create AlertSection and QuickActions components</name>
  <files>
    src/components/admin/AlertSection.tsx
    src/components/admin/QuickActions.tsx
  </files>
  <action>
    AlertSection component:
    - Props: overdueProjects, stalledProjects, inactivePartners (arrays)
    - Display each category as expandable section
    - Show project/partner names as clickable links
    - Overdue: red text, link to project
    - Stalled (7+ days no activity): yellow text, link to project
    - Inactive partners: gray text, link to partner edit
    - Empty state: "Keine Warnungen" with checkmark icon

    QuickActions component:
    - Four buttons in responsive flex layout
    - "Neue Liegenschaft" -> /dashboard/admin/properties (or create modal)
    - "Neuer Partner" -> /partners
    - "Neues Projekt" -> /renovation-projects/new
    - "Neues Template" -> /templates/new
    - Each button: blue background, white text, hover state
    - Use lucide-react icons: Building2, Users, FolderPlus, FileText

    Both components: 'use client' only if needed for interactivity.
  </action>
  <verify>
    - AlertSection.tsx exists and exports AlertSection
    - QuickActions.tsx exists and exports QuickActions
    - TypeScript compiles without errors
  </verify>
  <done>AlertSection and QuickActions components created</done>
</task>

<task type="auto">
  <name>Task 3: Create admin dashboard page</name>
  <files>src/app/admin/page.tsx</files>
  <action>
    Create Server Component dashboard at src/app/admin/page.tsx:

    Data fetching (all in parallel via Promise.all):
    1. Count properties: supabase.from('properties').select('*', { count: 'exact', head: true })
    2. Count partners: supabase.from('partners').select('*', { count: 'exact', head: true })
    3. Count projects: supabase.from('renovation_projects').select('*', { count: 'exact', head: true })
    4. Count templates: supabase.from('templates').select('*', { count: 'exact', head: true })
    5. Overdue projects: deadline < now AND status != 'completed'
    6. Stalled projects: updated_at < (now - 7 days) AND status != 'completed'
    7. Inactive partners: is_active = false
    8. Empty properties: properties with no buildings (left join check)

    Layout:
    - Page title: "Admin Dashboard"
    - Counter cards in responsive grid: grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4
    - Cards: Properties, Partners, Projects, Templates
    - Alert badges on cards if issues exist
    - AlertSection below cards
    - QuickActions at bottom

    Role check: Verify user has admin/kewa role, redirect if not.
    Use createClient from @/lib/supabase/server for Server Component.
  </action>
  <verify>
    - File exists at src/app/admin/page.tsx
    - No 'use client' directive (Server Component)
    - Fetches all four counts
    - Responsive grid layout
    - `npm run build` compiles successfully
  </verify>
  <done>Admin dashboard page created with counters, alerts, and quick actions</done>
</task>

</tasks>

<verification>
- [ ] CounterCard component displays count and handles click navigation
- [ ] AlertSection shows categorized alerts
- [ ] QuickActions provides create buttons
- [ ] Dashboard page fetches counts via Server Component
- [ ] Responsive layout works: 4-col -> 2x2 -> stack
- [ ] npm run build succeeds
</verification>

<success_criteria>
ADMN-01 satisfied: Dashboard shows counts for properties, partners, projects, templates
ADMN-02 satisfied: Quick action buttons provide one-click access to common admin tasks
</success_criteria>

<output>
After completion, create `.planning/phases/17-admin-onboarding/17-02-SUMMARY.md`
</output>
