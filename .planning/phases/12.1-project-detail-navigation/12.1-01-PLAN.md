---
plan: 12.1-01
name: Project Detail Page & Navigation
phase: 12.1
wave: 1
depends_on: []
files_modified:
  - src/app/dashboard/projekte/[id]/page.tsx (NEW)
  - src/app/dashboard/projekte/page.tsx
  - src/app/renovation-projects/[id]/apply-template/page.tsx
autonomous: true
estimated_tokens: 4000
scope: small
---

# Plan 12.1-01: Project Detail Page & Navigation

## Objective

Close integration gap INT-01 by creating a project detail page and fixing navigation paths so users can:
1. Navigate from project list to project detail
2. Access "Vorlage anwenden" button from project detail
3. Return to project detail after template application

## Context

**Gap from Milestone Audit:**
- Template application exists at `/renovation-projects/[id]/apply-template`
- But no navigation path to reach it
- No `/dashboard/projekte/[id]` project detail page exists

**Affected Flow:** Create Project → Apply Template → Generate Tasks

## Tasks

<task id="1">
<title>Create Project Detail Page</title>
<type>create</type>
<file>src/app/dashboard/projekte/[id]/page.tsx</file>
<description>
Create server async component following the pattern from `/dashboard/wohnungen/[id]/page.tsx`.

Page structure:
1. Session validation (redirect to /login if no session)
2. Fetch renovation project data via API or direct query
3. Breadcrumb navigation: Dashboard → Projekte → {Project Name}
4. Project info card showing:
   - Name, status, description
   - Unit (linked)
   - Planned/actual dates
   - Template status (applied or not)
5. Action buttons:
   - "Vorlage anwenden" (if status='planned' AND no template_id)
   - "Aufgaben anzeigen" (always, links to tasks filtered by unit)
   - "Kosten anzeigen" (links to cost detail)
6. Back link to projects list

Data to fetch:
- renovation_project with unit join
- Use `/api/renovation-projects/${id}` or direct Supabase query

Status badge colors:
- planned: blue
- active: green
- blocked: yellow
- finished: gray
- approved: green with checkmark

Dark mode support required.
</description>
</task>

<task id="2">
<title>Update Projects List Navigation</title>
<type>modify</type>
<file>src/app/dashboard/projekte/page.tsx</file>
<description>
Change the `handleProjectClick` function (line 136-138) to navigate to project detail instead of tasks:

Current:
```typescript
const handleProjectClick = (project: ProjectWithUnit) => {
  router.push(`/dashboard/aufgaben?unit_id=${project.unit_id}`)
}
```

Change to:
```typescript
const handleProjectClick = (project: ProjectWithUnit) => {
  router.push(`/dashboard/projekte/${project.id}`)
}
```

This enables the flow: Projects list → Project detail → Apply template
</description>
</task>

<task id="3">
<title>Fix Apply-Template Redirect URLs</title>
<type>modify</type>
<file>src/app/renovation-projects/[id]/apply-template/page.tsx</file>
<description>
Update all redirect URLs from `/dashboard/projects/${projectId}` to `/dashboard/projekte/${projectId}` (German URL pattern).

Lines to update:
- Line 58: `handleSuccess` - change to `/dashboard/projekte/${projectId}`
- Line 63: `handleCancel` - change to `/dashboard/projekte/${projectId}`
- Line 121: Link href in "template already applied" message
- Line 147: Link href in "status not valid" message

This ensures users return to the correct German-language URL after template operations.
</description>
</task>

<task id="4">
<title>Verify E2E Flow Works</title>
<type>verify</type>
<description>
Manual verification that Flow 1 now works end-to-end:

1. Navigate to /dashboard/projekte
2. Click on any project card → should navigate to /dashboard/projekte/[id]
3. See project detail page with info and action buttons
4. If project has no template and status='planned':
   - Click "Vorlage anwenden" → should navigate to apply-template page
5. After applying template (or canceling):
   - Should return to /dashboard/projekte/[id]

Check all navigation paths work correctly.
</description>
</task>

## Verification Criteria

```yaml
automated:
  - file_exists: src/app/dashboard/projekte/[id]/page.tsx
  - file_contains:
      path: src/app/dashboard/projekte/page.tsx
      pattern: "router.push\\(`/dashboard/projekte/\\$\\{project\\.id\\}`\\)"
  - file_contains:
      path: src/app/renovation-projects/[id]/apply-template/page.tsx
      pattern: "/dashboard/projekte/"
  - no_pattern:
      path: src/app/renovation-projects/[id]/apply-template/page.tsx
      pattern: "/dashboard/projects/"

manual:
  - "Projects list cards navigate to detail page"
  - "Project detail page displays project info"
  - "'Vorlage anwenden' button visible when appropriate"
  - "Template wizard returns to project detail"
```

## must_haves

These are the non-negotiable deliverables that define success:

1. **Project detail page exists** at `/dashboard/projekte/[id]`
2. **"Vorlage anwenden" button** links to apply-template page when eligible
3. **Project list navigation** goes to detail page (not tasks)
4. **Post-template redirect** returns to German URL `/dashboard/projekte/[id]`
5. **Flow 1 complete**: Create Project → View Detail → Apply Template → Return to Detail

## Implementation Notes

### Pattern Reference
Follow server component pattern from `/dashboard/wohnungen/[id]/page.tsx`:
- `interface PageProps { params: Promise<{ id: string }> }`
- `export default async function Page({ params }: PageProps)`
- Session check via cookies
- Breadcrumb navigation
- Action buttons as Link components

### Data Source
The `/api/renovation-projects/[id]` API already exists and returns:
```typescript
{
  project: {
    id, name, description, status, template_id,
    planned_start_date, planned_end_date,
    actual_start_date, actual_end_date,
    created_at, updated_at,
    unit: { id, name, unit_type, floor }
  }
}
```

Can use this API or query directly with Supabase client.

### Styling
- Use existing Tailwind patterns
- Dark mode with `dark:` variants
- Card from `@/components/ui/card`
- Status colors matching existing conventions

## Rollback

If issues occur:
1. Revert `handleProjectClick` to navigate to tasks (original behavior)
2. Project detail page is additive, can be removed without breaking existing functionality
3. Apply-template redirects can temporarily point to `/dashboard` as fallback
