---
phase: 08
plan: 01
name: Template Schema & Types
wave: 1
depends_on: []
scope: medium
autonomous: true
files_modified:
  - supabase/migrations/032_templates.sql
  - supabase/migrations/033_template_triggers.sql
  - src/types/index.ts
  - src/types/database.ts
  - src/types/templates.ts
requirements:
  - TMPL-01
  - TMPL-02
  - TMPL-03
---

# 08-01: Template Schema & Types

## Objective

Create the database foundation for the Template System with 6 new tables implementing a 3-level WBS hierarchy (Template > Phase > Package > Task). This establishes the core data model supporting both complete renovation templates (TMPL-01) and room-specific templates (TMPL-02) with the full WBS structure (TMPL-03).

## Tasks

<task id="1" title="Create template enum types">
Add new enum types to support the template system.

Create migration `supabase/migrations/032_templates.sql`:

```sql
-- Template categorization
CREATE TYPE template_category AS ENUM (
  'complete_renovation',    -- Komplett-Renovation
  'room_specific',          -- Raum-spezifisch (Bad, Kueche, etc.)
  'trade_specific'          -- Gewerk-spezifisch (Malerarbeiten, etc.)
);

-- Template scope (unit vs room level)
CREATE TYPE template_scope AS ENUM (
  'unit',      -- Applies to entire unit
  'room'       -- Applies to specific room type
);

-- Dependency types (standard project management)
CREATE TYPE dependency_type AS ENUM ('FS', 'SS', 'FF', 'SF');

-- Quality gate levels
CREATE TYPE gate_level AS ENUM ('package', 'phase');
```
</task>

<task id="2" title="Create templates table" depends_on="1">
Create the root templates table that holds renovation template metadata.

In `supabase/migrations/032_templates.sql`:

```sql
CREATE TABLE templates (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),

  -- Identification
  name TEXT NOT NULL,
  description TEXT,
  category template_category NOT NULL,
  scope template_scope NOT NULL,

  -- For room-scoped templates
  target_room_type room_type,

  -- Calculated fields (updated by trigger)
  total_duration_days INTEGER,
  total_estimated_cost DECIMAL(12,2),

  -- Metadata
  is_active BOOLEAN DEFAULT true,
  created_by UUID REFERENCES users(id),
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- Indexes
CREATE INDEX idx_templates_category ON templates(category);
CREATE INDEX idx_templates_scope ON templates(scope);
CREATE INDEX idx_templates_active ON templates(is_active);
CREATE INDEX idx_templates_target_room ON templates(target_room_type) WHERE target_room_type IS NOT NULL;

-- Timestamp trigger
CREATE TRIGGER templates_updated_at
  BEFORE UPDATE ON templates
  FOR EACH ROW EXECUTE FUNCTION update_updated_at();
```
</task>

<task id="3" title="Create template_phases table" depends_on="2">
Create the WBS Level 1 table for template phases.

In `supabase/migrations/032_templates.sql`:

```sql
CREATE TABLE template_phases (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  template_id UUID NOT NULL REFERENCES templates(id) ON DELETE CASCADE,

  -- Identification
  name TEXT NOT NULL,
  description TEXT,
  sort_order INTEGER NOT NULL DEFAULT 0,

  -- WBS code (e.g., "1", "2", "3")
  wbs_code TEXT NOT NULL,

  -- Scheduling (calculated from packages/tasks)
  estimated_duration_days INTEGER,

  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW(),

  UNIQUE(template_id, wbs_code)
);

-- Indexes
CREATE INDEX idx_template_phases_template ON template_phases(template_id);
CREATE INDEX idx_template_phases_sort ON template_phases(template_id, sort_order);

-- Timestamp trigger
CREATE TRIGGER template_phases_updated_at
  BEFORE UPDATE ON template_phases
  FOR EACH ROW EXECUTE FUNCTION update_updated_at();
```
</task>

<task id="4" title="Create template_packages table" depends_on="3">
Create the WBS Level 2 table for template packages.

In `supabase/migrations/032_templates.sql`:

```sql
CREATE TABLE template_packages (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  phase_id UUID NOT NULL REFERENCES template_phases(id) ON DELETE CASCADE,

  -- Identification
  name TEXT NOT NULL,
  description TEXT,
  sort_order INTEGER NOT NULL DEFAULT 0,

  -- WBS code (e.g., "1.1", "1.2", "2.1")
  wbs_code TEXT NOT NULL,

  -- Trade association (optional)
  trade_category trade_category,

  -- Scheduling (calculated from tasks)
  estimated_duration_days INTEGER,
  estimated_cost DECIMAL(10,2),

  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW(),

  UNIQUE(phase_id, wbs_code)
);

-- Indexes
CREATE INDEX idx_template_packages_phase ON template_packages(phase_id);
CREATE INDEX idx_template_packages_sort ON template_packages(phase_id, sort_order);
CREATE INDEX idx_template_packages_trade ON template_packages(trade_category) WHERE trade_category IS NOT NULL;

-- Timestamp trigger
CREATE TRIGGER template_packages_updated_at
  BEFORE UPDATE ON template_packages
  FOR EACH ROW EXECUTE FUNCTION update_updated_at();
```
</task>

<task id="5" title="Create template_tasks table" depends_on="4">
Create the WBS Level 3 table for template tasks (work packages).

In `supabase/migrations/032_templates.sql`:

```sql
CREATE TABLE template_tasks (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  package_id UUID NOT NULL REFERENCES template_packages(id) ON DELETE CASCADE,

  -- Identification
  name TEXT NOT NULL,
  description TEXT,
  sort_order INTEGER NOT NULL DEFAULT 0,

  -- WBS code (e.g., "1.1.1", "1.1.2")
  wbs_code TEXT NOT NULL,

  -- Scheduling
  estimated_duration_days INTEGER NOT NULL DEFAULT 1,
  estimated_cost DECIMAL(10,2),

  -- Trade association
  trade_category trade_category,

  -- Task attributes
  is_optional BOOLEAN DEFAULT false,
  materials_list JSONB DEFAULT '[]'::JSONB,
  notes TEXT,

  -- Checklist template (copied to task on application)
  checklist_template JSONB DEFAULT '[]'::JSONB,

  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW(),

  UNIQUE(package_id, wbs_code)
);

-- Indexes
CREATE INDEX idx_template_tasks_package ON template_tasks(package_id);
CREATE INDEX idx_template_tasks_sort ON template_tasks(package_id, sort_order);
CREATE INDEX idx_template_tasks_optional ON template_tasks(is_optional) WHERE is_optional = true;

-- Timestamp trigger
CREATE TRIGGER template_tasks_updated_at
  BEFORE UPDATE ON template_tasks
  FOR EACH ROW EXECUTE FUNCTION update_updated_at();
```
</task>

<task id="6" title="Create template_dependencies table" depends_on="5">
Create the dependencies table linking tasks across any package/phase.

In `supabase/migrations/032_templates.sql`:

```sql
CREATE TABLE template_dependencies (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  template_id UUID NOT NULL REFERENCES templates(id) ON DELETE CASCADE,

  -- Dependencies link tasks (across any package/phase)
  predecessor_task_id UUID NOT NULL REFERENCES template_tasks(id) ON DELETE CASCADE,
  successor_task_id UUID NOT NULL REFERENCES template_tasks(id) ON DELETE CASCADE,

  -- Dependency type
  dependency_type dependency_type NOT NULL DEFAULT 'FS',

  -- Lag time (days)
  lag_days INTEGER DEFAULT 0,

  created_at TIMESTAMPTZ DEFAULT NOW(),

  -- Prevent duplicate dependencies
  UNIQUE(predecessor_task_id, successor_task_id),

  -- Prevent self-reference
  CHECK(predecessor_task_id != successor_task_id)
);

-- Indexes
CREATE INDEX idx_template_dependencies_template ON template_dependencies(template_id);
CREATE INDEX idx_template_dependencies_predecessor ON template_dependencies(predecessor_task_id);
CREATE INDEX idx_template_dependencies_successor ON template_dependencies(successor_task_id);
```
</task>

<task id="7" title="Create template_quality_gates table" depends_on="6">
Create the quality gates table for package and phase checkpoints.

In `supabase/migrations/032_templates.sql`:

```sql
CREATE TABLE template_quality_gates (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  template_id UUID NOT NULL REFERENCES templates(id) ON DELETE CASCADE,

  -- Gate location
  gate_level gate_level NOT NULL,
  phase_id UUID REFERENCES template_phases(id) ON DELETE CASCADE,
  package_id UUID REFERENCES template_packages(id) ON DELETE CASCADE,

  -- Gate definition
  name TEXT NOT NULL,
  description TEXT,

  -- Evidence requirements
  checklist_items JSONB NOT NULL DEFAULT '[]'::JSONB,
  min_photos_required INTEGER DEFAULT 0,
  photo_types JSONB DEFAULT '["completion"]'::JSONB,

  -- Behavior
  is_blocking BOOLEAN DEFAULT false,  -- Soft blocking by default
  auto_approve_when_complete BOOLEAN DEFAULT true,

  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW(),

  -- Ensure gate is linked to exactly one entity
  CHECK(
    (gate_level = 'package' AND package_id IS NOT NULL AND phase_id IS NULL) OR
    (gate_level = 'phase' AND phase_id IS NOT NULL AND package_id IS NULL)
  )
);

-- Indexes
CREATE INDEX idx_template_quality_gates_template ON template_quality_gates(template_id);
CREATE INDEX idx_template_quality_gates_phase ON template_quality_gates(phase_id) WHERE phase_id IS NOT NULL;
CREATE INDEX idx_template_quality_gates_package ON template_quality_gates(package_id) WHERE package_id IS NOT NULL;

-- Timestamp trigger
CREATE TRIGGER template_quality_gates_updated_at
  BEFORE UPDATE ON template_quality_gates
  FOR EACH ROW EXECUTE FUNCTION update_updated_at();
```
</task>

<task id="8" title="Add table comments" depends_on="7">
Add documentation comments to all template tables.

At the end of `supabase/migrations/032_templates.sql`:

```sql
-- Table comments
COMMENT ON TABLE templates IS 'Renovation template library with WBS structure';
COMMENT ON COLUMN templates.category IS 'Template type: complete_renovation, room_specific, or trade_specific';
COMMENT ON COLUMN templates.scope IS 'Whether template applies to unit level or specific room type';
COMMENT ON COLUMN templates.target_room_type IS 'Required when scope = room';
COMMENT ON COLUMN templates.total_duration_days IS 'Calculated from task durations (trigger updated)';
COMMENT ON COLUMN templates.total_estimated_cost IS 'Sum of all task estimated costs (trigger updated)';

COMMENT ON TABLE template_phases IS 'WBS Level 1: Major renovation phases';
COMMENT ON COLUMN template_phases.wbs_code IS 'Hierarchical code (e.g., 1, 2, 3)';
COMMENT ON COLUMN template_phases.estimated_duration_days IS 'Calculated from packages (trigger updated)';

COMMENT ON TABLE template_packages IS 'WBS Level 2: Work packages within phases';
COMMENT ON COLUMN template_packages.wbs_code IS 'Hierarchical code (e.g., 1.1, 1.2)';
COMMENT ON COLUMN template_packages.trade_category IS 'Optional trade association for the package';

COMMENT ON TABLE template_tasks IS 'WBS Level 3: Individual tasks/work items';
COMMENT ON COLUMN template_tasks.wbs_code IS 'Hierarchical code (e.g., 1.1.1, 1.1.2)';
COMMENT ON COLUMN template_tasks.is_optional IS 'Can be toggled off during template application';
COMMENT ON COLUMN template_tasks.materials_list IS 'JSONB array: [{id, name, quantity, unit, estimated_cost}]';
COMMENT ON COLUMN template_tasks.checklist_template IS 'JSONB array: [{id, text, required}]';

COMMENT ON TABLE template_dependencies IS 'Task dependencies within template';
COMMENT ON COLUMN template_dependencies.dependency_type IS 'FS=Finish-to-Start, SS=Start-to-Start, FF=Finish-to-Finish, SF=Start-to-Finish';
COMMENT ON COLUMN template_dependencies.lag_days IS 'Delay in days after dependency condition met';

COMMENT ON TABLE template_quality_gates IS 'Checkpoints at package or phase boundaries';
COMMENT ON COLUMN template_quality_gates.checklist_items IS 'JSONB array: [{id, text, required}]';
COMMENT ON COLUMN template_quality_gates.photo_types IS 'JSONB array of required photo types';
COMMENT ON COLUMN template_quality_gates.is_blocking IS 'If true, blocks progression (soft blocking default)';
```
</task>

<task id="9" title="Create duration calculation triggers" depends_on="8">
Create a separate migration for triggers that calculate durations up the hierarchy.

Create `supabase/migrations/033_template_triggers.sql`:

```sql
-- KEWA Renovations Operations System
-- Migration: 033_template_triggers.sql
-- Template duration and cost calculation triggers

-- =============================================
-- PACKAGE DURATION/COST CALCULATION
-- =============================================

CREATE OR REPLACE FUNCTION calculate_package_totals()
RETURNS TRIGGER AS $$
DECLARE
  v_package_id UUID;
BEGIN
  -- Get affected package
  v_package_id := COALESCE(NEW.package_id, OLD.package_id);

  -- Update package estimated duration (max of tasks, not sum - tasks can overlap)
  -- and estimated cost (sum of tasks)
  UPDATE template_packages
  SET
    estimated_duration_days = (
      SELECT COALESCE(MAX(estimated_duration_days), 0)
      FROM template_tasks
      WHERE package_id = v_package_id
    ),
    estimated_cost = (
      SELECT COALESCE(SUM(estimated_cost), 0)
      FROM template_tasks
      WHERE package_id = v_package_id
    )
  WHERE id = v_package_id;

  RETURN COALESCE(NEW, OLD);
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trigger_calculate_package_totals
AFTER INSERT OR UPDATE OR DELETE ON template_tasks
FOR EACH ROW EXECUTE FUNCTION calculate_package_totals();

-- =============================================
-- PHASE DURATION CALCULATION
-- =============================================

CREATE OR REPLACE FUNCTION calculate_phase_totals()
RETURNS TRIGGER AS $$
DECLARE
  v_phase_id UUID;
BEGIN
  -- Get affected phase
  v_phase_id := COALESCE(NEW.phase_id, OLD.phase_id);

  -- Update phase estimated duration (sum of packages - sequential)
  UPDATE template_phases
  SET estimated_duration_days = (
    SELECT COALESCE(SUM(estimated_duration_days), 0)
    FROM template_packages
    WHERE phase_id = v_phase_id
  )
  WHERE id = v_phase_id;

  RETURN COALESCE(NEW, OLD);
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trigger_calculate_phase_totals
AFTER INSERT OR UPDATE OR DELETE ON template_packages
FOR EACH ROW EXECUTE FUNCTION calculate_phase_totals();

-- =============================================
-- TEMPLATE DURATION/COST CALCULATION
-- =============================================

CREATE OR REPLACE FUNCTION calculate_template_totals()
RETURNS TRIGGER AS $$
DECLARE
  v_template_id UUID;
BEGIN
  -- Get affected template
  v_template_id := COALESCE(NEW.template_id, OLD.template_id);

  -- Update template totals
  UPDATE templates
  SET
    total_duration_days = (
      SELECT COALESCE(SUM(estimated_duration_days), 0)
      FROM template_phases
      WHERE template_id = v_template_id
    ),
    total_estimated_cost = (
      SELECT COALESCE(SUM(estimated_cost), 0)
      FROM template_packages tp
      JOIN template_phases tph ON tph.id = tp.phase_id
      WHERE tph.template_id = v_template_id
    )
  WHERE id = v_template_id;

  RETURN COALESCE(NEW, OLD);
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trigger_calculate_template_totals
AFTER INSERT OR UPDATE OR DELETE ON template_phases
FOR EACH ROW EXECUTE FUNCTION calculate_template_totals();

-- Also trigger on package changes for cost updates
CREATE TRIGGER trigger_calculate_template_totals_on_package
AFTER INSERT OR UPDATE OR DELETE ON template_packages
FOR EACH ROW
EXECUTE FUNCTION calculate_template_totals();

-- =============================================
-- COMMENTS
-- =============================================

COMMENT ON FUNCTION calculate_package_totals() IS 'Updates package duration (max of tasks) and cost (sum of tasks)';
COMMENT ON FUNCTION calculate_phase_totals() IS 'Updates phase duration (sum of packages)';
COMMENT ON FUNCTION calculate_template_totals() IS 'Updates template totals from phases';
```
</task>

<task id="10" title="Add TypeScript enum types" depends_on="1">
Add new enum types to `src/types/index.ts`.

Add after the existing types (around line 149):

```typescript
// =============================================
// TEMPLATE SYSTEM TYPES (Phase 08)
// =============================================

// Template categorization
export type TemplateCategory =
  | 'complete_renovation'    // Komplett-Renovation
  | 'room_specific'          // Raum-spezifisch (Bad, Kueche, etc.)
  | 'trade_specific'         // Gewerk-spezifisch (Malerarbeiten, etc.)

// Template scope
export type TemplateScope = 'unit' | 'room'

// Dependency types (standard project management)
export type DependencyType = 'FS' | 'SS' | 'FF' | 'SF'

// Quality gate levels
export type GateLevel = 'package' | 'phase'
```
</task>

<task id="11" title="Create template TypeScript interfaces" depends_on="10">
Create new file `src/types/templates.ts` with all template-related interfaces.

```typescript
/**
 * Template System types (Phase 08)
 *
 * These interfaces represent the template tables and related
 * structures for the WBS-based renovation template system.
 */

import type {
  TemplateCategory,
  TemplateScope,
  DependencyType,
  GateLevel,
  RoomType,
  TradeCategory
} from './index'

// =============================================
// JSONB STRUCTURE TYPES
// =============================================

/**
 * Material item in template task materials list
 */
export interface TemplateMaterialItem {
  id: string
  name: string
  quantity: number
  unit: string
  estimated_cost?: number
}

/**
 * Checklist item template (used in both tasks and gates)
 */
export interface TemplateChecklistItem {
  id: string
  text: string
  required: boolean
}

// =============================================
// CORE TEMPLATE ENTITIES
// =============================================

/**
 * Root template entity
 */
export interface Template {
  id: string
  name: string
  description: string | null
  category: TemplateCategory
  scope: TemplateScope
  target_room_type: RoomType | null
  total_duration_days: number | null
  total_estimated_cost: number | null
  is_active: boolean
  created_by: string | null
  created_at: string
  updated_at: string
}

/**
 * WBS Level 1: Template phase
 */
export interface TemplatePhase {
  id: string
  template_id: string
  name: string
  description: string | null
  sort_order: number
  wbs_code: string
  estimated_duration_days: number | null
  created_at: string
  updated_at: string
}

/**
 * WBS Level 2: Template package
 */
export interface TemplatePackage {
  id: string
  phase_id: string
  name: string
  description: string | null
  sort_order: number
  wbs_code: string
  trade_category: TradeCategory | null
  estimated_duration_days: number | null
  estimated_cost: number | null
  created_at: string
  updated_at: string
}

/**
 * WBS Level 3: Template task (work item)
 */
export interface TemplateTask {
  id: string
  package_id: string
  name: string
  description: string | null
  sort_order: number
  wbs_code: string
  estimated_duration_days: number
  estimated_cost: number | null
  trade_category: TradeCategory | null
  is_optional: boolean
  materials_list: TemplateMaterialItem[]
  notes: string | null
  checklist_template: TemplateChecklistItem[]
  created_at: string
  updated_at: string
}

/**
 * Task dependency relationship
 */
export interface TemplateDependency {
  id: string
  template_id: string
  predecessor_task_id: string
  successor_task_id: string
  dependency_type: DependencyType
  lag_days: number
  created_at: string
}

/**
 * Quality gate at package or phase boundary
 */
export interface TemplateQualityGate {
  id: string
  template_id: string
  gate_level: GateLevel
  phase_id: string | null
  package_id: string | null
  name: string
  description: string | null
  checklist_items: TemplateChecklistItem[]
  min_photos_required: number
  photo_types: string[]
  is_blocking: boolean
  auto_approve_when_complete: boolean
  created_at: string
  updated_at: string
}

// =============================================
// NESTED/HIERARCHY TYPES
// =============================================

/**
 * Template task with parent package reference
 */
export interface TemplateTaskWithPackage extends TemplateTask {
  package: {
    id: string
    name: string
    wbs_code: string
    phase_id: string
  }
}

/**
 * Template package with nested tasks
 */
export interface TemplatePackageWithTasks extends TemplatePackage {
  tasks: TemplateTask[]
}

/**
 * Template phase with nested packages and tasks
 */
export interface TemplatePhaseWithPackages extends TemplatePhase {
  packages: TemplatePackageWithTasks[]
}

/**
 * Full template with complete hierarchy
 */
export interface TemplateWithHierarchy extends Template {
  phases: TemplatePhaseWithPackages[]
  dependencies: TemplateDependency[]
  quality_gates: TemplateQualityGate[]
}

// =============================================
// API INPUT TYPES
// =============================================

/**
 * Input for creating a new template
 */
export interface CreateTemplateInput {
  name: string
  description?: string
  category: TemplateCategory
  scope: TemplateScope
  target_room_type?: RoomType
}

/**
 * Input for updating a template
 */
export interface UpdateTemplateInput {
  name?: string
  description?: string
  category?: TemplateCategory
  scope?: TemplateScope
  target_room_type?: RoomType | null
  is_active?: boolean
}

/**
 * Input for creating a template phase
 */
export interface CreateTemplatePhaseInput {
  template_id: string
  name: string
  description?: string
  wbs_code: string
  sort_order?: number
}

/**
 * Input for creating a template package
 */
export interface CreateTemplatePackageInput {
  phase_id: string
  name: string
  description?: string
  wbs_code: string
  sort_order?: number
  trade_category?: TradeCategory
}

/**
 * Input for creating a template task
 */
export interface CreateTemplateTaskInput {
  package_id: string
  name: string
  description?: string
  wbs_code: string
  sort_order?: number
  estimated_duration_days?: number
  estimated_cost?: number
  trade_category?: TradeCategory
  is_optional?: boolean
  materials_list?: TemplateMaterialItem[]
  notes?: string
  checklist_template?: TemplateChecklistItem[]
}

/**
 * Input for creating a dependency
 */
export interface CreateTemplateDependencyInput {
  template_id: string
  predecessor_task_id: string
  successor_task_id: string
  dependency_type?: DependencyType
  lag_days?: number
}

/**
 * Input for creating a quality gate
 */
export interface CreateTemplateQualityGateInput {
  template_id: string
  gate_level: GateLevel
  phase_id?: string
  package_id?: string
  name: string
  description?: string
  checklist_items?: TemplateChecklistItem[]
  min_photos_required?: number
  photo_types?: string[]
  is_blocking?: boolean
  auto_approve_when_complete?: boolean
}

// =============================================
// API RESPONSE TYPES
// =============================================

/**
 * Response for template list
 */
export interface TemplatesResponse {
  templates: Template[]
}

/**
 * Response for single template
 */
export interface TemplateResponse {
  template: Template
}

/**
 * Response for template with full hierarchy
 */
export interface TemplateWithHierarchyResponse {
  template: TemplateWithHierarchy
}

/**
 * Response for template phases list
 */
export interface TemplatePhasesResponse {
  phases: TemplatePhase[]
}

/**
 * Response for template packages list
 */
export interface TemplatePackagesResponse {
  packages: TemplatePackage[]
}

/**
 * Response for template tasks list
 */
export interface TemplateTasksResponse {
  tasks: TemplateTask[]
}

/**
 * Response for dependencies list
 */
export interface TemplateDependenciesResponse {
  dependencies: TemplateDependency[]
}

/**
 * Response for quality gates list
 */
export interface TemplateQualityGatesResponse {
  quality_gates: TemplateQualityGate[]
}
```
</task>

<task id="12" title="Export template types from database.ts" depends_on="11">
Add template type exports to `src/types/database.ts`.

At the end of the file, add:

```typescript
// =============================================
// TEMPLATE SYSTEM TYPES (Phase 08)
// =============================================

// Re-export all template types from templates.ts
export type {
  TemplateMaterialItem,
  TemplateChecklistItem,
  Template,
  TemplatePhase,
  TemplatePackage,
  TemplateTask,
  TemplateDependency,
  TemplateQualityGate,
  TemplateTaskWithPackage,
  TemplatePackageWithTasks,
  TemplatePhaseWithPackages,
  TemplateWithHierarchy,
  CreateTemplateInput,
  UpdateTemplateInput,
  CreateTemplatePhaseInput,
  CreateTemplatePackageInput,
  CreateTemplateTaskInput,
  CreateTemplateDependencyInput,
  CreateTemplateQualityGateInput,
  TemplatesResponse,
  TemplateResponse,
  TemplateWithHierarchyResponse,
  TemplatePhasesResponse,
  TemplatePackagesResponse,
  TemplateTasksResponse,
  TemplateDependenciesResponse,
  TemplateQualityGatesResponse
} from './templates'
```
</task>

## Verification

- [ ] Migration 032_templates.sql creates all 6 tables without errors
- [ ] Migration 033_template_triggers.sql creates all calculation triggers
- [ ] All foreign key constraints are properly defined with CASCADE delete
- [ ] Unique constraints on WBS codes within parent scope
- [ ] Check constraint on quality_gates ensures exactly one parent reference
- [ ] TypeScript compiles without errors after type additions
- [ ] Template types are properly exported from both index.ts and database.ts

## Must Haves

These are goal-backward success criteria derived from TMPL-01, TMPL-02, TMPL-03:

- [ ] Templates table supports both complete_renovation and room_specific categories (TMPL-01, TMPL-02)
- [ ] 3-level WBS hierarchy is fully represented: Phase > Package > Task (TMPL-03)
- [ ] Template scope distinguishes unit-level vs room-level templates
- [ ] Room-specific templates can target specific room types (bathroom, kitchen, etc.)
- [ ] All JSONB structures have documented TypeScript interfaces
- [ ] Calculated fields (duration, cost) are automatically updated via triggers
