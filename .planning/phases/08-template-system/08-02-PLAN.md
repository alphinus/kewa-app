---
phase: 08
plan: 02
name: Template CRUD & Library UI
wave: 1
depends_on: []
scope: large
autonomous: true
files_modified:
  - src/app/api/templates/route.ts
  - src/app/api/templates/[id]/route.ts
  - src/app/api/templates/[id]/phases/route.ts
  - src/app/api/templates/[id]/packages/route.ts
  - src/app/api/templates/[id]/tasks/route.ts
  - src/app/templates/page.tsx
  - src/app/templates/[id]/page.tsx
  - src/app/templates/[id]/edit/page.tsx
  - src/components/templates/TemplateCard.tsx
  - src/components/templates/TemplateEditor.tsx
  - src/components/templates/WBSTree.tsx
  - src/lib/api/templates.ts
  - supabase/migrations/034_seed_templates.sql
requirements:
  - TMPL-01
  - TMPL-02
  - TMPL-03
---

# 08-02: Template CRUD & Library UI

## Objective

Implement the complete CRUD API and admin UI for the Template Library. This includes API routes for all template entities (templates, phases, packages, tasks), a library view showing available templates by category, and an editor interface for building templates with the WBS hierarchy. Seed data provides 3 starter templates (Komplett-Renovation, Bad, Kueche) to fulfill TMPL-01 and TMPL-02.

## Tasks

<task id="1" title="Create templates list API route">
Create `src/app/api/templates/route.ts` with GET (list) and POST (create) handlers.

```typescript
import { NextRequest, NextResponse } from 'next/server'
import { createClient } from '@/lib/supabase/server'
import { getValidatedSession } from '@/lib/auth/session'
import type { CreateTemplateInput } from '@/types/templates'

// GET /api/templates - List all templates
export async function GET(request: NextRequest) {
  const session = await getValidatedSession()
  if (!session) {
    return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })
  }

  const supabase = await createClient()
  const { searchParams } = new URL(request.url)

  // Filter options
  const category = searchParams.get('category')
  const scope = searchParams.get('scope')
  const activeOnly = searchParams.get('active') !== 'false'

  let query = supabase
    .from('templates')
    .select('*')
    .order('category')
    .order('name')

  if (activeOnly) {
    query = query.eq('is_active', true)
  }
  if (category) {
    query = query.eq('category', category)
  }
  if (scope) {
    query = query.eq('scope', scope)
  }

  const { data, error } = await query

  if (error) {
    return NextResponse.json({ error: error.message }, { status: 500 })
  }

  return NextResponse.json({ templates: data })
}

// POST /api/templates - Create new template (admin only)
export async function POST(request: NextRequest) {
  const session = await getValidatedSession()
  if (!session) {
    return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })
  }

  // Check admin permission
  if (session.role !== 'kewa') {
    return NextResponse.json({ error: 'Admin access required' }, { status: 403 })
  }

  const body: CreateTemplateInput = await request.json()

  // Validate required fields
  if (!body.name || !body.category || !body.scope) {
    return NextResponse.json(
      { error: 'name, category, and scope are required' },
      { status: 400 }
    )
  }

  // Validate room scope requires target_room_type
  if (body.scope === 'room' && !body.target_room_type) {
    return NextResponse.json(
      { error: 'target_room_type required for room-scoped templates' },
      { status: 400 }
    )
  }

  const supabase = await createClient()

  const { data, error } = await supabase
    .from('templates')
    .insert({
      name: body.name,
      description: body.description,
      category: body.category,
      scope: body.scope,
      target_room_type: body.target_room_type,
      created_by: session.userId
    })
    .select()
    .single()

  if (error) {
    return NextResponse.json({ error: error.message }, { status: 500 })
  }

  return NextResponse.json({ template: data }, { status: 201 })
}
```
</task>

<task id="2" title="Create single template API route" depends_on="1">
Create `src/app/api/templates/[id]/route.ts` with GET, PATCH, DELETE handlers.

```typescript
import { NextRequest, NextResponse } from 'next/server'
import { createClient } from '@/lib/supabase/server'
import { getValidatedSession } from '@/lib/auth/session'
import type { UpdateTemplateInput } from '@/types/templates'

interface RouteParams {
  params: Promise<{ id: string }>
}

// GET /api/templates/[id] - Get template with full hierarchy
export async function GET(request: NextRequest, { params }: RouteParams) {
  const session = await getValidatedSession()
  if (!session) {
    return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })
  }

  const { id } = await params
  const supabase = await createClient()

  // Fetch template with full nested hierarchy
  const { data, error } = await supabase
    .from('templates')
    .select(`
      *,
      phases:template_phases (
        *,
        packages:template_packages (
          *,
          tasks:template_tasks (*)
        )
      ),
      dependencies:template_dependencies (*),
      quality_gates:template_quality_gates (*)
    `)
    .eq('id', id)
    .order('sort_order', { referencedTable: 'template_phases' })
    .order('sort_order', { referencedTable: 'template_phases.template_packages' })
    .order('sort_order', { referencedTable: 'template_phases.template_packages.template_tasks' })
    .single()

  if (error) {
    if (error.code === 'PGRST116') {
      return NextResponse.json({ error: 'Template not found' }, { status: 404 })
    }
    return NextResponse.json({ error: error.message }, { status: 500 })
  }

  return NextResponse.json({ template: data })
}

// PATCH /api/templates/[id] - Update template (admin only)
export async function PATCH(request: NextRequest, { params }: RouteParams) {
  const session = await getValidatedSession()
  if (!session) {
    return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })
  }

  if (session.role !== 'kewa') {
    return NextResponse.json({ error: 'Admin access required' }, { status: 403 })
  }

  const { id } = await params
  const body: UpdateTemplateInput = await request.json()
  const supabase = await createClient()

  const { data, error } = await supabase
    .from('templates')
    .update(body)
    .eq('id', id)
    .select()
    .single()

  if (error) {
    return NextResponse.json({ error: error.message }, { status: 500 })
  }

  return NextResponse.json({ template: data })
}

// DELETE /api/templates/[id] - Delete template (admin only)
export async function DELETE(request: NextRequest, { params }: RouteParams) {
  const session = await getValidatedSession()
  if (!session) {
    return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })
  }

  if (session.role !== 'kewa') {
    return NextResponse.json({ error: 'Admin access required' }, { status: 403 })
  }

  const { id } = await params
  const supabase = await createClient()

  const { error } = await supabase
    .from('templates')
    .delete()
    .eq('id', id)

  if (error) {
    return NextResponse.json({ error: error.message }, { status: 500 })
  }

  return NextResponse.json({ success: true })
}
```
</task>

<task id="3" title="Create template phases API route" depends_on="2">
Create `src/app/api/templates/[id]/phases/route.ts` for phase CRUD.

```typescript
import { NextRequest, NextResponse } from 'next/server'
import { createClient } from '@/lib/supabase/server'
import { getValidatedSession } from '@/lib/auth/session'
import type { CreateTemplatePhaseInput } from '@/types/templates'

interface RouteParams {
  params: Promise<{ id: string }>
}

// GET /api/templates/[id]/phases - List phases
export async function GET(request: NextRequest, { params }: RouteParams) {
  const session = await getValidatedSession()
  if (!session) {
    return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })
  }

  const { id } = await params
  const supabase = await createClient()

  const { data, error } = await supabase
    .from('template_phases')
    .select('*')
    .eq('template_id', id)
    .order('sort_order')

  if (error) {
    return NextResponse.json({ error: error.message }, { status: 500 })
  }

  return NextResponse.json({ phases: data })
}

// POST /api/templates/[id]/phases - Create phase (admin only)
export async function POST(request: NextRequest, { params }: RouteParams) {
  const session = await getValidatedSession()
  if (!session) {
    return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })
  }

  if (session.role !== 'kewa') {
    return NextResponse.json({ error: 'Admin access required' }, { status: 403 })
  }

  const { id } = await params
  const body: Omit<CreateTemplatePhaseInput, 'template_id'> = await request.json()

  if (!body.name || !body.wbs_code) {
    return NextResponse.json(
      { error: 'name and wbs_code are required' },
      { status: 400 }
    )
  }

  const supabase = await createClient()

  // Get next sort_order if not provided
  let sortOrder = body.sort_order
  if (sortOrder === undefined) {
    const { data: existing } = await supabase
      .from('template_phases')
      .select('sort_order')
      .eq('template_id', id)
      .order('sort_order', { ascending: false })
      .limit(1)
      .single()

    sortOrder = (existing?.sort_order ?? -1) + 1
  }

  const { data, error } = await supabase
    .from('template_phases')
    .insert({
      template_id: id,
      name: body.name,
      description: body.description,
      wbs_code: body.wbs_code,
      sort_order: sortOrder
    })
    .select()
    .single()

  if (error) {
    return NextResponse.json({ error: error.message }, { status: 500 })
  }

  return NextResponse.json({ phase: data }, { status: 201 })
}
```
</task>

<task id="4" title="Create template packages API route" depends_on="3">
Create `src/app/api/templates/[id]/packages/route.ts` for package CRUD.

Similar structure to phases route but for template_packages table.
Include phase_id in the request body for creating packages.

Key fields: phase_id, name, description, wbs_code, sort_order, trade_category
</task>

<task id="5" title="Create template tasks API route" depends_on="4">
Create `src/app/api/templates/[id]/tasks/route.ts` for task CRUD.

Similar structure for template_tasks table.
Include package_id in the request body.

Key fields: package_id, name, description, wbs_code, sort_order,
estimated_duration_days, estimated_cost, trade_category, is_optional,
materials_list, notes, checklist_template
</task>

<task id="6" title="Create template client library">
Create `src/lib/api/templates.ts` with client-side API functions.

```typescript
import type {
  Template,
  TemplateWithHierarchy,
  CreateTemplateInput,
  UpdateTemplateInput,
  TemplatePhase,
  CreateTemplatePhaseInput,
  TemplatePackage,
  CreateTemplatePackageInput,
  TemplateTask,
  CreateTemplateTaskInput,
  TemplateCategory,
  TemplateScope
} from '@/types/templates'

const API_BASE = '/api/templates'

// =============================================
// TEMPLATE OPERATIONS
// =============================================

export async function fetchTemplates(options?: {
  category?: TemplateCategory
  scope?: TemplateScope
  active?: boolean
}): Promise<Template[]> {
  const params = new URLSearchParams()
  if (options?.category) params.set('category', options.category)
  if (options?.scope) params.set('scope', options.scope)
  if (options?.active !== undefined) params.set('active', String(options.active))

  const url = params.toString() ? `${API_BASE}?${params}` : API_BASE
  const res = await fetch(url)
  if (!res.ok) throw new Error('Failed to fetch templates')
  const data = await res.json()
  return data.templates
}

export async function fetchTemplate(id: string): Promise<TemplateWithHierarchy> {
  const res = await fetch(`${API_BASE}/${id}`)
  if (!res.ok) throw new Error('Failed to fetch template')
  const data = await res.json()
  return data.template
}

export async function createTemplate(input: CreateTemplateInput): Promise<Template> {
  const res = await fetch(API_BASE, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(input)
  })
  if (!res.ok) {
    const error = await res.json()
    throw new Error(error.error || 'Failed to create template')
  }
  const data = await res.json()
  return data.template
}

export async function updateTemplate(
  id: string,
  input: UpdateTemplateInput
): Promise<Template> {
  const res = await fetch(`${API_BASE}/${id}`, {
    method: 'PATCH',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(input)
  })
  if (!res.ok) throw new Error('Failed to update template')
  const data = await res.json()
  return data.template
}

export async function deleteTemplate(id: string): Promise<void> {
  const res = await fetch(`${API_BASE}/${id}`, { method: 'DELETE' })
  if (!res.ok) throw new Error('Failed to delete template')
}

export async function duplicateTemplate(id: string): Promise<Template> {
  const res = await fetch(`${API_BASE}/${id}/duplicate`, { method: 'POST' })
  if (!res.ok) throw new Error('Failed to duplicate template')
  const data = await res.json()
  return data.template
}

// =============================================
// PHASE OPERATIONS
// =============================================

export async function createPhase(
  templateId: string,
  input: Omit<CreateTemplatePhaseInput, 'template_id'>
): Promise<TemplatePhase> {
  const res = await fetch(`${API_BASE}/${templateId}/phases`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(input)
  })
  if (!res.ok) throw new Error('Failed to create phase')
  const data = await res.json()
  return data.phase
}

export async function updatePhase(
  templateId: string,
  phaseId: string,
  input: Partial<TemplatePhase>
): Promise<TemplatePhase> {
  const res = await fetch(`${API_BASE}/${templateId}/phases/${phaseId}`, {
    method: 'PATCH',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(input)
  })
  if (!res.ok) throw new Error('Failed to update phase')
  const data = await res.json()
  return data.phase
}

export async function deletePhase(templateId: string, phaseId: string): Promise<void> {
  const res = await fetch(`${API_BASE}/${templateId}/phases/${phaseId}`, {
    method: 'DELETE'
  })
  if (!res.ok) throw new Error('Failed to delete phase')
}

// =============================================
// PACKAGE OPERATIONS
// =============================================

export async function createPackage(
  templateId: string,
  input: Omit<CreateTemplatePackageInput, 'template_id'>
): Promise<TemplatePackage> {
  const res = await fetch(`${API_BASE}/${templateId}/packages`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(input)
  })
  if (!res.ok) throw new Error('Failed to create package')
  const data = await res.json()
  return data.package
}

export async function updatePackage(
  templateId: string,
  packageId: string,
  input: Partial<TemplatePackage>
): Promise<TemplatePackage> {
  const res = await fetch(`${API_BASE}/${templateId}/packages/${packageId}`, {
    method: 'PATCH',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(input)
  })
  if (!res.ok) throw new Error('Failed to update package')
  const data = await res.json()
  return data.package
}

export async function deletePackage(templateId: string, packageId: string): Promise<void> {
  const res = await fetch(`${API_BASE}/${templateId}/packages/${packageId}`, {
    method: 'DELETE'
  })
  if (!res.ok) throw new Error('Failed to delete package')
}

// =============================================
// TASK OPERATIONS
// =============================================

export async function createTask(
  templateId: string,
  input: Omit<CreateTemplateTaskInput, 'template_id'>
): Promise<TemplateTask> {
  const res = await fetch(`${API_BASE}/${templateId}/tasks`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(input)
  })
  if (!res.ok) throw new Error('Failed to create task')
  const data = await res.json()
  return data.task
}

export async function updateTask(
  templateId: string,
  taskId: string,
  input: Partial<TemplateTask>
): Promise<TemplateTask> {
  const res = await fetch(`${API_BASE}/${templateId}/tasks/${taskId}`, {
    method: 'PATCH',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(input)
  })
  if (!res.ok) throw new Error('Failed to update task')
  const data = await res.json()
  return data.task
}

export async function deleteTask(templateId: string, taskId: string): Promise<void> {
  const res = await fetch(`${API_BASE}/${templateId}/tasks/${taskId}`, {
    method: 'DELETE'
  })
  if (!res.ok) throw new Error('Failed to delete task')
}
```
</task>

<task id="7" title="Create TemplateCard component" depends_on="6">
Create `src/components/templates/TemplateCard.tsx` for displaying template in library.

```typescript
'use client'

import Link from 'next/link'
import type { Template } from '@/types/templates'

interface TemplateCardProps {
  template: Template
  onDelete?: (id: string) => void
  isAdmin?: boolean
}

const categoryLabels: Record<string, string> = {
  complete_renovation: 'Komplett-Renovation',
  room_specific: 'Raum-spezifisch',
  trade_specific: 'Gewerk-spezifisch'
}

const roomTypeLabels: Record<string, string> = {
  bathroom: 'Bad',
  kitchen: 'Kueche',
  bedroom: 'Schlafzimmer',
  living_room: 'Wohnzimmer',
  hallway: 'Flur',
  balcony: 'Balkon',
  storage: 'Abstellraum',
  laundry: 'Waschkueche',
  garage: 'Garage',
  office: 'Buero',
  other: 'Andere'
}

export function TemplateCard({ template, onDelete, isAdmin }: TemplateCardProps) {
  const handleDelete = () => {
    if (onDelete && confirm('Template wirklich loeschen?')) {
      onDelete(template.id)
    }
  }

  return (
    <div className="bg-white rounded-lg shadow-sm border border-gray-200 p-4 hover:shadow-md transition-shadow">
      <div className="flex justify-between items-start mb-2">
        <h3 className="font-semibold text-lg text-gray-900">{template.name}</h3>
        <span className={`px-2 py-1 rounded text-xs font-medium ${
          template.is_active ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-600'
        }`}>
          {template.is_active ? 'Aktiv' : 'Inaktiv'}
        </span>
      </div>

      {template.description && (
        <p className="text-gray-600 text-sm mb-3 line-clamp-2">{template.description}</p>
      )}

      <div className="flex flex-wrap gap-2 mb-3">
        <span className="px-2 py-1 bg-blue-100 text-blue-800 rounded text-xs">
          {categoryLabels[template.category] || template.category}
        </span>
        {template.target_room_type && (
          <span className="px-2 py-1 bg-purple-100 text-purple-800 rounded text-xs">
            {roomTypeLabels[template.target_room_type] || template.target_room_type}
          </span>
        )}
      </div>

      <div className="flex items-center gap-4 text-sm text-gray-500 mb-4">
        {template.total_duration_days && (
          <span>{template.total_duration_days} Tage</span>
        )}
        {template.total_estimated_cost && (
          <span>CHF {template.total_estimated_cost.toLocaleString('de-CH')}</span>
        )}
      </div>

      <div className="flex gap-2">
        <Link
          href={`/templates/${template.id}`}
          className="flex-1 text-center py-2 px-3 bg-gray-100 hover:bg-gray-200 rounded text-sm font-medium text-gray-700 transition-colors"
        >
          Ansehen
        </Link>
        {isAdmin && (
          <>
            <Link
              href={`/templates/${template.id}/edit`}
              className="py-2 px-3 bg-blue-100 hover:bg-blue-200 rounded text-sm font-medium text-blue-700 transition-colors"
            >
              Bearbeiten
            </Link>
            <button
              onClick={handleDelete}
              className="py-2 px-3 bg-red-100 hover:bg-red-200 rounded text-sm font-medium text-red-700 transition-colors"
            >
              Loeschen
            </button>
          </>
        )}
      </div>
    </div>
  )
}
```
</task>

<task id="8" title="Create WBSTree component" depends_on="7">
Create `src/components/templates/WBSTree.tsx` for displaying WBS hierarchy.

Display phases, packages, and tasks in a collapsible tree structure.
Show WBS codes, names, durations, and optional task indicators.
Support expand/collapse at each level.
</task>

<task id="9" title="Create TemplateEditor component" depends_on="8">
Create `src/components/templates/TemplateEditor.tsx` for editing template structure.

Features:
- Add/edit/delete phases, packages, tasks
- Drag-and-drop reordering (optional - can use sort buttons initially)
- WBS code auto-generation
- Form dialogs for editing items
- Inline task editing
- Materials list editor
- Checklist template editor
</task>

<task id="10" title="Create template library page">
Create `src/app/templates/page.tsx` - the main template library view.

```typescript
'use client'

import { useState, useEffect } from 'react'
import { TemplateCard } from '@/components/templates/TemplateCard'
import { fetchTemplates, deleteTemplate } from '@/lib/api/templates'
import type { Template, TemplateCategory } from '@/types/templates'
import Link from 'next/link'

export default function TemplatesPage() {
  const [templates, setTemplates] = useState<Template[]>([])
  const [loading, setLoading] = useState(true)
  const [categoryFilter, setCategoryFilter] = useState<TemplateCategory | ''>('')
  const [isAdmin, setIsAdmin] = useState(false)

  useEffect(() => {
    loadTemplates()
    // Check if user is admin
    fetch('/api/auth/session')
      .then(r => r.json())
      .then(data => setIsAdmin(data.role === 'kewa'))
  }, [categoryFilter])

  async function loadTemplates() {
    setLoading(true)
    try {
      const data = await fetchTemplates(
        categoryFilter ? { category: categoryFilter } : undefined
      )
      setTemplates(data)
    } catch (error) {
      console.error('Failed to load templates:', error)
    } finally {
      setLoading(false)
    }
  }

  async function handleDelete(id: string) {
    try {
      await deleteTemplate(id)
      setTemplates(templates.filter(t => t.id !== id))
    } catch (error) {
      console.error('Failed to delete template:', error)
    }
  }

  // Group templates by category
  const grouped = templates.reduce((acc, template) => {
    const key = template.category
    if (!acc[key]) acc[key] = []
    acc[key].push(template)
    return acc
  }, {} as Record<string, Template[]>)

  const categoryTitles: Record<string, string> = {
    complete_renovation: 'Komplett-Renovationen',
    room_specific: 'Raum-spezifische Vorlagen',
    trade_specific: 'Gewerk-spezifische Vorlagen'
  }

  return (
    <div className="min-h-screen bg-gray-50 p-6">
      <div className="max-w-7xl mx-auto">
        <div className="flex justify-between items-center mb-6">
          <h1 className="text-2xl font-bold text-gray-900">Template-Bibliothek</h1>
          {isAdmin && (
            <Link
              href="/templates/new"
              className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
            >
              Neues Template
            </Link>
          )}
        </div>

        {/* Category filter */}
        <div className="mb-6 flex gap-2">
          <button
            onClick={() => setCategoryFilter('')}
            className={`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${
              categoryFilter === ''
                ? 'bg-blue-600 text-white'
                : 'bg-white text-gray-700 hover:bg-gray-100'
            }`}
          >
            Alle
          </button>
          <button
            onClick={() => setCategoryFilter('complete_renovation')}
            className={`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${
              categoryFilter === 'complete_renovation'
                ? 'bg-blue-600 text-white'
                : 'bg-white text-gray-700 hover:bg-gray-100'
            }`}
          >
            Komplett
          </button>
          <button
            onClick={() => setCategoryFilter('room_specific')}
            className={`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${
              categoryFilter === 'room_specific'
                ? 'bg-blue-600 text-white'
                : 'bg-white text-gray-700 hover:bg-gray-100'
            }`}
          >
            Raum-spezifisch
          </button>
          <button
            onClick={() => setCategoryFilter('trade_specific')}
            className={`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${
              categoryFilter === 'trade_specific'
                ? 'bg-blue-600 text-white'
                : 'bg-white text-gray-700 hover:bg-gray-100'
            }`}
          >
            Gewerk-spezifisch
          </button>
        </div>

        {loading ? (
          <div className="text-center py-12">
            <div className="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
            <p className="mt-2 text-gray-600">Lade Templates...</p>
          </div>
        ) : templates.length === 0 ? (
          <div className="text-center py-12 bg-white rounded-lg border border-gray-200">
            <p className="text-gray-600">Keine Templates gefunden</p>
            {isAdmin && (
              <Link
                href="/templates/new"
                className="mt-4 inline-block text-blue-600 hover:text-blue-700"
              >
                Erstes Template erstellen
              </Link>
            )}
          </div>
        ) : (
          <div className="space-y-8">
            {Object.entries(grouped).map(([category, categoryTemplates]) => (
              <section key={category}>
                <h2 className="text-lg font-semibold text-gray-800 mb-4">
                  {categoryTitles[category] || category}
                </h2>
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                  {categoryTemplates.map(template => (
                    <TemplateCard
                      key={template.id}
                      template={template}
                      onDelete={handleDelete}
                      isAdmin={isAdmin}
                    />
                  ))}
                </div>
              </section>
            ))}
          </div>
        )}
      </div>
    </div>
  )
}
```
</task>

<task id="11" title="Create template detail page" depends_on="10">
Create `src/app/templates/[id]/page.tsx` for viewing a single template.

Display:
- Template metadata (name, description, category, scope)
- Full WBS tree with phases, packages, tasks
- Total duration and cost
- Quality gates overview
- Dependencies list (or visual if Plan 08-04 provides Gantt)
- "Apply to Project" button (linking to Plan 08-03)
</task>

<task id="12" title="Create template edit page" depends_on="11">
Create `src/app/templates/[id]/edit/page.tsx` for editing templates.

Use TemplateEditor component with full CRUD functionality.
Admin-only access.
</task>

<task id="13" title="Create seed templates migration">
Create `supabase/migrations/034_seed_templates.sql` with 3 starter templates.

```sql
-- KEWA Renovations Operations System
-- Migration: 034_seed_templates.sql
-- Seed data: 3 starter templates (Komplett, Bad, Kueche)

-- =============================================
-- TEMPLATE 1: KOMPLETT-RENOVATION
-- =============================================

INSERT INTO templates (id, name, description, category, scope, is_active)
VALUES (
  '00000000-0000-0000-0008-000000000001',
  'Komplett-Renovation (Standard)',
  'Vollstaendige Wohnungsrenovation mit allen Gewerken: Demontage, Rohbau, Installationen, Ausbau',
  'complete_renovation',
  'unit',
  true
);

-- Phase 1: Vorbereitung & Demontage
INSERT INTO template_phases (id, template_id, name, description, wbs_code, sort_order)
VALUES (
  '00000000-0000-0000-0008-100000000001',
  '00000000-0000-0000-0008-000000000001',
  'Vorbereitung & Demontage',
  'Baustelleneinrichtung und Rueckbauarbeiten',
  '1',
  0
);

-- Package 1.1: Baustelleneinrichtung
INSERT INTO template_packages (id, phase_id, name, wbs_code, sort_order, trade_category)
VALUES (
  '00000000-0000-0000-0008-110000000001',
  '00000000-0000-0000-0008-100000000001',
  'Baustelleneinrichtung',
  '1.1',
  0,
  'general'
);

INSERT INTO template_tasks (id, package_id, name, wbs_code, sort_order, estimated_duration_days, trade_category)
VALUES
  ('00000000-0000-0000-0008-111000000001', '00000000-0000-0000-0008-110000000001', 'Schutzfolien und Abdeckungen anbringen', '1.1.1', 0, 1, 'general'),
  ('00000000-0000-0000-0008-111000000002', '00000000-0000-0000-0008-110000000001', 'Container bestellen und aufstellen', '1.1.2', 1, 1, 'general'),
  ('00000000-0000-0000-0008-111000000003', '00000000-0000-0000-0008-110000000001', 'Baustrom und Bauwasser einrichten', '1.1.3', 2, 1, 'electrical');

-- Package 1.2: Demontage
INSERT INTO template_packages (id, phase_id, name, wbs_code, sort_order, trade_category)
VALUES (
  '00000000-0000-0000-0008-110000000002',
  '00000000-0000-0000-0008-100000000001',
  'Demontage',
  '1.2',
  1,
  'demolition'
);

INSERT INTO template_tasks (id, package_id, name, wbs_code, sort_order, estimated_duration_days, trade_category)
VALUES
  ('00000000-0000-0000-0008-112000000001', '00000000-0000-0000-0008-110000000002', 'Sanitaerobjekte demontieren', '1.2.1', 0, 1, 'plumbing'),
  ('00000000-0000-0000-0008-112000000002', '00000000-0000-0000-0008-110000000002', 'Kuechengeraete und -moebel entfernen', '1.2.2', 1, 1, 'general'),
  ('00000000-0000-0000-0008-112000000003', '00000000-0000-0000-0008-110000000002', 'Alte Bodenbelaege entfernen', '1.2.3', 2, 2, 'demolition'),
  ('00000000-0000-0000-0008-112000000004', '00000000-0000-0000-0008-110000000002', 'Wandbelaege entfernen (Fliesen, Tapeten)', '1.2.4', 3, 2, 'demolition');

-- Phase 2: Rohbauarbeiten
INSERT INTO template_phases (id, template_id, name, description, wbs_code, sort_order)
VALUES (
  '00000000-0000-0000-0008-100000000002',
  '00000000-0000-0000-0008-000000000001',
  'Rohbauarbeiten',
  'Vorbereitende Bauarbeiten und Untergrund',
  '2',
  1
);

-- Package 2.1: Untergrund
INSERT INTO template_packages (id, phase_id, name, wbs_code, sort_order, trade_category)
VALUES (
  '00000000-0000-0000-0008-120000000001',
  '00000000-0000-0000-0008-100000000002',
  'Untergrundvorbereitung',
  '2.1',
  0,
  'masonry'
);

INSERT INTO template_tasks (id, package_id, name, wbs_code, sort_order, estimated_duration_days, trade_category)
VALUES
  ('00000000-0000-0000-0008-121000000001', '00000000-0000-0000-0008-120000000001', 'Untergrund pruefen und ausbessern', '2.1.1', 0, 1, 'masonry'),
  ('00000000-0000-0000-0008-121000000002', '00000000-0000-0000-0008-120000000001', 'Ausgleichsmasse auftragen', '2.1.2', 1, 1, 'flooring');

-- Phase 3: Installationen
INSERT INTO template_phases (id, template_id, name, description, wbs_code, sort_order)
VALUES (
  '00000000-0000-0000-0008-100000000003',
  '00000000-0000-0000-0008-000000000001',
  'Installationen',
  'Elektro, Sanitaer, Heizung',
  '3',
  2
);

-- Package 3.1: Elektroinstallation
INSERT INTO template_packages (id, phase_id, name, wbs_code, sort_order, trade_category)
VALUES (
  '00000000-0000-0000-0008-130000000001',
  '00000000-0000-0000-0008-100000000003',
  'Elektroinstallation',
  '3.1',
  0,
  'electrical'
);

INSERT INTO template_tasks (id, package_id, name, wbs_code, sort_order, estimated_duration_days, trade_category)
VALUES
  ('00000000-0000-0000-0008-131000000001', '00000000-0000-0000-0008-130000000001', 'Leitungen verlegen', '3.1.1', 0, 2, 'electrical'),
  ('00000000-0000-0000-0008-131000000002', '00000000-0000-0000-0008-130000000001', 'Dosen setzen', '3.1.2', 1, 1, 'electrical'),
  ('00000000-0000-0000-0008-131000000003', '00000000-0000-0000-0008-130000000001', 'Schalter und Steckdosen montieren', '3.1.3', 2, 1, 'electrical');

-- Package 3.2: Sanitaerinstallation
INSERT INTO template_packages (id, phase_id, name, wbs_code, sort_order, trade_category)
VALUES (
  '00000000-0000-0000-0008-130000000002',
  '00000000-0000-0000-0008-100000000003',
  'Sanitaerinstallation',
  '3.2',
  1,
  'plumbing'
);

INSERT INTO template_tasks (id, package_id, name, wbs_code, sort_order, estimated_duration_days, trade_category)
VALUES
  ('00000000-0000-0000-0008-132000000001', '00000000-0000-0000-0008-130000000002', 'Wasserleitungen verlegen', '3.2.1', 0, 2, 'plumbing'),
  ('00000000-0000-0000-0008-132000000002', '00000000-0000-0000-0008-130000000002', 'Abwasserleitungen verlegen', '3.2.2', 1, 1, 'plumbing');

-- Phase 4: Ausbau & Finish
INSERT INTO template_phases (id, template_id, name, description, wbs_code, sort_order)
VALUES (
  '00000000-0000-0000-0008-100000000004',
  '00000000-0000-0000-0008-000000000001',
  'Ausbau & Finish',
  'Oberflaechen, Montage, Reinigung',
  '4',
  3
);

-- Package 4.1: Oberflaechenarbeiten
INSERT INTO template_packages (id, phase_id, name, wbs_code, sort_order, trade_category)
VALUES (
  '00000000-0000-0000-0008-140000000001',
  '00000000-0000-0000-0008-100000000004',
  'Oberflaechenarbeiten',
  '4.1',
  0,
  'painting'
);

INSERT INTO template_tasks (id, package_id, name, wbs_code, sort_order, estimated_duration_days, trade_category)
VALUES
  ('00000000-0000-0000-0008-141000000001', '00000000-0000-0000-0008-140000000001', 'Waende spachteln und schleifen', '4.1.1', 0, 2, 'painting'),
  ('00000000-0000-0000-0008-141000000002', '00000000-0000-0000-0008-140000000001', 'Grundierung auftragen', '4.1.2', 1, 1, 'painting'),
  ('00000000-0000-0000-0008-141000000003', '00000000-0000-0000-0008-140000000001', 'Decken und Waende streichen', '4.1.3', 2, 3, 'painting');

-- Package 4.2: Bodenarbeiten
INSERT INTO template_packages (id, phase_id, name, wbs_code, sort_order, trade_category)
VALUES (
  '00000000-0000-0000-0008-140000000002',
  '00000000-0000-0000-0008-100000000004',
  'Bodenarbeiten',
  '4.2',
  1,
  'flooring'
);

INSERT INTO template_tasks (id, package_id, name, wbs_code, sort_order, estimated_duration_days, trade_category)
VALUES
  ('00000000-0000-0000-0008-142000000001', '00000000-0000-0000-0008-140000000002', 'Bodenbelag verlegen', '4.2.1', 0, 3, 'flooring'),
  ('00000000-0000-0000-0008-142000000002', '00000000-0000-0000-0008-140000000002', 'Sockelleisten montieren', '4.2.2', 1, 1, 'flooring');

-- Package 4.3: Endmontage
INSERT INTO template_packages (id, phase_id, name, wbs_code, sort_order, trade_category)
VALUES (
  '00000000-0000-0000-0008-140000000003',
  '00000000-0000-0000-0008-100000000004',
  'Endmontage',
  '4.3',
  2,
  'general'
);

INSERT INTO template_tasks (id, package_id, name, wbs_code, sort_order, estimated_duration_days, trade_category)
VALUES
  ('00000000-0000-0000-0008-143000000001', '00000000-0000-0000-0008-140000000003', 'Sanitaerobjekte montieren', '4.3.1', 0, 2, 'plumbing'),
  ('00000000-0000-0000-0008-143000000002', '00000000-0000-0000-0008-140000000003', 'Kueche montieren', '4.3.2', 1, 2, 'carpentry'),
  ('00000000-0000-0000-0008-143000000003', '00000000-0000-0000-0008-140000000003', 'Lampen und Armaturen montieren', '4.3.3', 2, 1, 'electrical'),
  ('00000000-0000-0000-0008-143000000004', '00000000-0000-0000-0008-140000000003', 'Endreinigung', '4.3.4', 3, 1, 'cleaning');

-- Quality Gates for Komplett-Renovation
INSERT INTO template_quality_gates (id, template_id, gate_level, phase_id, name, min_photos_required)
VALUES
  ('00000000-0000-0000-0008-900000000001', '00000000-0000-0000-0008-000000000001', 'phase', '00000000-0000-0000-0008-100000000001', 'Demontage abgeschlossen', 2),
  ('00000000-0000-0000-0008-900000000002', '00000000-0000-0000-0008-000000000001', 'phase', '00000000-0000-0000-0008-100000000003', 'Installationen geprueft', 3),
  ('00000000-0000-0000-0008-900000000003', '00000000-0000-0000-0008-000000000001', 'phase', '00000000-0000-0000-0008-100000000004', 'Endabnahme', 5);

-- =============================================
-- TEMPLATE 2: BADEZIMMER-RENOVATION
-- =============================================

INSERT INTO templates (id, name, description, category, scope, target_room_type, is_active)
VALUES (
  '00000000-0000-0000-0008-000000000002',
  'Badezimmer-Renovation',
  'Komplette Badezimmer-Erneuerung inkl. Sanitaer, Fliesen, Elektro',
  'room_specific',
  'room',
  'bathroom',
  true
);

-- Phase 1: Demontage
INSERT INTO template_phases (id, template_id, name, wbs_code, sort_order)
VALUES (
  '00000000-0000-0000-0008-200000000001',
  '00000000-0000-0000-0008-000000000002',
  'Demontage',
  '1',
  0
);

INSERT INTO template_packages (id, phase_id, name, wbs_code, sort_order, trade_category)
VALUES (
  '00000000-0000-0000-0008-210000000001',
  '00000000-0000-0000-0008-200000000001',
  'Rueckbau Bad',
  '1.1',
  0,
  'demolition'
);

INSERT INTO template_tasks (id, package_id, name, wbs_code, sort_order, estimated_duration_days, trade_category)
VALUES
  ('00000000-0000-0000-0008-211000000001', '00000000-0000-0000-0008-210000000001', 'Sanitaerobjekte demontieren (WC, Lavabo, Dusche/Wanne)', '1.1.1', 0, 1, 'plumbing'),
  ('00000000-0000-0000-0008-211000000002', '00000000-0000-0000-0008-210000000001', 'Alte Fliesen entfernen', '1.1.2', 1, 2, 'demolition'),
  ('00000000-0000-0000-0008-211000000003', '00000000-0000-0000-0008-210000000001', 'Alten Bodenbelag entfernen', '1.1.3', 2, 1, 'demolition');

-- Phase 2: Installationen
INSERT INTO template_phases (id, template_id, name, wbs_code, sort_order)
VALUES (
  '00000000-0000-0000-0008-200000000002',
  '00000000-0000-0000-0008-000000000002',
  'Installationen',
  '2',
  1
);

INSERT INTO template_packages (id, phase_id, name, wbs_code, sort_order, trade_category)
VALUES (
  '00000000-0000-0000-0008-220000000001',
  '00000000-0000-0000-0008-200000000002',
  'Sanitaer',
  '2.1',
  0,
  'plumbing'
);

INSERT INTO template_tasks (id, package_id, name, wbs_code, sort_order, estimated_duration_days, trade_category)
VALUES
  ('00000000-0000-0000-0008-221000000001', '00000000-0000-0000-0008-220000000001', 'Wasserleitungen verlegen', '2.1.1', 0, 1, 'plumbing'),
  ('00000000-0000-0000-0008-221000000002', '00000000-0000-0000-0008-220000000001', 'Abwasserleitungen verlegen', '2.1.2', 1, 1, 'plumbing');

INSERT INTO template_packages (id, phase_id, name, wbs_code, sort_order, trade_category)
VALUES (
  '00000000-0000-0000-0008-220000000002',
  '00000000-0000-0000-0008-200000000002',
  'Elektro',
  '2.2',
  1,
  'electrical'
);

INSERT INTO template_tasks (id, package_id, name, wbs_code, sort_order, estimated_duration_days, trade_category)
VALUES
  ('00000000-0000-0000-0008-222000000001', '00000000-0000-0000-0008-220000000002', 'Elektroleitungen verlegen', '2.2.1', 0, 1, 'electrical');

-- Phase 3: Oberflaechen
INSERT INTO template_phases (id, template_id, name, wbs_code, sort_order)
VALUES (
  '00000000-0000-0000-0008-200000000003',
  '00000000-0000-0000-0008-000000000002',
  'Oberflaechen',
  '3',
  2
);

INSERT INTO template_packages (id, phase_id, name, wbs_code, sort_order, trade_category)
VALUES (
  '00000000-0000-0000-0008-230000000001',
  '00000000-0000-0000-0008-200000000003',
  'Fliesen',
  '3.1',
  0,
  'flooring'
);

INSERT INTO template_tasks (id, package_id, name, wbs_code, sort_order, estimated_duration_days, trade_category)
VALUES
  ('00000000-0000-0000-0008-231000000001', '00000000-0000-0000-0008-230000000001', 'Abdichtung auftragen', '3.1.1', 0, 1, 'flooring'),
  ('00000000-0000-0000-0008-231000000002', '00000000-0000-0000-0008-230000000001', 'Bodenfliesen verlegen', '3.1.2', 1, 2, 'flooring'),
  ('00000000-0000-0000-0008-231000000003', '00000000-0000-0000-0008-230000000001', 'Wandfliesen verlegen', '3.1.3', 2, 2, 'flooring'),
  ('00000000-0000-0000-0008-231000000004', '00000000-0000-0000-0008-230000000001', 'Fugen verfuellen', '3.1.4', 3, 1, 'flooring');

-- Phase 4: Montage
INSERT INTO template_phases (id, template_id, name, wbs_code, sort_order)
VALUES (
  '00000000-0000-0000-0008-200000000004',
  '00000000-0000-0000-0008-000000000002',
  'Montage',
  '4',
  3
);

INSERT INTO template_packages (id, phase_id, name, wbs_code, sort_order, trade_category)
VALUES (
  '00000000-0000-0000-0008-240000000001',
  '00000000-0000-0000-0008-200000000004',
  'Endmontage',
  '4.1',
  0,
  'plumbing'
);

INSERT INTO template_tasks (id, package_id, name, wbs_code, sort_order, estimated_duration_days, trade_category)
VALUES
  ('00000000-0000-0000-0008-241000000001', '00000000-0000-0000-0008-240000000001', 'WC montieren', '4.1.1', 0, 1, 'plumbing'),
  ('00000000-0000-0000-0008-241000000002', '00000000-0000-0000-0008-240000000001', 'Lavabo montieren', '4.1.2', 1, 1, 'plumbing'),
  ('00000000-0000-0000-0008-241000000003', '00000000-0000-0000-0008-240000000001', 'Dusche/Wanne montieren', '4.1.3', 2, 1, 'plumbing'),
  ('00000000-0000-0000-0008-241000000004', '00000000-0000-0000-0008-240000000001', 'Spiegel und Accessoires montieren', '4.1.4', 3, 1, 'general'),
  ('00000000-0000-0000-0008-241000000005', '00000000-0000-0000-0008-240000000001', 'Endreinigung', '4.1.5', 4, 1, 'cleaning');

-- Quality Gate for Bad
INSERT INTO template_quality_gates (id, template_id, gate_level, phase_id, name, min_photos_required, checklist_items)
VALUES (
  '00000000-0000-0000-0008-900000000010',
  '00000000-0000-0000-0008-000000000002',
  'phase',
  '00000000-0000-0000-0008-200000000004',
  'Badezimmer Endabnahme',
  4,
  '[{"id": "chk1", "text": "Alle Sanitaerobjekte funktionsfaehig", "required": true}, {"id": "chk2", "text": "Keine Leckagen", "required": true}, {"id": "chk3", "text": "Fliesen ohne Maengel", "required": true}]'::JSONB
);

-- =============================================
-- TEMPLATE 3: KUECHEN-RENOVATION
-- =============================================

INSERT INTO templates (id, name, description, category, scope, target_room_type, is_active)
VALUES (
  '00000000-0000-0000-0008-000000000003',
  'Kuechen-Renovation',
  'Komplette Kuechen-Erneuerung inkl. Elektro, Sanitaer, Moebel',
  'room_specific',
  'room',
  'kitchen',
  true
);

-- Phase 1: Demontage
INSERT INTO template_phases (id, template_id, name, wbs_code, sort_order)
VALUES (
  '00000000-0000-0000-0008-300000000001',
  '00000000-0000-0000-0008-000000000003',
  'Demontage',
  '1',
  0
);

INSERT INTO template_packages (id, phase_id, name, wbs_code, sort_order, trade_category)
VALUES (
  '00000000-0000-0000-0008-310000000001',
  '00000000-0000-0000-0008-300000000001',
  'Rueckbau Kueche',
  '1.1',
  0,
  'demolition'
);

INSERT INTO template_tasks (id, package_id, name, wbs_code, sort_order, estimated_duration_days, trade_category)
VALUES
  ('00000000-0000-0000-0008-311000000001', '00000000-0000-0000-0008-310000000001', 'Elektrogeraete abklemmen und entfernen', '1.1.1', 0, 1, 'electrical'),
  ('00000000-0000-0000-0008-311000000002', '00000000-0000-0000-0008-310000000001', 'Kuechenmoebel demontieren', '1.1.2', 1, 1, 'carpentry'),
  ('00000000-0000-0000-0008-311000000003', '00000000-0000-0000-0008-310000000001', 'Alte Arbeitsplatte entfernen', '1.1.3', 2, 1, 'demolition');

-- Phase 2: Vorbereitung
INSERT INTO template_phases (id, template_id, name, wbs_code, sort_order)
VALUES (
  '00000000-0000-0000-0008-300000000002',
  '00000000-0000-0000-0008-000000000003',
  'Vorbereitung',
  '2',
  1
);

INSERT INTO template_packages (id, phase_id, name, wbs_code, sort_order, trade_category)
VALUES (
  '00000000-0000-0000-0008-320000000001',
  '00000000-0000-0000-0008-300000000002',
  'Installationen',
  '2.1',
  0,
  'electrical'
);

INSERT INTO template_tasks (id, package_id, name, wbs_code, sort_order, estimated_duration_days, trade_category)
VALUES
  ('00000000-0000-0000-0008-321000000001', '00000000-0000-0000-0008-320000000001', 'Elektroinstallation anpassen', '2.1.1', 0, 1, 'electrical'),
  ('00000000-0000-0000-0008-321000000002', '00000000-0000-0000-0008-320000000001', 'Wasseranschluesse anpassen', '2.1.2', 1, 1, 'plumbing');

INSERT INTO template_packages (id, phase_id, name, wbs_code, sort_order, trade_category)
VALUES (
  '00000000-0000-0000-0008-320000000002',
  '00000000-0000-0000-0008-300000000002',
  'Oberflaechen',
  '2.2',
  1,
  'painting'
);

INSERT INTO template_tasks (id, package_id, name, wbs_code, sort_order, estimated_duration_days, trade_category)
VALUES
  ('00000000-0000-0000-0008-322000000001', '00000000-0000-0000-0008-320000000002', 'Waende ausbessern und streichen', '2.2.1', 0, 2, 'painting'),
  ('00000000-0000-0000-0008-322000000002', '00000000-0000-0000-0008-320000000002', 'Boden vorbereiten', '2.2.2', 1, 1, 'flooring');

-- Phase 3: Montage
INSERT INTO template_phases (id, template_id, name, wbs_code, sort_order)
VALUES (
  '00000000-0000-0000-0008-300000000003',
  '00000000-0000-0000-0008-000000000003',
  'Montage',
  '3',
  2
);

INSERT INTO template_packages (id, phase_id, name, wbs_code, sort_order, trade_category)
VALUES (
  '00000000-0000-0000-0008-330000000001',
  '00000000-0000-0000-0008-300000000003',
  'Kuechenmontage',
  '3.1',
  0,
  'carpentry'
);

INSERT INTO template_tasks (id, package_id, name, wbs_code, sort_order, estimated_duration_days, trade_category)
VALUES
  ('00000000-0000-0000-0008-331000000001', '00000000-0000-0000-0008-330000000001', 'Unterschraenke montieren', '3.1.1', 0, 1, 'carpentry'),
  ('00000000-0000-0000-0008-331000000002', '00000000-0000-0000-0008-330000000001', 'Oberschraenke montieren', '3.1.2', 1, 1, 'carpentry'),
  ('00000000-0000-0000-0008-331000000003', '00000000-0000-0000-0008-330000000001', 'Arbeitsplatte montieren', '3.1.3', 2, 1, 'carpentry'),
  ('00000000-0000-0000-0008-331000000004', '00000000-0000-0000-0008-330000000001', 'Spuele und Armatur montieren', '3.1.4', 3, 1, 'plumbing'),
  ('00000000-0000-0000-0008-331000000005', '00000000-0000-0000-0008-330000000001', 'Elektrogeraete einbauen und anschliessen', '3.1.5', 4, 1, 'electrical'),
  ('00000000-0000-0000-0008-331000000006', '00000000-0000-0000-0008-330000000001', 'Fronten und Griffe montieren', '3.1.6', 5, 1, 'carpentry'),
  ('00000000-0000-0000-0008-331000000007', '00000000-0000-0000-0008-330000000001', 'Endreinigung', '3.1.7', 6, 1, 'cleaning');

-- Quality Gate for Kueche
INSERT INTO template_quality_gates (id, template_id, gate_level, phase_id, name, min_photos_required, checklist_items)
VALUES (
  '00000000-0000-0000-0008-900000000020',
  '00000000-0000-0000-0008-000000000003',
  'phase',
  '00000000-0000-0000-0008-300000000003',
  'Kueche Endabnahme',
  4,
  '[{"id": "chk1", "text": "Alle Geraete funktionsfaehig", "required": true}, {"id": "chk2", "text": "Wasser- und Stromanschluss geprueft", "required": true}, {"id": "chk3", "text": "Fronten und Schubladen schliessen korrekt", "required": true}]'::JSONB
);
```
</task>

## Verification

- [ ] GET /api/templates returns list of templates with filters
- [ ] POST /api/templates creates template (admin only)
- [ ] GET /api/templates/[id] returns template with full hierarchy
- [ ] PATCH /api/templates/[id] updates template (admin only)
- [ ] DELETE /api/templates/[id] deletes template with cascade
- [ ] Phase, package, task CRUD endpoints all functional
- [ ] Template library page displays templates grouped by category
- [ ] Template detail page shows full WBS hierarchy
- [ ] Template editor allows creating/editing WBS structure
- [ ] Seed migration creates 3 templates successfully
- [ ] Duration and cost calculations update automatically via triggers

## Must Haves

These are goal-backward success criteria derived from TMPL-01, TMPL-02, TMPL-03:

- [ ] Admin can create and manage templates (CRUD complete)
- [ ] Template library shows at least 3 templates: Komplett, Bad, Kueche (TMPL-01, TMPL-02)
- [ ] Templates display 3-level WBS hierarchy (Phase > Package > Task) (TMPL-03)
- [ ] Templates grouped by category (complete, room-specific, trade-specific)
- [ ] Room-specific templates show target room type badge
- [ ] Template duration and cost calculated and displayed
- [ ] Non-admin users can view templates but not edit
