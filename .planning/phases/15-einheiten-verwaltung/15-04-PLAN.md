---
phase: 15-einheiten-verwaltung
plan: 04
type: execute
wave: 3
depends_on: ["15-02", "15-03"]
files_modified:
  - src/app/dashboard/einheiten/[id]/page.tsx
  - src/components/units/RoomForm.tsx
  - src/components/units/RoomList.tsx
  - src/components/units/RoomCard.tsx
  - src/components/units/TenantSection.tsx
autonomous: true

must_haves:
  truths:
    - "Unit detail page shows tenant info, condition overview, and room list"
    - "Admin can add rooms to a unit via form"
    - "Admin can edit room details (name, type, area)"
    - "Room list shows room type, name, and current condition"
  artifacts:
    - path: "src/app/dashboard/einheiten/[id]/page.tsx"
      provides: "Unit detail page with rooms"
      min_lines: 120
    - path: "src/components/units/RoomForm.tsx"
      provides: "Create/edit room form modal"
      min_lines: 100
    - path: "src/components/units/RoomList.tsx"
      provides: "Room list component"
      min_lines: 40
    - path: "src/components/units/TenantSection.tsx"
      provides: "Tenant info display"
      min_lines: 30
  key_links:
    - from: "src/app/dashboard/einheiten/[id]/page.tsx"
      to: "/api/rooms"
      via: "fetch for room list"
      pattern: "fetch.*api/rooms"
    - from: "src/components/units/RoomForm.tsx"
      to: "/api/rooms"
      via: "fetch POST/PATCH"
      pattern: "fetch.*api/rooms"
---

<objective>
Create unit detail page with room management and tenant display.

Purpose: Admin can view unit details (tenant info, condition overview from Digital Twin, room list) and manage rooms (add, edit). This completes UNIT-03 (add rooms) and UNIT-04 (rooms for condition tracking).

Output: Unit detail page at /dashboard/einheiten/[id] with TenantSection, condition summary, RoomList with RoomForm for CRUD.
</objective>

<execution_context>
@C:\Users\Mario Giacchino\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\Mario Giacchino\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/15-einheiten-verwaltung/15-CONTEXT.md
@.planning/phases/15-einheiten-verwaltung/15-RESEARCH.md
@src/app/dashboard/wohnungen/[id]/page.tsx
@src/components/units/ConditionBadge.tsx
@src/lib/units/condition-queries.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create TenantSection, RoomCard, and RoomList components</name>
  <files>
src/components/units/TenantSection.tsx
src/components/units/RoomCard.tsx
src/components/units/RoomList.tsx
  </files>
  <action>
Create TenantSection.tsx per CONTEXT.md:
```typescript
interface TenantSectionProps {
  tenant: {
    name: string | null
    phone: string | null
    email: string | null
    move_in_date: string | null
  } | null
  isVacant: boolean
}
```
- If isVacant or no tenant name: show amber "Leerstand" badge
- Otherwise show tenant info in a card
- Display: Name (bold), Phone, Email (if present), Move-in date formatted

Create RoomCard.tsx:
```typescript
interface RoomCardProps {
  room: Room
  onEdit: (room: Room) => void
}
```
- Display room name and room type label (use getRoomTypeLabel)
- Show condition badge using existing ConditionBadge component
- Show area if present (e.g., "12 m2")
- Edit button (pencil icon)

Create RoomList.tsx:
```typescript
interface RoomListProps {
  rooms: Room[]
  onEdit: (room: Room) => void
  onAdd: () => void
}
```
- Header with "Raeume" title and "Hinzufuegen" button
- Map rooms to RoomCard components
- Grid layout (2 cols on tablet, 3 on desktop)
- Empty state: "Keine Raeume vorhanden"

getRoomTypeLabel helper (from wohnungen/[id]/page.tsx):
```typescript
const ROOM_TYPE_LABELS: Record<string, string> = {
  living_room: 'Wohnzimmer',
  bedroom: 'Schlafzimmer',
  kitchen: 'Kueche',
  bathroom: 'Badezimmer',
  toilet: 'WC',
  hallway: 'Flur',
  storage: 'Abstellraum',
  balcony: 'Balkon',
  laundry: 'Waschkueche',
  garage: 'Garage',
  office: 'Buero',
  other: 'Sonstiges'
}
```
  </action>
  <verify>TypeScript compiles: `npx tsc --noEmit`</verify>
  <done>TenantSection, RoomCard, and RoomList components exist with proper styling</done>
</task>

<task type="auto">
  <name>Task 2: Create RoomForm component</name>
  <files>src/components/units/RoomForm.tsx</files>
  <action>
Create RoomForm following PartnerForm/UnitForm pattern:

Props interface:
```typescript
interface RoomFormProps {
  mode: 'create' | 'edit'
  room?: Room
  unitId: string
  onSave: (room: Room) => void
  onCancel: () => void
}
```

Form fields from CONTEXT.md:
1. Name (required) - text input, placeholder "z.B. Wohnzimmer"
2. Room Type (required) - dropdown with German labels
3. Area - number input with "m2" suffix (optional)
4. Notes - textarea (optional)

Room type dropdown options (German labels):
- Wohnzimmer (living_room)
- Zimmer 1 (bedroom) - Note: CONTEXT.md lists Zimmer 1-4, use bedroom type
- Kueche (kitchen)
- Bad/WC (bathroom)
- Korridor (hallway)
- Balkon (balcony)
- Abstellraum (storage)
- Keller (storage - or use 'other' with note)
- Custom/Sonstiges (other)

Form behavior:
- Modal overlay like other forms
- POST to /api/rooms for create, PATCH to /api/rooms/:id for edit
- Note: condition is NOT editable - it's managed by Digital Twin
- Show info text: "Der Zustand wird automatisch durch abgeschlossene Projekte aktualisiert"

Validation:
- Name is required
- Room type is required
- Area must be positive number if provided
  </action>
  <verify>TypeScript compiles: `npx tsc --noEmit`</verify>
  <done>RoomForm component handles create/edit with proper validation</done>
</task>

<task type="auto">
  <name>Task 3: Create unit detail page</name>
  <files>src/app/dashboard/einheiten/[id]/page.tsx</files>
  <action>
Create page following wohnungen/[id]/page.tsx structure but as client component:

'use client' component (needs form state management):
```typescript
interface PageProps {
  params: Promise<{ id: string }>
}
```

State:
- unit: Unit | null
- rooms: Room[]
- loading: boolean
- error: string | null
- showRoomForm: boolean
- editingRoom: Room | null

Data fetching:
- Fetch unit: GET /api/units/:id
- Fetch rooms: GET /api/rooms?unit_id=:id
- Fetch condition data using existing fetchUnitConditionData if available

Page structure (three sections per CONTEXT.md):
1. **Header** - Unit name, type badge, floor, breadcrumb navigation
2. **Tenant Section** - TenantSection component with tenant data
3. **Condition Overview** - Reuse condition summary from wohnungen page (or simplified version)
4. **Room List** - RoomList component with add/edit functionality
5. **RoomForm modal** - When showRoomForm is true

Breadcrumb: Dashboard > Einheiten > {unit.name}

Link to existing detail page: Add link "Zur Detailansicht" pointing to /dashboard/wohnungen/[id] for full timeline view.

Event handlers:
- handleAddRoom: setShowRoomForm(true), setEditingRoom(null)
- handleEditRoom: setShowRoomForm(true), setEditingRoom(room)
- handleSaveRoom: add/update room in list, close form
- handleCancelRoom: close form
  </action>
  <verify>
Manual verification:
- Navigate to /dashboard/einheiten/:id
- Page shows unit header, tenant section, rooms
- Click "Hinzufuegen" opens room form
- Click room edit opens edit form
- Form saves room and updates list
  </verify>
  <done>Unit detail page displays tenant info, condition, rooms with CRUD functionality</done>
</task>

</tasks>

<verification>
1. TypeScript compiles: `npx tsc --noEmit`
2. /dashboard/einheiten/:id shows unit details with three sections
3. TenantSection shows tenant or Leerstand
4. RoomList shows all rooms with condition badges
5. RoomForm creates/edits rooms
6. Condition is display-only (not editable)
</verification>

<success_criteria>
- Unit detail page shows tenant info, condition overview, room list (CONTEXT.md layout)
- Admin can add rooms with name, type, optional area
- Admin can edit room details
- Room condition is displayed but not editable (managed by Digital Twin)
- Rooms are available for task assignment (existing task forms already have room picker)
</success_criteria>

<output>
After completion, create `.planning/phases/15-einheiten-verwaltung/15-04-SUMMARY.md`
</output>
