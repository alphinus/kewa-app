---
phase: 05-building-visualization
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/building/BuildingGrid.tsx
  - src/components/building/UnitCell.tsx
  - src/components/building/CommonAreasList.tsx
autonomous: true

must_haves:
  truths:
    - "Building grid displays apartments in floor layout (EG to Dach)"
    - "Unit cells show progress bar with color coding"
    - "Common areas are listed separately below the grid"
  artifacts:
    - path: "src/components/building/BuildingGrid.tsx"
      provides: "Visual grid of apartments by floor"
      min_lines: 50
    - path: "src/components/building/UnitCell.tsx"
      provides: "Individual unit with progress bar"
      min_lines: 40
    - path: "src/components/building/CommonAreasList.tsx"
      provides: "List of common areas"
      min_lines: 30
  key_links:
    - from: "BuildingGrid"
      to: "UnitCell"
      via: "maps units to grid cells"
      pattern: "UnitCell.*unit="
    - from: "UnitCell"
      to: "progress calculation"
      via: "open_tasks_count / total_tasks_count"
      pattern: "open_tasks_count.*total_tasks_count"
---

<objective>
Create building visualization components with floor-based grid layout.

Purpose: Visual representation of the building with progress indicators per unit.
Output: Reusable BuildingGrid, UnitCell, and CommonAreasList components.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-03-SUMMARY.md

@src/types/database.ts
@src/types/index.ts
@src/components/ui/card.tsx
@src/lib/utils.ts
@supabase/migrations/001_initial_schema.sql
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create UnitCell component with progress bar</name>
  <files>src/components/building/UnitCell.tsx</files>
  <action>
Create UnitCell component displaying a single unit:

**Props:**
- unit: UnitWithStats
- onClick: () => void
- compact?: boolean (for mobile)

**Display:**
- Unit name (e.g., "EG Links", "1.OG Mitte")
- Tenant name if set (smaller text below)
- Progress bar showing task completion
- Color coding based on progress:
  - Green (bg-green-500): 100% complete OR no tasks
  - Yellow (bg-yellow-500): 50-99% complete
  - Orange (bg-orange-500): 1-49% complete
  - Red (bg-red-500): 0% complete (has open tasks)
- Task count text: "3/5" (completed/total)

**Styling:**
- Touch-friendly: min-height 80px, cursor-pointer
- Hover effect: slight scale or shadow
- Use Card component as base
- Progress bar: rounded, 4px height
- Responsive: stack name/progress on mobile

**Calculation:**
- progress = total_tasks_count === 0 ? 100 : ((total_tasks_count - open_tasks_count) / total_tasks_count) * 100
- completed = total_tasks_count - open_tasks_count
  </action>
  <verify>
Build passes: npm run build
TypeScript: npm run type-check
  </verify>
  <done>
- UnitCell renders unit name, tenant, progress bar, task count
- Color coding reflects completion status
- Touch-friendly sizing (80px min height)
- onClick handler attached
  </done>
</task>

<task type="auto">
  <name>Task 2: Create BuildingGrid component</name>
  <files>src/components/building/BuildingGrid.tsx</files>
  <action>
Create BuildingGrid component displaying apartments in visual layout:

**Props:**
- apartments: UnitWithStats[] (filtered to unit_type='apartment')
- onUnitClick: (unit: UnitWithStats) => void

**Layout - CSS Grid:**
The building has:
- 5 floors: Dach (4), 3.OG (3), 2.OG (2), 1.OG (1), EG (0)
- 3 positions per floor: Links, Mitte, Rechts
- Exception: Dach only has 1 unit (spans all 3 columns)

Structure:
```
| Dach (col-span-3)                    |
| 3.OG L | 3.OG M | 3.OG R |
| 2.OG L | 2.OG M | 2.OG R |
| 1.OG L | 1.OG M | 1.OG R |
| EG L   | EG M   | EG R   |
```

**Implementation:**
- Use CSS grid: grid-cols-3
- Group apartments by floor (descending: 4, 3, 2, 1, 0)
- For each floor, render 3 cells (left, middle, right)
- Dach row: single UnitCell with col-span-3
- Floor labels on left side (optional, outside grid)

**Styling:**
- gap-2 or gap-3 between cells
- Floor label: text-sm font-medium text-gray-500
- Building outline/border around entire grid (optional)
- Mobile: maintain 3-column layout but smaller cells

**Helper function:**
- getUnitByFloorPosition(apartments, floor, position) - returns matching unit or null
  </action>
  <verify>
Build passes: npm run build
TypeScript: npm run type-check
  </verify>
  <done>
- BuildingGrid renders 5 rows (Dach to EG)
- 3 columns per row (except Dach spans all)
- Units placed by floor/position
- Click propagates to onUnitClick
  </done>
</task>

<task type="auto">
  <name>Task 3: Create CommonAreasList component</name>
  <files>src/components/building/CommonAreasList.tsx</files>
  <action>
Create CommonAreasList component for non-apartment units:

**Props:**
- commonAreas: UnitWithStats[] (filtered to unit_type='common_area' or 'building')
- onUnitClick: (unit: UnitWithStats) => void

**Display:**
- Section title: "Gemeinschaftsbereiche"
- List of common areas as smaller cards
- Each shows: name, progress indicator (dot or mini bar), task count
- "Gesamtes Gebaeude" highlighted or at top (building type)

**Styling:**
- Horizontal scroll on mobile (flex overflow-x-auto)
- Or vertical list with smaller cells
- Use simpler progress indicator (colored dot instead of full bar)
- Touch-friendly: min 48px height per item
- Group: building unit first, then common areas alphabetically

**Color dot:**
- Same color logic as UnitCell progress bar
- Size: w-3 h-3 rounded-full
  </action>
  <verify>
Build passes: npm run build
TypeScript: npm run type-check
  </verify>
  <done>
- CommonAreasList renders common areas and building unit
- Compact display with color indicators
- Touch-friendly sizing
- Click handlers work
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] `npm run type-check` passes
- [ ] BuildingGrid component exists with grid layout
- [ ] UnitCell component exists with progress bar
- [ ] CommonAreasList component exists
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No TypeScript errors
- Components ready for integration in building page
  </success_criteria>

<output>
After completion, create `.planning/phases/05-building-visualization/05-02-SUMMARY.md`
</output>
