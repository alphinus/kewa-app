---
phase: 25-ux-polish
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - src/app/layout.tsx
  - src/components/inspections/ChecklistExecution.tsx
  - src/components/inspections/SignatureCapture.tsx
  - src/components/inspections/DefectForm.tsx
  - src/components/inspections/DefectReviewCard.tsx
  - src/components/change-orders/ApprovalWorkflowCard.tsx
  - src/components/change-orders/PhotoGallery.tsx
  - src/components/knowledge/AttachmentList.tsx
  - src/components/admin/RoomManager.tsx
  - src/components/admin/PropertyBuilder.tsx
  - src/components/upload/FileUploader.tsx
  - src/app/dashboard/projekte/page.tsx
  - src/app/dashboard/aufgaben/page.tsx
  - src/app/dashboard/admin/properties/page.tsx
  - src/app/dashboard/abnahmen/[id]/page.tsx
  - src/app/dashboard/abnahmen/[id]/unterschrift/page.tsx
  - src/app/dashboard/vorlagen/abnahmen/[id]/page.tsx
  - src/app/dashboard/vorlagen/abnahmen/neu/page.tsx
  - src/app/templates/[id]/page.tsx
  - src/app/contractor/[token]/work-order-card.tsx
  - src/app/contractor/[token]/[workOrderId]/media-gallery.tsx
  - src/app/contractor/[token]/[workOrderId]/upload-section.tsx
autonomous: true

must_haves:
  truths:
    - "Action feedback (save, delete, error) displays as toast notification via Sonner"
    - "Toast notifications are German-language and appear consistently across all CRUD operations"
    - "No alert() calls remain in dashboard components for action feedback"
  artifacts:
    - path: "src/app/layout.tsx"
      provides: "Toaster component mounted at app root"
      contains: "Toaster"
    - path: "package.json"
      provides: "sonner dependency installed"
      contains: "sonner"
  key_links:
    - from: "src/app/layout.tsx"
      to: "sonner"
      via: "Toaster component import"
      pattern: "import.*Toaster.*sonner"
    - from: "src/components/inspections/ChecklistExecution.tsx"
      to: "sonner"
      via: "toast() calls replace alert()"
      pattern: "import.*toast.*sonner"
---

<objective>
Install Sonner toast library and replace all alert() calls across the app with German-language toast notifications for consistent action feedback.

Purpose: Users get non-intrusive, professional toast feedback instead of blocking browser alert() dialogs.
Output: Sonner installed, Toaster mounted in root layout, all alert() calls replaced with toast.success/toast.error/toast.warning.
</objective>

<execution_context>
@C:\Users\Mario Giacchino\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\Mario Giacchino\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@src/app/layout.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Sonner and mount Toaster</name>
  <files>
    package.json
    src/app/layout.tsx
  </files>
  <action>
1. Install sonner: `npm install sonner@2.0.7` (exact version per v3.0 architecture decision in STATE.md)

2. Update `src/app/layout.tsx`:
   - Add import: `import { Toaster } from 'sonner'`
   - Add `<Toaster />` component inside the body, after `<PushProvider>` children:
     ```tsx
     <PushProvider>
       {children}
     </PushProvider>
     <Toaster
       position="top-right"
       richColors
       closeButton
       toastOptions={{
         duration: 4000,
       }}
     />
     ```
   - The Toaster goes OUTSIDE PushProvider (it's independent) but inside body
   - `richColors` enables styled success/error variants
   - `closeButton` adds an X to dismiss
   - `position="top-right"` is standard for desktop apps
   - `duration: 4000` gives 4 seconds visibility (default 3 is too short for German text)

3. Verify the import works by checking `npx tsc --noEmit` passes.
  </action>
  <verify>
1. `npm ls sonner` shows sonner@2.0.7
2. `npx tsc --noEmit` passes
3. Grep for "Toaster" in layout.tsx returns a match
  </verify>
  <done>
- Sonner is installed at version 2.0.7
- Toaster component is mounted in root layout
- Toast notifications are globally available via `import { toast } from 'sonner'`
  </done>
</task>

<task type="auto">
  <name>Task 2: Replace all alert() calls with toast()</name>
  <files>
    src/components/inspections/ChecklistExecution.tsx
    src/components/inspections/SignatureCapture.tsx
    src/components/inspections/DefectForm.tsx
    src/components/inspections/DefectReviewCard.tsx
    src/components/change-orders/ApprovalWorkflowCard.tsx
    src/components/change-orders/PhotoGallery.tsx
    src/components/knowledge/AttachmentList.tsx
    src/components/admin/RoomManager.tsx
    src/components/admin/PropertyBuilder.tsx
    src/components/upload/FileUploader.tsx
    src/app/dashboard/projekte/page.tsx
    src/app/dashboard/aufgaben/page.tsx
    src/app/dashboard/admin/properties/page.tsx
    src/app/dashboard/abnahmen/[id]/page.tsx
    src/app/dashboard/abnahmen/[id]/unterschrift/page.tsx
    src/app/dashboard/vorlagen/abnahmen/[id]/page.tsx
    src/app/dashboard/vorlagen/abnahmen/neu/page.tsx
    src/app/templates/[id]/page.tsx
    src/app/contractor/[token]/work-order-card.tsx
    src/app/contractor/[token]/[workOrderId]/media-gallery.tsx
    src/app/contractor/[token]/[workOrderId]/upload-section.tsx
  </files>
  <action>
For EVERY file listed, add `import { toast } from 'sonner'` at the top, then replace each `alert()` call with the appropriate toast variant.

**Mapping rules:**

| alert() content pattern | toast variant | Example |
|------------------------|---------------|---------|
| Success message ("gespeichert", "erstellt", "geloescht") | `toast.success(msg)` | `toast.success('Checkliste gespeichert')` |
| Error message ("Fehler", "fehlgeschlagen") | `toast.error(msg)` | `toast.error('Fehler beim Speichern')` |
| Validation message ("Bitte geben Sie", "ist erforderlich") | `toast.warning(msg)` | `toast.warning('Bitte geben Sie einen Namen ein')` |
| Info/neutral message | `toast.info(msg)` | `toast.info('Wird implementiert')` |

**File-by-file changes:**

`src/components/inspections/ChecklistExecution.tsx`:
- Line 140: `alert('Fehler beim Hochladen des Fotos')` -> `toast.error('Fehler beim Hochladen des Fotos')`
- Line 155: `alert('Checkliste gespeichert')` -> `toast.success('Checkliste gespeichert')`
- Line 158: `alert('Fehler beim Speichern')` -> `toast.error('Fehler beim Speichern')`

`src/components/inspections/SignatureCapture.tsx`:
- Line 36: `alert('Bitte zeichnen Sie eine Unterschrift')` -> `toast.warning('Bitte zeichnen Sie eine Unterschrift')`
- Line 41: `alert('Bitte geben Sie Ihren Namen ein')` -> `toast.warning('Bitte geben Sie Ihren Namen ein')`
- Line 51: `alert('Fehler beim Speichern der Unterschrift')` -> `toast.error('Fehler beim Speichern der Unterschrift')`
- Line 59: `alert('Bitte geben Sie einen Grund...')` -> `toast.warning('Bitte geben Sie einen Grund fuer die Verweigerung an')`
- Line 68: `alert('Fehler beim Speichern der Verweigerung')` -> `toast.error('Fehler beim Speichern der Verweigerung')`

`src/components/inspections/DefectForm.tsx`:
- Line 97: `alert('Fehler beim Erstellen des Mangels')` -> `toast.error('Fehler beim Erstellen des Mangels')`

`src/components/inspections/DefectReviewCard.tsx`:
- Line 34: `alert('Grund ist erforderlich...')` -> `toast.warning('Grund ist erforderlich beim Verwerfen')`
- Line 39: `alert('Bitte waehlen Sie...')` -> `toast.warning('Bitte waehlen Sie einen Verantwortlichen aus')`
- Line 63: `alert(error.message)` -> `toast.error(error instanceof Error ? error.message : 'Fehler beim Ausfuehren der Aktion')`

`src/components/change-orders/ApprovalWorkflowCard.tsx`:
- Line 63: `alert(error.error || ...)` -> `toast.error(error.error || 'Fehler beim Statuswechsel')`
- Line 71: `alert('Fehler beim Statuswechsel')` -> `toast.error('Fehler beim Statuswechsel')`
- Line 87: `alert('Bitte geben Sie einen Kommentar ein')` -> `toast.warning('Bitte geben Sie einen Kommentar ein')`
- Line 95: `alert('Bitte geben Sie einen Grund ein')` -> `toast.warning('Bitte geben Sie einen Grund ein')`

`src/components/change-orders/PhotoGallery.tsx`:
- Line 54: `alert(err.message)` -> `toast.error(err instanceof Error ? err.message : 'Loeschen fehlgeschlagen')`

`src/components/knowledge/AttachmentList.tsx`:
- Line 71: `alert(err.message)` -> `toast.error(err instanceof Error ? err.message : 'Loeschen fehlgeschlagen')`

`src/components/admin/RoomManager.tsx`:
- Line 68: -> `toast.error('Fehler beim Hinzufuegen des Raums')`
- Line 87: -> `toast.error('Fehler beim Loeschen des Raums')`
- Line 104: -> `toast.error('Fehler beim Aktualisieren des Raums')`

`src/components/admin/PropertyBuilder.tsx`:
- Line 211: -> `toast.error('Fehler beim Erstellen der Einheit')`
- Line 235: -> `toast.error('Fehler beim Verschieben der Einheit')`

`src/components/upload/FileUploader.tsx`:
- Line 80: `alert('Maximal ${maxFiles} Dateien erlaubt')` -> `toast.warning(\`Maximal ${maxFiles} Dateien erlaubt\`)`
- Line 91: `alert(validation.error)` -> `toast.warning(validation.error)`

`src/app/dashboard/projekte/page.tsx`:
- Line 173: -> `toast.error(err instanceof Error ? err.message : 'Fehler beim Archivieren')`

`src/app/dashboard/aufgaben/page.tsx`:
- Line 152: -> `toast.error(err instanceof Error ? err.message : 'Fehler beim Loeschen')`

`src/app/dashboard/admin/properties/page.tsx`:
- Line 223: -> `toast.error('Fehler beim Erstellen. Bitte versuchen Sie es erneut.')`
- Line 355: -> `toast.error('Fehler beim Erstellen des Gebaeudes')`

`src/app/dashboard/abnahmen/[id]/page.tsx`:
- Line 88: -> `toast.error('Fehler beim Abschliessen')`

`src/app/dashboard/abnahmen/[id]/unterschrift/page.tsx`:
- Line 43: `alert('Abnahme muss zuerst abgeschlossen werden')` -> `toast.warning('Abnahme muss zuerst abgeschlossen werden')`

`src/app/dashboard/vorlagen/abnahmen/[id]/page.tsx`:
- Line 86: -> `toast.warning('Bitte geben Sie einen Namen ein')`
- Line 91: -> `toast.warning('Bitte fuegen Sie mindestens einen Abschnitt hinzu')`
- Line 98: -> `toast.warning('Alle Abschnitte muessen einen Namen haben')`
- Line 102: -> `` toast.warning(`Abschnitt "${section.name}" muss mindestens ein Element haben`) ``
- Line 107: -> `` toast.warning(`Alle Elemente in "${section.name}" muessen einen Titel haben`) ``
- Line 135: -> `toast.error(error instanceof Error ? error.message : 'Fehler beim Speichern der Vorlage')`
- Line 162: -> `toast.error(error instanceof Error ? error.message : 'Fehler beim Loeschen der Vorlage')`

`src/app/dashboard/vorlagen/abnahmen/neu/page.tsx`:
- Line 52-73: Same validation pattern as [id]/page.tsx -- replace all alert() with toast.warning()
- Line 101: -> `toast.error(error instanceof Error ? error.message : 'Fehler beim Erstellen der Vorlage')`

`src/app/templates/[id]/page.tsx`:
- Line 392: `alert('Template-Anwendung...')` -> `toast.info('Template-Anwendung wird in einer zukuenftigen Version implementiert')`

`src/app/contractor/[token]/work-order-card.tsx`:
- Line 125: -> `toast.error('Aktualisierung fehlgeschlagen. Bitte versuchen Sie es erneut.')`

`src/app/contractor/[token]/[workOrderId]/media-gallery.tsx`:
- Line 94: -> `toast.error(error.error || 'Loeschen fehlgeschlagen')`
- Line 97: -> `toast.error('Loeschen fehlgeschlagen')`

`src/app/contractor/[token]/[workOrderId]/upload-section.tsx`:
- Line 121: -> `toast.error(error instanceof Error ? error.message : 'Upload fehlgeschlagen')`
- Line 156: -> `toast.error(error instanceof Error ? error.message : 'Loeschen fehlgeschlagen')`

**Also handle the remaining prompt() calls (not handled by Plan 01):**

`src/app/templates/[id]/page.tsx` line 99:
- `const newName = prompt('Name fuer die Kopie:', ...)` -- this is a template duplication feature. Replace with an inline state approach: add state for `showCopyInput/copyName`, show a small input+button inline, or keep prompt() for now since it's a name input (not the same as invoice linking). If keeping, add a TODO comment. If converting, use a Dialog-based approach but that may be overkill for a simple name input. Decision: keep as prompt() for now since UXPL scope only covers invoice linking. Add `// TODO: Replace with modal input` comment.

`src/components/knowledge/ArticleEditor.tsx` line 88:
- `window.prompt('URL eingeben:')` -- this is for Tiptap link insertion. This is standard Tiptap behavior and not a CRUD action feedback. Leave as-is with a TODO comment.

**IMPORTANT:** Each file must be read first before modifying. For each file:
1. Read the file
2. Add `import { toast } from 'sonner'` at the top with other imports
3. Replace each `alert(...)` with the appropriate `toast.*(...)`
4. Save the file
  </action>
  <verify>
1. `npx tsc --noEmit` passes
2. Grep for `alert(` in all modified files returns zero matches (excluding the two intentionally kept prompt()/alert() in ArticleEditor and templates duplicate)
3. Grep for `import { toast } from 'sonner'` returns matches in all modified files
4. `npm run build` succeeds
  </verify>
  <done>
- All alert() calls in dashboard and component files replaced with toast.success/error/warning
- Toast notifications appear in German language consistently
- Sonner Toaster renders non-blocking toast popups at top-right
- Only 3 prompt() calls remain (Tiptap URL, template copy [id], template copy page) -- out of UXPL scope
  </done>
</task>

</tasks>

<verification>
1. `npm run build` -- full build succeeds
2. `npx tsc --noEmit` -- TypeScript compilation passes
3. Grep for `alert(` across src/ returns at most 2 matches (Tiptap URL prompt, template copy prompt -- both out of scope)
4. Grep for `from 'sonner'` returns matches in layout.tsx and all converted component files
5. Sonner is in package.json dependencies at version 2.0.7
</verification>

<success_criteria>
- UXPL-04: Action feedback displays as toast notification via Sonner
- All error, success, and validation feedback uses toast instead of alert()
- Toast notifications are German-language
- Toast appears consistently across all CRUD operations
</success_criteria>

<output>
After completion, create `.planning/phases/25-ux-polish/25-02-SUMMARY.md`
</output>
