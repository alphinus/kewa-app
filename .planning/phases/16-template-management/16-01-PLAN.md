---
phase: 16-template-management
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/templates/page.tsx
  - src/app/templates/new/page.tsx
  - src/components/templates/TemplateCard.tsx
  - src/lib/api/templates.ts
autonomous: true

must_haves:
  truths:
    - "Admin sees list with inactive toggle (hidden by default)"
    - "Admin can create new template via /templates/new page"
    - "Duplicate button appears on TemplateCard for admin users"
  artifacts:
    - path: "src/app/templates/new/page.tsx"
      provides: "Template creation page"
      min_lines: 80
    - path: "src/app/templates/page.tsx"
      provides: "Inactive toggle on list page"
      contains: "showInactive"
  key_links:
    - from: "src/app/templates/new/page.tsx"
      to: "/api/templates"
      via: "createTemplate POST"
      pattern: "createTemplate"
---

<objective>
Create template and enhance list page with inactive toggle and duplicate functionality.

Purpose: TMPL-01 (list all templates) and TMPL-03 (create new template) requirements. The list page exists but needs inactive toggle per CONTEXT.md; create page is linked but doesn't exist.
Output: Working /templates/new page and enhanced list with inactive toggle + duplicate button.
</objective>

<execution_context>
@C:\Users\Mario Giacchino\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\Mario Giacchino\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/16-template-management/16-CONTEXT.md
@.planning/phases/16-template-management/16-RESEARCH.md

# Existing files to modify
@src/app/templates/page.tsx
@src/components/templates/TemplateCard.tsx
@src/lib/api/templates.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add inactive toggle to template list page</name>
  <files>src/app/templates/page.tsx</files>
  <action>
    Add showInactive state (default false) to TemplatesPage.

    In fetchTemplates call, pass { active: !showInactive ? true : undefined } to include inactive when toggle is on.

    Add toggle checkbox before category filter:
    ```tsx
    <label className="flex items-center gap-2 cursor-pointer">
      <input
        type="checkbox"
        checked={showInactive}
        onChange={(e) => setShowInactive(e.target.checked)}
        className="w-4 h-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"
      />
      <span className="text-sm text-gray-700">Inaktive anzeigen</span>
    </label>
    ```

    Update useEffect dependencies to include showInactive.
  </action>
  <verify>Navigate to /templates, confirm inactive templates hidden by default, toggle shows them</verify>
  <done>Inactive toggle filters templates correctly, hidden by default</done>
</task>

<task type="auto">
  <name>Task 2: Add duplicate button to TemplateCard</name>
  <files>src/components/templates/TemplateCard.tsx, src/lib/api/templates.ts</files>
  <action>
    In src/lib/api/templates.ts, add duplicateTemplate function:
    ```typescript
    export async function duplicateTemplate(id: string, newName: string): Promise<Template> {
      const response = await fetch(`/api/templates/${id}/duplicate`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name: newName })
      })
      if (!response.ok) {
        const data = await response.json()
        throw new Error(data.error || 'Fehler beim Duplizieren')
      }
      const data = await response.json()
      return data.template
    }
    ```

    In TemplateCard.tsx:
    1. Add onDuplicate prop: onDuplicate?: (id: string) => void
    2. Add Duplicate button next to Edit button (admin only):
    ```tsx
    <button
      onClick={() => onDuplicate?.(template.id)}
      className="py-2 px-3 bg-gray-100 hover:bg-gray-200 rounded text-sm font-medium text-gray-700 transition-colors min-h-[44px] flex items-center justify-center"
    >
      Duplizieren
    </button>
    ```

    Note: The /api/templates/[id]/duplicate endpoint needs to be created in a separate plan if it doesn't exist. For now, add the UI and API client function. The button can show an alert if endpoint doesn't exist yet.
  </action>
  <verify>TemplateCard shows Duplicate button for admin users</verify>
  <done>Duplicate button visible on TemplateCard for admin, API function ready</done>
</task>

<task type="auto">
  <name>Task 3: Create template new page</name>
  <files>src/app/templates/new/page.tsx</files>
  <action>
    Create src/app/templates/new/page.tsx following the pattern from edit page but for creation.

    Form fields (per CONTEXT.md TMPL-03):
    - name (required)
    - description
    - category (required): complete_renovation, room_specific, trade_specific
    - scope (required): unit, room
    - target_room_type (required if scope=room)

    On submit, call createTemplate from lib/api/templates.ts, then redirect to /templates/[id]/edit for WBS structure editing.

    Admin check: redirect non-admins to /templates.

    Use same styling as edit page: max-w-4xl, card layout, input styling.

    Cancel button returns to /templates.
  </action>
  <verify>Navigate to /templates/new, fill form, submit creates template and redirects to edit page</verify>
  <done>New template can be created with name, category, scope; redirects to edit for structure</done>
</task>

</tasks>

<verification>
1. /templates shows only active templates by default
2. Checking "Inaktive anzeigen" shows inactive templates
3. Admin sees Duplicate button on TemplateCard
4. /templates/new shows create form
5. Creating template redirects to edit page for WBS structure
6. Non-admin users redirected away from /templates/new
</verification>

<success_criteria>
- Inactive toggle works on list page
- Create template page exists at /templates/new
- Duplicate button visible on cards for admin users
- New template can be created and user is redirected to edit for structure
</success_criteria>

<output>
After completion, create `.planning/phases/16-template-management/16-01-SUMMARY.md`
</output>
