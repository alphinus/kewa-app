---
phase: 01-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - next.config.ts
  - tsconfig.json
  - .env.local
  - .env.example
  - src/lib/supabase/client.ts
  - src/lib/supabase/server.ts
  - supabase/migrations/001_initial_schema.sql
autonomous: true

must_haves:
  truths:
    - "Next.js dev server startet ohne Fehler"
    - "Supabase Client verbindet zur Datenbank"
    - "Schema enthält Tabellen: users, buildings, units, projects, tasks"
    - "13 Wohnungen und 9 Gemeinschaftsräume sind als Seed-Daten vorhanden"
  artifacts:
    - path: "package.json"
      provides: "Next.js 15 + Supabase dependencies"
      contains: "@supabase/supabase-js"
    - path: "src/lib/supabase/client.ts"
      provides: "Browser Supabase client"
      exports: ["createClient"]
    - path: "src/lib/supabase/server.ts"
      provides: "Server-side Supabase client"
      exports: ["createClient"]
    - path: "supabase/migrations/001_initial_schema.sql"
      provides: "Database schema with hierarchy"
      contains: "CREATE TABLE"
  key_links:
    - from: "src/lib/supabase/client.ts"
      to: "NEXT_PUBLIC_SUPABASE_URL"
      via: "environment variable"
    - from: "supabase/migrations/001_initial_schema.sql"
      to: "Supabase project"
      via: "migration applied"
---

<objective>
Initialize Next.js project with Supabase and create database schema for the property management app.

Purpose: Establish the technical foundation — working dev environment with database structure.
Output: Runnable Next.js app connected to Supabase with complete schema for Gebäude → Einheit → Projekt → Aufgabe hierarchy.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Initialize Next.js 15 project with TypeScript</name>
  <files>package.json, next.config.ts, tsconfig.json, src/app/layout.tsx, src/app/page.tsx</files>
  <action>
    Initialize Next.js 15 project with App Router and TypeScript:
    - npx create-next-app@latest . --typescript --tailwind --eslint --app --src-dir --import-alias "@/*" --use-npm
    - If directory not empty, confirm overwrite
    - Verify package.json has next@15, react@19
    - Add to next.config.ts: output: 'standalone' for Vercel deployment

    Do NOT add any extra dependencies yet — only what create-next-app provides.
  </action>
  <verify>npm run dev starts without errors, http://localhost:3000 shows Next.js welcome page</verify>
  <done>Next.js 15 project initialized with TypeScript, Tailwind, App Router</done>
</task>

<task type="auto">
  <name>Task 2: Add Supabase and configure clients</name>
  <files>package.json, .env.local, .env.example, src/lib/supabase/client.ts, src/lib/supabase/server.ts</files>
  <action>
    Install Supabase client:
    - npm install @supabase/supabase-js @supabase/ssr

    Create .env.example (committed to git) with placeholder values:
    ```
    NEXT_PUBLIC_SUPABASE_URL=your-project-url
    NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key
    ```

    Create .env.local (gitignored) — get actual values from user's Supabase dashboard:
    - NEXT_PUBLIC_SUPABASE_URL
    - NEXT_PUBLIC_SUPABASE_ANON_KEY

    Create src/lib/supabase/client.ts (browser client):
    ```typescript
    import { createBrowserClient } from '@supabase/ssr'

    export function createClient() {
      return createBrowserClient(
        process.env.NEXT_PUBLIC_SUPABASE_URL!,
        process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!
      )
    }
    ```

    Create src/lib/supabase/server.ts (server client for API routes):
    ```typescript
    import { createServerClient } from '@supabase/ssr'
    import { cookies } from 'next/headers'

    export async function createClient() {
      const cookieStore = await cookies()
      return createServerClient(
        process.env.NEXT_PUBLIC_SUPABASE_URL!,
        process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
        {
          cookies: {
            getAll() { return cookieStore.getAll() },
            setAll(cookiesToSet) {
              cookiesToSet.forEach(({ name, value, options }) => {
                cookieStore.set(name, value, options)
              })
            },
          },
        }
      )
    }
    ```
  </action>
  <verify>npm run build succeeds, TypeScript compiles without errors</verify>
  <done>Supabase SSR clients configured for both browser and server usage</done>
</task>

<task type="auto">
  <name>Task 3: Create database schema with building hierarchy</name>
  <files>supabase/migrations/001_initial_schema.sql</files>
  <action>
    Create migration file with complete schema:

    **users table** (for PIN auth):
    - id: uuid primary key
    - pin_hash: text not null (bcrypt hashed PIN)
    - role: text check (role in ('kewa', 'imeri'))
    - display_name: text
    - created_at: timestamptz

    **buildings table**:
    - id: uuid primary key
    - name: text not null
    - address: text
    - created_at: timestamptz

    **units table** (Wohnungen + Gemeinschaftsräume):
    - id: uuid primary key
    - building_id: uuid references buildings
    - name: text not null (e.g., "EG Links", "Waschküche")
    - unit_type: text check (unit_type in ('apartment', 'common_area', 'building'))
    - floor: integer (null for common areas)
    - position: text (e.g., 'left', 'middle', 'right')
    - tenant_name: text (null for common areas)
    - tenant_visible_to_imeri: boolean default true
    - created_at: timestamptz

    **projects table**:
    - id: uuid primary key
    - unit_id: uuid references units
    - name: text not null (e.g., "Badezimmer", "Küche")
    - description: text
    - status: text check (status in ('active', 'completed', 'archived'))
    - visible_to_imeri: boolean default true
    - created_at: timestamptz

    **tasks table**:
    - id: uuid primary key
    - project_id: uuid references projects
    - title: text not null
    - description: text
    - status: text check (status in ('open', 'completed'))
    - priority: text check (priority in ('low', 'normal', 'high', 'urgent'))
    - due_date: date
    - completed_at: timestamptz
    - completion_note: text
    - recurring_type: text check (recurring_type in ('none', 'weekly', 'monthly'))
    - created_at: timestamptz
    - updated_at: timestamptz

    Add indexes on foreign keys for query performance.
    Add RLS policies later (in auth plan).

    Include seed data for the building:
    - 1 building (the Liegenschaft)
    - 13 apartments: EG (3), 1.OG (3), 2.OG (3), 3.OG (3), Dach (1)
    - 9 common areas: Keller, Waschküche, Veloraum, Heizungsraum, Pelletraum, Treppenhaus, Trockenraum, Magazin, Gartenbereich
    - 1 "Gesamtes Gebäude" unit for building-wide tasks
    - 2 users: KEWA AG (role: kewa), Imeri (role: imeri) with placeholder PIN hashes
  </action>
  <verify>Migration file is valid SQL, can be applied to Supabase project</verify>
  <done>Complete schema with building hierarchy and seed data ready for migration</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npm run dev starts Next.js without errors
- [ ] npm run build succeeds
- [ ] TypeScript has no errors (npm run type-check or tsc --noEmit)
- [ ] .env.example exists with placeholder Supabase variables
- [ ] src/lib/supabase/client.ts and server.ts export createClient
- [ ] supabase/migrations/001_initial_schema.sql contains all tables and seed data
</verification>

<success_criteria>
- Next.js 15 project running with TypeScript and Tailwind
- Supabase clients configured for browser and server
- Database schema defines complete hierarchy: users, buildings, units, projects, tasks
- Seed data includes 13 apartments, 9 common areas, 2 users
- All files committed and ready for next plan
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-01-SUMMARY.md`
</output>
