---
phase: 33-bundle-rendering-optimization
plan: 02
type: execute
wave: 2
depends_on: ["33-01"]
files_modified: []
autonomous: true

must_haves:
  truths:
    - "Dashboard pages fetch independent data in parallel (Promise.all or concurrent React queries)"
    - "Build output confirms static routes where auth not required"
    - "Bundle analyzer confirms 100+ KB reduction in initial bundle"
    - "LCP improved by 20%+ from Phase 31 baseline"
  artifacts:
    - path: ".planning/phases/33-bundle-rendering-optimization/33-02-SUMMARY.md"
      provides: "Verification results and metrics"
      contains: "Bundle reduction"
  key_links:
    - from: "build output"
      to: "route classification"
      via: "npm run build"
      pattern: "Static|Dynamic"
---

<objective>
Verify parallel data fetching, audit build output for static routes, and measure bundle/LCP improvements.

Purpose: PERF-05 (parallel fetching) and PERF-06 (dynamic API audit) require verification more than implementation. The research shows most patterns are already correct. This plan confirms the state and measures success criteria.

Output: Verification report documenting parallel fetch patterns, route classification, bundle reduction, and LCP improvement
</objective>

<execution_context>
@C:\Users\Mario Giacchino\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\Mario Giacchino\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/33-bundle-rendering-optimization/33-RESEARCH.md
@.planning/phases/33-bundle-rendering-optimization/33-01-SUMMARY.md

# Phase 31 baseline for comparison
@.planning/phases/31-performance-profiling/31-03-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Verify parallel data fetching patterns (PERF-05)</name>
  <files>None modified - audit only</files>
  <action>
    Audit dashboard pages for parallel fetch patterns:

    1. Search for pages with multiple fetch calls:
       ```bash
       grep -r "Promise.all" src/app/dashboard --include="*.tsx"
       grep -r "await fetch" src/app/dashboard --include="*.tsx"
       ```

    2. Review these key pages from research:
       - /dashboard/page.tsx - should use Promise.all
       - /dashboard/projekte/page.tsx - should use Promise.all
       - /dashboard/liegenschaft/page.tsx - audit for sequential fetches
       - /dashboard/kosten/wohnungen/[id]/page.tsx - server component parallel

    3. For any sequential fetch patterns found:
       - If easily fixable (same useEffect, independent data): Convert to Promise.all
       - If complex (dependent data, different effects): Document as acceptable

    4. Document findings in verification section of summary

    Note: Research indicates most parallel patterns already implemented. This task confirms rather than transforms.
  </action>
  <verify>
    grep -r "Promise.all" src/app/dashboard --include="*.tsx" | wc -l
    Manual review confirms independent fetches use Promise.all
  </verify>
  <done>All dashboard pages with independent data fetches use parallel patterns (Promise.all or concurrent server fetches)</done>
</task>

<task type="auto">
  <name>Task 2: Audit build output and measure improvements</name>
  <files>None modified - verification only</files>
  <action>
    Run full verification suite:

    1. Build and capture route classification:
       ```bash
       npm run build 2>&1 | tee build.log
       ```
       Check for:
       - Static routes (circle symbol)
       - Dynamic routes (lambda symbol)
       - Verify no unexpected dynamic routes from layout cookies()/headers()

    2. Run bundle analyzer:
       ```bash
       npm run analyze
       ```
       Document:
       - Total client JS size (compare to 2.27MB baseline from Phase 31)
       - Verify Recharts and TipTap in separate chunks (not in first-load JS)
       - Calculate reduction in initial bundle

    3. Run Lighthouse on login page (3 runs, take median):
       ```bash
       npx lighthouse http://localhost:3000/login --output=json --output-path=./lighthouse-33.json
       ```
       Compare to Phase 31 baseline:
       - LCP: 3204ms baseline, target 2560ms (-20%)
       - TBT: 338ms baseline (may improve if main bundle smaller)
       - Performance score: 83 baseline

    4. Success thresholds:
       - Bundle reduction: 100+ KB in initial load
       - LCP improvement: 20%+ (< 2563ms)
       - No new unexpected dynamic routes

    Document all findings in summary with before/after comparison.
  </action>
  <verify>
    Bundle analyzer report shows Recharts/TipTap in separate chunks
    LCP < 2563ms (20% improvement from 3204ms)
    Build completes successfully
  </verify>
  <done>Build verification complete with documented bundle reduction and LCP improvement metrics</done>
</task>

</tasks>

<verification>
After both tasks complete:
1. All parallel fetch patterns documented
2. Build output shows expected static/dynamic route classification
3. Bundle analyzer confirms 100+ KB reduction
4. Lighthouse shows LCP improvement of 20%+
5. All findings documented in summary
</verification>

<success_criteria>
- PERF-05: Dashboard pages verified to use parallel data fetching (Promise.all pattern or concurrent server fetches)
- PERF-06: Build output audited, no unnecessary dynamic routes from layout dynamic APIs
- Phase 33 success criteria met:
  1. Network DevTools shows parallel requests (not waterfall)
  2. Build output shows static routes where possible
  3. Bundle reduced by 100+ KB (from lazy loading in 33-01)
  4. LCP improved by 20%+ compared to Phase 31 baseline
</success_criteria>

<output>
After completion, create `.planning/phases/33-bundle-rendering-optimization/33-02-SUMMARY.md`
</output>
