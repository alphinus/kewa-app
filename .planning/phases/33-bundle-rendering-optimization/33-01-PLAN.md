---
phase: 33-bundle-rendering-optimization
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/dashboard/projekte/[id]/aenderungsauftraege/page.tsx
  - src/app/dashboard/lieferanten/analytics/preise/page.tsx
  - src/app/dashboard/lieferanten/analytics/verbrauch/page.tsx
  - src/app/dashboard/knowledge/new/page.tsx
  - src/app/dashboard/knowledge/[id]/edit/page.tsx
  - src/app/dashboard/knowledge/[id]/page.tsx
autonomous: true

must_haves:
  truths:
    - "BudgetImpactChart chunk loads only when change orders page accessed"
    - "PriceHistoryChart chunk loads only when price analytics page accessed"
    - "ConsumptionPatternChart chunk loads only when consumption analytics page accessed"
    - "ArticleEditor chunk loads only when editing knowledge articles"
    - "ArticleViewer chunk loads only when viewing knowledge articles"
    - "Loading placeholders display while chunks download"
  artifacts:
    - path: "src/app/dashboard/projekte/[id]/aenderungsauftraege/page.tsx"
      provides: "Lazy loaded BudgetImpactChart"
      contains: "dynamic("
    - path: "src/app/dashboard/lieferanten/analytics/preise/page.tsx"
      provides: "Lazy loaded PriceHistoryChart"
      contains: "dynamic("
    - path: "src/app/dashboard/lieferanten/analytics/verbrauch/page.tsx"
      provides: "Lazy loaded ConsumptionPatternChart"
      contains: "dynamic("
    - path: "src/app/dashboard/knowledge/new/page.tsx"
      provides: "Lazy loaded ArticleEditor"
      contains: "dynamic("
    - path: "src/app/dashboard/knowledge/[id]/edit/page.tsx"
      provides: "Lazy loaded ArticleEditor"
      contains: "dynamic("
    - path: "src/app/dashboard/knowledge/[id]/page.tsx"
      provides: "Lazy loaded ArticleViewer"
      contains: "dynamic("
  key_links:
    - from: "page files"
      to: "next/dynamic"
      via: "import dynamic from 'next/dynamic'"
      pattern: "import dynamic from 'next/dynamic'"
---

<objective>
Lazy load heavy Recharts and TipTap components to reduce initial bundle size by 100+ KB.

Purpose: Recharts (337KB) and TipTap/ProseMirror (292KB) dominate the bundle. These components are only used on specific pages, not the initial dashboard load. Lazy loading them moves their code into separate chunks that download on demand.

Output: 6 page files updated with `next/dynamic` imports and loading placeholders
</objective>

<execution_context>
@C:\Users\Mario Giacchino\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\Mario Giacchino\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/33-bundle-rendering-optimization/33-RESEARCH.md

# Existing lazy loading pattern to follow
@src/app/templates/[id]/page.tsx (lines 12-14 show React.lazy pattern)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Lazy load Recharts charts (3 pages)</name>
  <files>
    src/app/dashboard/projekte/[id]/aenderungsauftraege/page.tsx
    src/app/dashboard/lieferanten/analytics/preise/page.tsx
    src/app/dashboard/lieferanten/analytics/verbrauch/page.tsx
  </files>
  <action>
    Replace direct imports with next/dynamic for chart components:

    1. In aenderungsauftraege/page.tsx:
       - Remove: `import { BudgetImpactChart } from '@/components/change-orders/BudgetImpactChart'`
       - Add: `import dynamic from 'next/dynamic'`
       - Add lazy import:
         ```typescript
         const BudgetImpactChart = dynamic(
           () => import('@/components/change-orders/BudgetImpactChart').then(mod => mod.BudgetImpactChart),
           {
             loading: () => (
               <div className="w-full h-[400px] flex items-center justify-center bg-gray-50 rounded-lg border animate-pulse">
                 <div className="text-center">
                   <div className="w-8 h-8 border-2 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto" />
                   <p className="text-gray-500 mt-2 text-sm">Diagramm wird geladen...</p>
                 </div>
               </div>
             ),
             ssr: false
           }
         )
         ```

    2. In lieferanten/analytics/preise/page.tsx:
       - Remove: `import { PriceHistoryChart } from '@/components/suppliers'`
       - Add: `import dynamic from 'next/dynamic'`
       - Add lazy import:
         ```typescript
         const PriceHistoryChart = dynamic(
           () => import('@/components/suppliers/PriceHistoryChart').then(mod => mod.PriceHistoryChart),
           {
             loading: () => (
               <div className="w-full h-[350px] flex items-center justify-center bg-gray-50 rounded-lg border animate-pulse">
                 <div className="text-center">
                   <div className="w-8 h-8 border-2 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto" />
                   <p className="text-gray-500 mt-2 text-sm">Diagramm wird geladen...</p>
                 </div>
               </div>
             ),
             ssr: false
           }
         )
         ```

    3. In lieferanten/analytics/verbrauch/page.tsx:
       - Remove: `import { ConsumptionPatternChart } from '@/components/suppliers'`
       - Add: `import dynamic from 'next/dynamic'`
       - Add lazy import:
         ```typescript
         const ConsumptionPatternChart = dynamic(
           () => import('@/components/suppliers/ConsumptionPatternChart').then(mod => mod.ConsumptionPatternChart),
           {
             loading: () => (
               <div className="w-full h-[350px] flex items-center justify-center bg-gray-50 rounded-lg border animate-pulse">
                 <div className="text-center">
                   <div className="w-8 h-8 border-2 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto" />
                   <p className="text-gray-500 mt-2 text-sm">Diagramm wird geladen...</p>
                 </div>
               </div>
             ),
             ssr: false
           }
         )
         ```

    Note: Import from specific file path (not barrel) to avoid loading other components.
  </action>
  <verify>
    npm run build -- no errors
    Network DevTools shows separate chunk for recharts when navigating to chart pages
  </verify>
  <done>All 3 Recharts chart imports converted to next/dynamic with loading placeholders</done>
</task>

<task type="auto">
  <name>Task 2: Lazy load TipTap editor and viewer (3 pages)</name>
  <files>
    src/app/dashboard/knowledge/new/page.tsx
    src/app/dashboard/knowledge/[id]/edit/page.tsx
    src/app/dashboard/knowledge/[id]/page.tsx
  </files>
  <action>
    Replace direct imports with next/dynamic for TipTap components:

    1. In knowledge/new/page.tsx:
       - Remove: `import { ArticleEditor } from '@/components/knowledge/ArticleEditor'`
       - Add: `import dynamic from 'next/dynamic'`
       - Add lazy import:
         ```typescript
         const ArticleEditor = dynamic(
           () => import('@/components/knowledge/ArticleEditor').then(mod => mod.ArticleEditor),
           {
             loading: () => (
               <div className="border rounded-lg overflow-hidden">
                 <div className="h-12 bg-gray-50 border-b animate-pulse" />
                 <div className="min-h-[300px] p-4 bg-gray-100 animate-pulse" />
               </div>
             ),
             ssr: false
           }
         )
         ```

    2. In knowledge/[id]/edit/page.tsx:
       - Same pattern as knowledge/new/page.tsx

    3. In knowledge/[id]/page.tsx:
       - Check current import for ArticleViewer
       - If direct import exists, convert to:
         ```typescript
         const ArticleViewer = dynamic(
           () => import('@/components/knowledge/ArticleViewer').then(mod => mod.ArticleViewer),
           {
             loading: () => (
               <div className="prose max-w-none animate-pulse">
                 <div className="h-6 bg-gray-200 rounded w-3/4 mb-4" />
                 <div className="h-4 bg-gray-200 rounded w-full mb-2" />
                 <div className="h-4 bg-gray-200 rounded w-5/6 mb-2" />
                 <div className="h-4 bg-gray-200 rounded w-4/5" />
               </div>
             ),
             ssr: false
           }
         )
         ```

    Note: `ssr: false` is critical for TipTap as it uses browser APIs.
  </action>
  <verify>
    npm run build -- no errors
    Navigate to /dashboard/knowledge/new - editor loads after short delay
    Navigate to /dashboard/knowledge/[id] - viewer loads after short delay
  </verify>
  <done>All 3 TipTap component imports converted to next/dynamic with loading placeholders</done>
</task>

</tasks>

<verification>
After both tasks complete:
1. `npm run build` completes without errors
2. Bundle analysis shows separate chunks for:
   - Recharts (should not be in main bundle)
   - TipTap/ProseMirror (should not be in main bundle)
3. Loading dashboard does NOT load chart or editor code
4. Loading placeholders appear briefly when navigating to lazy-loaded pages
</verification>

<success_criteria>
- All 6 page files use next/dynamic for heavy components
- Build succeeds without type errors
- Loading placeholders render with correct dimensions (no CLS)
- Heavy component chunks load only on demand (verifiable in Network tab)
</success_criteria>

<output>
After completion, create `.planning/phases/33-bundle-rendering-optimization/33-01-SUMMARY.md`
</output>
