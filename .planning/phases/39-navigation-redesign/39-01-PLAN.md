---
phase: 39-navigation-redesign
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/navigation/mobile-nav.tsx
  - src/components/navigation/MehrBottomSheet.tsx
  - src/app/globals.css
  - src/app/dashboard/layout.tsx
autonomous: true
requirements:
  - NAV-02

must_haves:
  truths:
    - "Mobile footer shows exactly 5 items: Übersicht, Objekte, Aufgaben, Kosten, Mehr"
    - "Tapping Mehr opens a bottom sheet with 10 overflow items"
    - "Tapping outside the bottom sheet or swiping down dismisses it"
    - "Mehr button shows active state when current page is one of the overflow items"
  artifacts:
    - path: "src/components/navigation/mobile-nav.tsx"
      provides: "5-item footer with Mehr button"
      contains: "Objekte"
    - path: "src/components/navigation/MehrBottomSheet.tsx"
      provides: "Bottom sheet with 10 overflow navigation items"
      contains: "Projekte"
    - path: "src/app/globals.css"
      provides: "slideInFromBottom CSS keyframe animation"
      contains: "slideInFromBottom"
  key_links:
    - from: "src/components/navigation/mobile-nav.tsx"
      to: "src/components/navigation/MehrBottomSheet.tsx"
      via: "MehrBottomSheet component rendered and toggled by Mehr button state"
      pattern: "MehrBottomSheet"
    - from: "src/app/dashboard/layout.tsx"
      to: "src/components/navigation/mobile-nav.tsx"
      via: "MobileNav rendered in layout"
      pattern: "MobileNav"
---

<objective>
Reduce the mobile footer from 8 navigation items to 5, and add a "Mehr" bottom sheet for the overflow items.

Purpose: Simplify primary navigation to the 5 highest-frequency features, with all other features accessible within 2 taps via the Mehr bottom sheet (D1, D2).
Output: Updated MobileNav with 5 items, new MehrBottomSheet component, CSS animation.
</objective>

<execution_context>
@C:/Users/Mario Giacchino/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Mario Giacchino/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/39-navigation-redesign/39-CONTEXT.md
@.planning/phases/39-navigation-redesign/39-RESEARCH.md
@src/components/navigation/mobile-nav.tsx
@src/app/dashboard/layout.tsx
@src/app/globals.css
@src/app/contractor/[token]/[workOrderId]/reject-modal.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create MehrBottomSheet and update MobileNav to 5 items</name>
  <files>
    src/components/navigation/MehrBottomSheet.tsx
    src/components/navigation/mobile-nav.tsx
    src/app/globals.css
  </files>
  <action>
**1. Create `src/components/navigation/MehrBottomSheet.tsx`:**
- 'use client' component with props: `open: boolean`, `onClose: () => void`
- Lock body scroll when open (`document.body.style.overflow = 'hidden'`, cleanup on unmount)
- Render fixed backdrop `fixed inset-0 bg-black/50 z-[60] flex items-end` with onClick={onClose}
- Inner container: `w-full bg-white dark:bg-gray-900 rounded-t-2xl safe-area-bottom animate-slide-in-bottom`
- Stop propagation on inner container click
- Drag handle: centered `w-10 h-1 bg-gray-300 dark:bg-gray-600 rounded-full` bar
- Grid layout `grid grid-cols-4 gap-2 p-4 pb-6` for items
- 10 items per D2, each as a Next.js Link with onClick={onClose}:
  | Label | Icon (lucide-react) | Route |
  |-------|-----|-------|
  | Projekte | Archive | /dashboard/projekte |
  | Lieferanten | Truck | /dashboard/lieferanten |
  | Berichte | FileText | /dashboard/berichte |
  | Abnahmen | ClipboardCheck | /dashboard/abnahmen |
  | Änderungsaufträge | FilePen | /dashboard/aenderungsauftraege |
  | Vorlagen | FileStack | /dashboard/vorlagen/abnahmen |
  | Knowledge Base | BookOpen | /dashboard/knowledge |
  | Audio | Mic | /dashboard/audio |
  | Benachrichtigungen | Bell | /dashboard/benachrichtigungen |
  | Einstellungen | Settings | /dashboard/settings |
- Each item: flex col, icon `h-6 w-6 text-gray-600 dark:text-gray-400`, label `text-xs text-gray-700 dark:text-gray-300 text-center leading-tight`
- Export as named export `MehrBottomSheet`
- If `!open` return null (no render)

**2. Update `src/components/navigation/mobile-nav.tsx`:**
- Replace the 8-item `internalNavItems` array with 4 link items per D1:
  | Label | Icon | Route |
  |-------|------|-------|
  | Übersicht | LayoutDashboard | /dashboard |
  | Objekte | Landmark | /dashboard/objekte |
  | Aufgaben | CheckSquare | /dashboard/aufgaben |
  | Kosten | Banknote | /dashboard/kosten |
- Add `Banknote, Menu` to lucide-react imports, remove `Building2, FileText, Archive, Settings, Truck`
- Add state: `const [mehrOpen, setMehrOpen] = useState(false)` (import useState)
- Define `MEHR_ROUTES` array with all 10 Mehr item hrefs (for active state detection)
- After the 4 Link items in the nav bar, render a 5th button (not Link) for "Mehr":
  - Same styling as nav items but using `<button>` with `onClick={() => setMehrOpen(true)}`
  - Icon: `Menu` from lucide-react
  - Label: "Mehr"
  - Active state: `pathname` starts with any route in `MEHR_ROUTES` array, OR `mehrOpen` is true
- Render `<MehrBottomSheet open={mehrOpen} onClose={() => setMehrOpen(false)} />` as sibling after the nav element (outside the nav bar, at component root level)
- Import MehrBottomSheet from './MehrBottomSheet'

**3. Add CSS animation to `src/app/globals.css`:**
- Add after the existing `slideInFromRight` keyframe block:
```css
@keyframes slideInFromBottom {
  from { transform: translateY(100%); }
  to   { transform: translateY(0); }
}
.animate-slide-in-bottom {
  animation: slideInFromBottom 0.25s ease-out forwards;
}
```
  </action>
  <verify>
Run `npx tsc --noEmit` to confirm no type errors. Grep for `slideInFromBottom` in globals.css. Grep for `MehrBottomSheet` in mobile-nav.tsx.
  </verify>
  <done>
MobileNav renders 5 items (4 links + 1 Mehr button). MehrBottomSheet opens with 10 items on Mehr tap. Bottom sheet has slide-up animation and backdrop dismiss. Mehr button shows active state when current page matches an overflow route.
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire MobileNav into dashboard layout</name>
  <files>
    src/app/dashboard/layout.tsx
  </files>
  <action>
No changes needed to `src/app/dashboard/layout.tsx` — it already renders `<MobileNav isInternal={user?.isInternal} />` which will pick up the updated component from Task 1. Verify this is still correct by reading the file and confirming the MobileNav import and usage are intact.

The MehrBottomSheet is rendered inside MobileNav (as a sibling to the nav bar), so no layout changes are needed. The z-[60] on the bottom sheet places it above the nav's z-50.
  </action>
  <verify>
Read `src/app/dashboard/layout.tsx` and confirm `<MobileNav isInternal={user?.isInternal} />` is present. Run `npx tsc --noEmit` to confirm no type errors across the project.
  </verify>
  <done>
Dashboard layout continues to render MobileNav which now includes the 5-item footer and MehrBottomSheet. No layout file changes required.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with no errors
2. `MehrBottomSheet.tsx` exists and exports `MehrBottomSheet`
3. `mobile-nav.tsx` has exactly 4 link items + 1 Mehr button
4. `globals.css` contains `slideInFromBottom` keyframe
5. Dashboard layout renders MobileNav
</verification>

<success_criteria>
- Mobile footer shows 5 items: Übersicht, Objekte, Aufgaben, Kosten, Mehr
- Mehr button renders MehrBottomSheet with 10 overflow items
- Bottom sheet has slide-up animation and backdrop dismiss
- Mehr active state highlights when on an overflow route
- No TypeScript compilation errors
</success_criteria>

<output>
After completion, create `.planning/phases/39-navigation-redesign/39-01-SUMMARY.md`
</output>
