# Milestone v2.0: Renovation Operations MVP

**Status:** SHIPPED 2026-01-19
**Phases:** 7-12.3
**Total Plans:** 31

## Overview

Transformation von einfacher Task-App zu vollständigem Renovations-Management-System mit externem Handwerker-Portal, Template-System, Kosten-Tracking und Digital Twin.

| Macro-Phase | Phases | Requirements | Focus |
|-------------|--------|--------------|-------|
| MVP (Phase 1) | 7-12.3 | 92 | Core system, external contractors, costs, dashboard |

## Phases

### Phase 7: Foundation & Data Model

**Goal**: Solides Fundament — Datenmodell, Rollen, Audit-Logging, Tech Debt bereinigt
**Depends on**: v1 (Phases 1-6)
**Plans**: 5 plans

Plans:
- [x] 07-01: Tech Debt Resolution
- [x] 07-02: Core Entity Schema
- [x] 07-03: Financial Entity Schema
- [x] 07-04: RBAC & Auth
- [x] 07-05: Status Workflows & Audit

**Details:**
- Requirements: DEBT-01-04, DATA-01-15, AUTH-01-09, STAT-01-04, NFR-01-06 (38 total)
- All 15 entities migrated to Supabase
- 5 roles with granular permissions
- 3 auth methods (PIN, Email, Magic-Link)
- Audit log for all changes
- Tech debt resolved (middleware, turbopack, session)

---

### Phase 8: Template System

**Goal**: Wiederverwendbare Renovations-Vorlagen mit WBS-Struktur
**Depends on**: Phase 7
**Plans**: 4 plans

Plans:
- [x] 08-01: Template Schema & Types
- [x] 08-02: Template CRUD & Library UI
- [x] 08-03: Template Application
- [x] 08-04: Quality Gates & Timeline

**Details:**
- Requirements: TMPL-01-06 (6 total)
- Template library with 3+ templates
- WBS: Phases → Packages → Tasks with dependencies
- Quality gates with evidence requirements
- Atomic template application via PostgreSQL function
- Gantt chart visualization

---

### Phase 9: External Contractor Portal

**Goal**: Handwerker können Aufträge via Magic-Link annehmen/ablehnen
**Depends on**: Phase 7, Phase 8
**Plans**: 5 plans

Plans:
- [x] 09-01: Work Order CRUD & PDF
- [x] 09-02: Contractor Portal & Dashboard
- [x] 09-03: Counter-Offer Flow
- [x] 09-04: File Uploads
- [x] 09-05: Event Logging & Deadlines

**Details:**
- Requirements: EXT-01-14, EXT-16 (15 of 16, EXT-15 deferred)
- WorkOrder creation with all required fields
- PDF generation via @react-pdf/renderer
- Email with magic link (mailto)
- Contractor portal: View, Accept, Reject, Counter-offer, Upload
- Tracking: Viewed status, deadlines
- **Deferred:** EXT-15 (Automatic reminders) — requires background job infrastructure

---

### Phase 10: Cost & Finance

**Goal**: Vollständige Kostenübersicht: Offerten → Rechnungen → Zahlungen
**Depends on**: Phase 7, Phase 9
**Plans**: 6 plans

Plans:
- [x] 10-01: Invoice Approval Workflow
- [x] 10-02: Manual Expense Entry
- [x] 10-03: Payment Tracking
- [x] 10-04: Project Cost Dashboard
- [x] 10-05: CSV Export for Accounting
- [x] 10-06: Unit Investment View and Rent Entry

**Details:**
- Requirements: COST-01-06, RENT-01-03 (9 total)
- Cost workflow: Offer → Contract → Invoice → Payment
- Manual expenses (cash, receipts)
- Aggregation by project, unit, room, partner
- Variance: Offer vs Invoice
- CSV export with Swiss formatting
- Rent per unit + investment overview

---

### Phase 11: History & Digital Twin

**Goal**: Automatische Zustandsverfolgung — Unit-Timeline und Raum-Condition
**Depends on**: Phase 7, Phase 9, Phase 10
**Plans**: 3 plans

Plans:
- [x] 11-01: Unit Timeline View
- [x] 11-02: Room Condition Grid
- [x] 11-03: Condition Automation Verification

**Details:**
- Requirements: HIST-01-05 (5 total)
- Unit timeline shows all projects/work orders/costs/media
- Renovation progress per room derivable
- Automation: Project approved → Room condition = new
- Unit summary (% renovated) calculated automatically

---

### Phase 12: Dashboard & Visualization

**Goal**: Visuelle Übersicht — Heatmap, Parkplätze, Auslastung, Kommentare
**Depends on**: Phase 11
**Plans**: 5 plans

Plans:
- [x] 12-01: Parking Schema & Basic Display
- [x] 12-02: Dashboard Layout & Building Heatmap
- [x] 12-03: Occupancy Dashboard
- [x] 12-04: Drilldown Navigation & Side Panel
- [x] 12-05: Comments System

**Details:**
- Requirements: DASH-01-06, PARK-01-05, OCCU-01-04, COMM-01-03 (18 total)
- Property-level dashboard with heatmap (units × rooms)
- Drilldown: Property → Unit → Room → Project → Tasks
- 8 parking spots vertically next to building
- Occupancy calculated from apartments + parking
- Comments on tasks/work orders with timestamps

---

### Phase 12.1: Project Detail & Navigation (INSERTED)

**Goal**: Enable navigation to project details and template application
**Depends on**: Phase 12
**Plans**: 1 plan

Plans:
- [x] 12.1-01: Project Detail Page

**Details:**
- Gap closure: INT-01 (No project detail page)
- Project detail page at `/dashboard/projekte/[id]`
- "Vorlage anwenden" button links to apply-template page
- Project list cards navigate to detail page

---

### Phase 12.2: Invoice Creation UI (INSERTED)

**Goal**: Enable invoice creation from completed work orders
**Depends on**: Phase 12.1
**Plans**: 1 plan

Plans:
- [x] 12.2-01: Invoice Creation Form & Page

**Details:**
- Gap closure: INT-02 (No invoice creation UI)
- InvoiceForm component with work order pre-fill
- "Neue Rechnung" page at `/dashboard/kosten/rechnungen/neu`
- "Rechnung erstellen" action from completed work orders

---

### Phase 12.3: Fix Navigation Links (INSERTED)

**Goal**: Fix broken navigation links identified in milestone audit
**Depends on**: Phase 12.2
**Plans**: 1 plan

Plans:
- [x] 12.3-01: Fix Navigation Links

**Details:**
- Gap closure: Navigation link fixes
- Replace `/dashboard/renovationen` with `/dashboard/projekte` in 3 files
- Replace `/dashboard/gebaeude` with `/dashboard/liegenschaft`

---

## Milestone Summary

**Decimal Phases:**
- Phase 12.1: Project Detail & Navigation (inserted after Phase 12 for INT-01 gap)
- Phase 12.2: Invoice Creation UI (inserted after Phase 12.1 for INT-02 gap)
- Phase 12.3: Fix Navigation Links (inserted after Phase 12.2 for link fixes)

**Key Decisions:**
- Magic-Link for Contractors: No login needed, secure, trackable
- Template System (WBS): Standardized renovations, fewer errors
- Digital Twin (Condition): Automatic history, no manual maintenance
- Cost Workflow: Offer → Invoice → Payment = accounting reality
- @react-pdf/renderer: No Puppeteer needed, React-native syntax
- State Machine via JSONB: Declarative transitions, trigger enforcement
- CSS Gantt over library: Simpler, no license, full control
- Server Components for Dashboard: Direct DB access, no client overhead
- Swiss VAT 8.0%: 2024 Swiss VAT rate for invoices

**Issues Resolved:**
- INT-01: No project detail page → Phase 12.1
- INT-02: No invoice creation UI → Phase 12.2
- Navigation links to non-existent routes → Phase 12.3
- Next.js 16 middleware deprecation warning (DEBT-01)
- Turbopack build race conditions (DEBT-02)
- Inconsistent session fetching pattern (DEBT-03)

**Issues Deferred:**
- EXT-15: Automatic reminders (24h + 48h) — requires background job infrastructure

**Technical Debt Incurred:**
- QualityGateEditor/QualityGateProgress/DependencyEditor components created but not wired to UI
- CommentList/CommentForm components ready but not integrated into task/work-order views
- Task room_id must be manually assigned for condition triggers
- Mock occupancy history data (needs occupancy_history table for real history)
- Logo placeholder in contractor portal layout

---

_For current project status, see .planning/ROADMAP.md_

---
*Archived: 2026-01-19 as part of v2.0 milestone completion*
