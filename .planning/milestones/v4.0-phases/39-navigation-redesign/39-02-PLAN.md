---
phase: 39-navigation-redesign
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/navigation/DashboardBreadcrumbs.tsx
  - src/app/dashboard/objekte/page.tsx
  - src/app/dashboard/objekte/[propertyId]/page.tsx
autonomous: true
requirements:
  - NAV-01
  - NAV-03

must_haves:
  truths:
    - "Breadcrumbs display on all dashboard pages except /dashboard home"
    - "On /objekte drill-down pages breadcrumbs show: Objekte > PropertyName > BuildingName > UnitName"
    - "On non-object pages breadcrumbs show: Übersicht > PageName"
    - "/dashboard/objekte shows property cards grouped by mandate"
    - "Single-mandate orgs show no mandate header"
    - "Clicking a property card navigates to /dashboard/objekte/[propertyId]"
    - "/dashboard/objekte/[propertyId] shows list of buildings for that property"
  artifacts:
    - path: "src/components/navigation/DashboardBreadcrumbs.tsx"
      provides: "Breadcrumb component with segment label map and UUID override"
      contains: "DashboardBreadcrumbs"
    - path: "src/app/dashboard/objekte/page.tsx"
      provides: "Property list page grouped by mandate"
      contains: "objekte"
    - path: "src/app/dashboard/objekte/[propertyId]/page.tsx"
      provides: "Property detail page showing buildings"
      contains: "propertyId"
  key_links:
    - from: "src/app/dashboard/objekte/page.tsx"
      to: "/api/properties"
      via: "fetch call for property list"
      pattern: "api/properties"
    - from: "src/app/dashboard/objekte/[propertyId]/page.tsx"
      to: "/api/buildings"
      via: "fetch call for buildings filtered by property_id"
      pattern: "api/buildings"
    - from: "src/app/dashboard/objekte/page.tsx"
      to: "src/components/navigation/DashboardBreadcrumbs.tsx"
      via: "DashboardBreadcrumbs component rendered on page"
      pattern: "DashboardBreadcrumbs"
---

<objective>
Create the DashboardBreadcrumbs component and the first two levels of the /objekte route hierarchy: property list and property detail.

Purpose: Establish the breadcrumb navigation pattern (D3) and the top two levels of the Objekte drill-down (D4). Property list is grouped by mandate. Property detail shows buildings within a property.
Output: DashboardBreadcrumbs component, /dashboard/objekte page, /dashboard/objekte/[propertyId] page.
</objective>

<execution_context>
@C:/Users/Mario Giacchino/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Mario Giacchino/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/39-navigation-redesign/39-CONTEXT.md
@.planning/phases/39-navigation-redesign/39-RESEARCH.md
@src/components/ui/breadcrumbs.tsx
@src/contexts/MandateContext.tsx
@src/contexts/OrganizationContext.tsx
@src/app/api/properties/route.ts
@src/app/api/buildings/route.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create DashboardBreadcrumbs component</name>
  <files>
    src/components/navigation/DashboardBreadcrumbs.tsx
  </files>
  <action>
Create `src/components/navigation/DashboardBreadcrumbs.tsx` as a 'use client' component.

**Design per D3:**
- Uses `usePathname()` from next/navigation
- Returns null on `/dashboard` (no breadcrumbs on home page)
- On all other pages, builds breadcrumb items from URL segments

**Static segment label map** (German labels for known route segments):
```
objekte → Objekte
aufgaben → Aufgaben
kosten → Kosten
projekte → Projekte
lieferanten → Lieferanten
berichte → Berichte
settings → Einstellungen
abnahmen → Abnahmen
knowledge → Knowledge Base
audio → Audio
benachrichtigungen → Benachrichtigungen
aenderungsauftraege → Änderungsaufträge
vorlagen → Vorlagen
raum → Raum
```

**Props interface:**
```tsx
interface DashboardBreadcrumbsProps {
  labels?: Record<string, string>  // UUID → display name overrides
}
```

**Breadcrumb generation logic:**
1. Split pathname by `/`, filter out empty strings and `dashboard`
2. For each segment, build cumulative href starting from `/dashboard/`
3. Resolve label: first check `labels` prop (for UUID overrides), then check static map, then fallback to formatted segment (Title Case from kebab-case, truncated UUID for UUID patterns)
4. Always prepend "Übersicht" as first crumb linking to `/dashboard`

**Rendering:**
- `<nav>` with `aria-label="Breadcrumb"`
- "Übersicht" as first clickable Link to /dashboard
- ChevronRight separator between items (from lucide-react, `w-3.5 h-3.5 text-gray-400`)
- Last item rendered as `<span>` (non-clickable, `text-gray-900 dark:text-gray-100 font-medium`)
- All other items as `<Link>` (`hover:text-gray-900 dark:hover:text-gray-100 transition-colors`)
- Container: `flex items-center gap-1 text-sm text-gray-500 dark:text-gray-400 mb-4 flex-wrap`

Export as named export `DashboardBreadcrumbs`.

Note: The existing `src/components/ui/breadcrumbs.tsx` remains unchanged — it is a general-purpose component. `DashboardBreadcrumbs` is purpose-built for the dashboard nav hierarchy per D3 and lives in the navigation directory.
  </action>
  <verify>
Run `npx tsc --noEmit` to confirm no type errors. Grep for `DashboardBreadcrumbs` in the new file.
  </verify>
  <done>
DashboardBreadcrumbs component exists, returns null on /dashboard, shows "Übersicht > PageName" on non-object pages, supports UUID label overrides for drill-down pages.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create /dashboard/objekte property list and property detail pages</name>
  <files>
    src/app/dashboard/objekte/page.tsx
    src/app/dashboard/objekte/[propertyId]/page.tsx
  </files>
  <action>
**1. Create `src/app/dashboard/objekte/page.tsx` (Property List — D4):**
- 'use client' component
- Import DashboardBreadcrumbs from `@/components/navigation/DashboardBreadcrumbs`
- Import `useMandate` from `@/contexts/MandateContext` to get `availableMandates`
- Fetch `GET /api/properties` on mount (returns `{ properties: PropertyWithBuildings[] }`)
- Each property has: `id`, `name`, `address`, `mandate_id`, `buildings` array (each with `id`, `unit_count`)
- Group properties by `mandate_id`:
  - Build a `Map<string, Property[]>` keyed by mandate_id
  - For each mandate group, find the mandate name from `availableMandates`
- **Single-mandate optimization (D4):** If there is only 1 unique mandate_id across all properties, do NOT show the mandate section header
- Render `<DashboardBreadcrumbs />` at top (will auto-show "Übersicht > Objekte")
- Page title: `<h1>Objekte</h1>`
- For each mandate group, render:
  - Section header: `<h2 className="text-sm font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wide">Mandat: {mandateName}</h2>` (skip if single mandate)
  - Property cards in a grid `grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4`
- Each property card:
  - Wrapped in `<Link href={/dashboard/objekte/${property.id}}>` for navigation
  - Card shows: property name (bold), address (gray text), building count + total unit count
  - Format: "N Gebäude · M Einheiten" (sum unit_count from buildings array)
  - Styling: `bg-white dark:bg-gray-900 rounded-lg border border-gray-200 dark:border-gray-700 p-4 hover:border-blue-300 dark:hover:border-blue-600 hover:shadow-sm transition-all cursor-pointer`
- Loading state: skeleton cards (animate-pulse)
- Error state: red error message with retry button
- Empty state: "Keine Objekte vorhanden" message

**2. Create `src/app/dashboard/objekte/[propertyId]/page.tsx` (Property Detail):**
- 'use client' component with `params: Promise<{ propertyId: string }>`
- Unwrap params with `use(params)`
- Fetch property info: `GET /api/properties/${propertyId}` (for property name, address)
- Fetch buildings: `GET /api/buildings?property_id=${propertyId}` (returns `{ buildings: BuildingWithUnitCount[] }`)
- Import DashboardBreadcrumbs, pass `labels={{ [propertyId]: property.name }}`
- Page title: property name
- Display property address below title
- Building list as cards in a grid `grid grid-cols-1 md:grid-cols-2 gap-4`
- Each building card:
  - Wrapped in `<Link href={/dashboard/objekte/${propertyId}/${building.id}}>` for navigation
  - Shows: building name (bold), address if available, unit count badge
  - Styling: same card pattern as property cards
- Loading, error, empty states following same patterns as property list
  </action>
  <verify>
Run `npx tsc --noEmit` to confirm no type errors. Verify both page.tsx files exist at correct paths. Grep for `api/properties` in objekte/page.tsx and for `api/buildings` in [propertyId]/page.tsx.
  </verify>
  <done>
/dashboard/objekte renders property cards grouped by mandate with single-mandate optimization. /dashboard/objekte/[propertyId] renders building cards for the selected property. Both pages show DashboardBreadcrumbs. Clicking cards navigates to the next drill-down level.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes
2. `DashboardBreadcrumbs.tsx` exists in navigation directory
3. `/dashboard/objekte/page.tsx` fetches from /api/properties and groups by mandate
4. `/dashboard/objekte/[propertyId]/page.tsx` fetches buildings for the property
5. Breadcrumbs render correctly (auto-generated from URL with label overrides)
</verification>

<success_criteria>
- DashboardBreadcrumbs shows on all pages except /dashboard home
- /dashboard/objekte shows property cards grouped by mandate
- Single-mandate orgs see no mandate header
- /dashboard/objekte/[propertyId] shows building cards for that property
- Card clicks navigate to next drill-down level
- No TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/39-navigation-redesign/39-02-SUMMARY.md`
</output>
