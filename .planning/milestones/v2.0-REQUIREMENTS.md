# Requirements Archive: v2.0 Renovation Operations MVP

**Archived:** 2026-01-19
**Status:** SHIPPED

This is the archived requirements specification for v2.0 MVP.
For current requirements, see `.planning/PROJECT.md` (Active section).

---

# Requirements: KEWA v2.0 Renovation Operations System

**Defined:** 2026-01-18
**Source:** KEWA-RENOVATION-OPS-SPEC_v1_2026-01-18.md + Original v2.0 Scope
**Core Value:** KEWA AG hat volle Transparenz und Kontrolle über alle Renovationen — mit standardisierten Workflows, externer Handwerker-Integration, Kostenübersicht und automatischer Zustandshistorie.

---

## Phase 1: MVP (Kern-System)

### Datenmodell & Infrastruktur

- [x] **DATA-01**: Property (Liegenschaft) Entity mit Basis-Attributen
- [x] **DATA-02**: Building Entity (optional, für Multi-Building Properties)
- [x] **DATA-03**: Unit (Wohnung) Entity mit Mietzins-Feld
- [x] **DATA-04**: Room (Raum/Zone) Entity mit Typ (Bad, Küche, etc.)
- [x] **DATA-05**: Component Entity (optional: Boden, Wände, Fenster, etc.)
- [x] **DATA-06**: RenovationProject Entity mit Status-Workflow
- [x] **DATA-07**: Task Entity mit Abhängigkeiten und Checklisten-Funktion
- [x] **DATA-08**: WorkOrder/Ticket Entity für externe Aufträge
- [x] **DATA-09**: Partner Entity (Handwerker/Lieferanten) mit Kategorien
- [x] **DATA-10**: Offer (Offerte) Entity
- [x] **DATA-11**: Invoice (Rechnung) Entity mit PDF-Speicherung
- [x] **DATA-12**: Expense (Spesen/Barzahlung) Entity
- [x] **DATA-13**: Payment Entity mit Methode (bar/Überweisung/etc.)
- [x] **DATA-14**: Media Entity (Fotos/Videos) mit vorher/nachher Metadaten
- [x] **DATA-15**: AuditLog Entity für alle Änderungen (Pflicht)

### RBAC & Authentifizierung

- [x] **AUTH-01**: Admin-Rolle (KEWA) mit Vollzugriff
- [x] **AUTH-02**: Property/Project Manager Rolle
- [x] **AUTH-03**: Accounting Rolle (Kosten/Rechnungen)
- [x] **AUTH-04**: Tenant Rolle (read-only auf eigene Inhalte)
- [x] **AUTH-05**: External Contractor Rolle (nur eigene Aufträge)
- [x] **AUTH-06**: Jede Änderung erzeugt AuditLog-Eintrag
- [x] **AUTH-07**: PIN-Auth für interne Nutzer (bestehend)
- [x] **AUTH-08**: Email+Passwort-Auth für Mieter
- [x] **AUTH-09**: Magic-Link-Auth für externe Handwerker

### Status-Workflows

- [x] **STAT-01**: WorkOrder Status: draft → sent → viewed → accepted/rejected → in_progress → done → inspected → closed
- [x] **STAT-02**: RenovationProject Status: planned → active → blocked → finished → approved
- [x] **STAT-03**: Room/Unit Condition: old | partial | new (ableitbar)
- [x] **STAT-04**: Condition-Tracking mit Datum, Quell-Projekt, Media-Referenzen

### Template-System

- [x] **TMPL-01**: Template-Library für Komplett-Renovationen
- [x] **TMPL-02**: Template-Library für Einzel-Raum-Renovationen (Bad, Küche, etc.)
- [x] **TMPL-03**: Templates enthalten Phasen → Pakete → Tasks (WBS)
- [x] **TMPL-04**: Task-Abhängigkeiten und geschätzte Dauer
- [x] **TMPL-05**: Quality Gates (Abnahme-Checkpoints) mit Evidenz-Anforderungen
- [x] **TMPL-06**: Mapping-Regeln: Abschluss triggert Raum/Unit Condition Update

### Externe Handwerker: Link-Portal

- [x] **EXT-01**: WorkOrder-Erstellung aus Projekt/Task mit Partner-Zuweisung
- [x] **EXT-02**: WorkOrder enthält: Scope, Location, Zeitfenster, Anhänge, Notizen
- [x] **EXT-03**: PDF-Generierung des WorkOrders
- [x] **EXT-04**: Email-Versand via lokalen Email-Client (mailto)
- [x] **EXT-05**: Magic-Link (Token) zur Web-Seite im Email
- [x] **EXT-06**: Contractor Web-Portal: Details + Anhänge anzeigen
- [x] **EXT-07**: Contractor: "Accept" / "Reject" Buttons
- [x] **EXT-08**: Contractor: Preisvorschlag (Betrag + Kommentar)
- [x] **EXT-09**: Contractor: Zeitfenster-Vorschlag
- [x] **EXT-10**: Contractor: Fragen/Kommentar-Feld
- [x] **EXT-11**: Contractor: Dokumente hochladen (Offerte/Rechnung)
- [x] **EXT-12**: Contractor: Fotos hochladen
- [x] **EXT-13**: Tracking: "Viewed" = Magic-Link geöffnet
- [x] **EXT-14**: Zeitgestempelte Events im Log
- [ ] **EXT-15**: Automatische Erinnerungen (24h + 48h) — DEFERRED (requires background jobs)
- [x] **EXT-16**: Annahme-Deadline (z.B. 72h)

### Historie & Digital Twin

- [x] **HIST-01**: Unit hat Timeline aller Projekte/WorkOrders/Kosten/Media
- [x] **HIST-02**: Unit-Übersicht zeigt Renovations-Fortschritt pro Raum
- [x] **HIST-03**: Raum-Condition wird aus abgeschlossenen Projekten abgeleitet
- [x] **HIST-04**: Automation: Projekt approved → Raum=new mit Datum+Media+Projekt-ID
- [x] **HIST-05**: Unit-Summary wird automatisch berechnet (% renoviert)

### Kostenmodell

- [x] **COST-01**: Workflow: Offer → WorkOrder/Contract → Invoice → Payment
- [x] **COST-02**: Manuelle Expense-Einträge (Barzahlungen, Spesen)
- [x] **COST-03**: Kosten-Aggregation nach: Projekt, Unit, Room, Trade, Partner
- [x] **COST-04**: Varianz: Offerte vs Rechnung
- [x] **COST-05**: Anhänge für Rechnungs-PDFs und Belege
- [x] **COST-06**: CSV-Export für Buchhaltung

### Mietzins

- [x] **RENT-01**: Mietzins pro Unit speicherbar
- [x] **RENT-02**: Dashboard zeigt: Miete vs Renovationskosten
- [x] **RENT-03**: Investment-Übersicht pro Unit

### Dashboard & Visualisierung

- [x] **DASH-01**: Property-Level Übersicht
- [x] **DASH-02**: Units Matrix/Heatmap: Units × Rooms mit Status-Farben
- [x] **DASH-03**: Renovations-Fortschritt % pro Unit
- [x] **DASH-04**: Timeline pro Unit (abgeschlossene Projekte)
- [x] **DASH-05**: Kosten pro Unit/Projekt mit Filtern (Zeit, Partner, Trade)
- [x] **DASH-06**: Drilldown: Property → Unit → Room → Project → Tasks/WorkOrders → Media/Kosten

### Parkplätze (Original v2.0)

- [x] **PARK-01**: 8 Parkplätze werden rechts neben dem Gebäude vertikal angezeigt
- [x] **PARK-02**: Parkplätze haben die gleiche Höhe wie das Gebäude (EG bis Dach)
- [x] **PARK-03**: Jeder Parkplatz hat Status: frei / belegt / reparatur
- [x] **PARK-04**: KEWA AG kann Parkplatz-Status ändern
- [x] **PARK-05**: Parkplatz-Belegung beeinflusst Gesamtauslastung

### Auslastung (Original v2.0)

- [x] **OCCU-01**: Auslastungs-Dashboard mit Gesamtauslastung
- [x] **OCCU-02**: Leerstehende Wohnungen reduzieren Auslastung
- [x] **OCCU-03**: Unbelegte Parkplätze reduzieren Auslastung
- [x] **OCCU-04**: Auslastung als Prozent und visuell (Balken)

### Task-Kommentare (Original v2.0)

- [x] **COMM-01**: Kommentare zu Tasks/WorkOrders schreiben
- [x] **COMM-02**: Chronologische Anzeige mit Autor und Zeitstempel
- [x] **COMM-03**: Interne Notizen (nur KEWA) vs externe Kommunikation

### Tech Debt (Original v2.0)

- [x] **DEBT-01**: Next.js Middleware-Warning behoben (Proxy-Pattern)
- [x] **DEBT-02**: Turbopack Build stabil (keine Race-Conditions)
- [x] **DEBT-03**: Session-Fetching-Pattern vereinheitlicht
- [x] **DEBT-04**: Phase 03 VERIFICATION.md erstellt

---

## Non-Functional Requirements

- [x] **NFR-01**: Audit-Logging für alle Schreiboperationen
- [x] **NFR-02**: Schweizer Kontext: Datenschutz, Datentrennung Mieter/Intern
- [x] **NFR-03**: Konfigurierbare Retention-Policy
- [x] **NFR-04**: File Storage für PDFs und Fotos
- [x] **NFR-05**: Token-basierter sicherer externer Zugriff (Magic Link, ablaufend)
- [x] **NFR-06**: Mobile-friendly Contractor Page

---

## Milestone Summary

**Shipped:** 91 of 92 MVP requirements (99%)
**Adjusted:** None
**Dropped:** None
**Deferred:**
- EXT-15 (Automatic reminders 24h + 48h) — requires background job infrastructure

---

## Traceability (MVP Only)

| Category | Requirements | Shipped | Status |
|----------|--------------|---------|--------|
| Data Model | DATA-01 to DATA-15 | 15/15 | Complete |
| Auth/RBAC | AUTH-01 to AUTH-09 | 9/9 | Complete |
| Status Workflows | STAT-01 to STAT-04 | 4/4 | Complete |
| Templates | TMPL-01 to TMPL-06 | 6/6 | Complete |
| External Portal | EXT-01 to EXT-16 | 15/16 | 1 Deferred |
| History/Digital Twin | HIST-01 to HIST-05 | 5/5 | Complete |
| Cost Model | COST-01 to COST-06 | 6/6 | Complete |
| Rent | RENT-01 to RENT-03 | 3/3 | Complete |
| Dashboard | DASH-01 to DASH-06 | 6/6 | Complete |
| Parking | PARK-01 to PARK-05 | 5/5 | Complete |
| Occupancy | OCCU-01 to OCCU-04 | 4/4 | Complete |
| Comments | COMM-01 to COMM-03 | 3/3 | Complete |
| Tech Debt | DEBT-01 to DEBT-04 | 4/4 | Complete |
| Non-Functional | NFR-01 to NFR-06 | 6/6 | Complete |
| **Total** | **92** | **91** | **99%** |

---

## Out of Scope

| Feature | Reason |
|---------|--------|
| Zahlungsabwicklung/Online-Payment | Nicht Teil dieser App, CSV-Export für Buchhaltung |
| Transkription für Dialekt | Schweizerdeutsch zu unzuverlässig |
| Native Mobile App | PWA-Ansatz bevorzugt |
| Vollautomatische Ticket→WorkOrder | KEWA entscheidet manuell |
| Rechtliche Beratung | Knowledge Base nur als FAQ, keine Rechtsberatung |

---
*Archived: 2026-01-19 as part of v2.0 milestone completion*
